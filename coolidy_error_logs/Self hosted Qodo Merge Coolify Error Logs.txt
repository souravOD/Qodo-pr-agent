2025-12-10T02:10:28.506239087Z [2025-12-10 02:10:28 +0000] [1] [INFO] Starting gunicorn 23.0.0
2025-12-10T02:10:28.506550367Z [2025-12-10 02:10:28 +0000] [1] [INFO] Listening at: http://0.0.0.0:3000 (1)
2025-12-10T02:10:28.506592750Z [2025-12-10 02:10:28 +0000] [1] [INFO] Using worker: uvicorn.workers.UvicornWorker
2025-12-10T02:10:28.513679262Z [2025-12-10 02:10:28 +0000] [8] [INFO] Booting worker with pid: 8
2025-12-10T02:10:28.583173753Z [2025-12-10 02:10:28 +0000] [9] [INFO] Booting worker with pid: 9
2025-12-10T02:10:28.654523921Z [2025-12-10 02:10:28 +0000] [10] [INFO] Booting worker with pid: 10
2025-12-10T02:10:28.704318392Z [2025-12-10 02:10:28 +0000] [11] [INFO] Booting worker with pid: 11
2025-12-10T02:10:28.761049896Z [2025-12-10 02:10:28 +0000] [12] [INFO] Booting worker with pid: 12
2025-12-10T02:10:28.790131928Z [2025-12-10 02:10:28 +0000] [13] [INFO] Booting worker with pid: 13
2025-12-10T02:10:28.832335888Z [2025-12-10 02:10:28 +0000] [14] [INFO] Booting worker with pid: 14
2025-12-10T02:10:28.913930537Z [2025-12-10 02:10:28 +0000] [15] [INFO] Booting worker with pid: 15
2025-12-10T02:10:28.981761671Z [2025-12-10 02:10:28 +0000] [16] [INFO] Booting worker with pid: 16
2025-12-10T02:10:29.038559906Z [2025-12-10 02:10:29 +0000] [17] [INFO] Booting worker with pid: 17
2025-12-10T02:10:29.064268684Z [2025-12-10 02:10:29 +0000] [18] [INFO] Booting worker with pid: 18
2025-12-10T02:10:29.109916044Z [2025-12-10 02:10:29 +0000] [19] [INFO] Booting worker with pid: 19
2025-12-10T02:10:29.167475878Z [2025-12-10 02:10:29 +0000] [20] [INFO] Booting worker with pid: 20
2025-12-10T02:10:29.262307708Z [2025-12-10 02:10:29 +0000] [21] [INFO] Booting worker with pid: 21
2025-12-10T02:10:29.320010937Z [2025-12-10 02:10:29 +0000] [22] [INFO] Booting worker with pid: 22
2025-12-10T02:10:29.378363567Z [2025-12-10 02:10:29 +0000] [23] [INFO] Booting worker with pid: 23
2025-12-10T02:10:29.398002226Z [2025-12-10 02:10:29 +0000] [24] [INFO] Booting worker with pid: 24
2025-12-10T02:10:29.423813538Z [2025-12-10 02:10:29 +0000] [25] [INFO] Booting worker with pid: 25
2025-12-10T02:10:29.444089257Z [2025-12-10 02:10:29 +0000] [26] [INFO] Booting worker with pid: 26
2025-12-10T02:10:29.460796478Z [2025-12-10 02:10:29 +0000] [27] [INFO] Booting worker with pid: 27
2025-12-10T02:10:29.518423754Z [2025-12-10 02:10:29 +0000] [28] [INFO] Booting worker with pid: 28
2025-12-10T02:10:29.623517661Z [2025-12-10 02:10:29 +0000] [29] [INFO] Booting worker with pid: 29
2025-12-10T02:10:29.741964122Z [2025-12-10 02:10:29 +0000] [30] [INFO] Booting worker with pid: 30
2025-12-10T02:10:29.883071087Z [2025-12-10 02:10:29 +0000] [31] [INFO] Booting worker with pid: 31
2025-12-10T02:10:29.947521126Z [2025-12-10 02:10:29 +0000] [32] [INFO] Booting worker with pid: 32
2025-12-10T02:10:40.206317673Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:40.206387858Z   import pkg_resources
2025-12-10T02:10:41.379912587Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:41.379962573Z   import pkg_resources
2025-12-10T02:10:41.482965990Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:41.483025400Z   import pkg_resources
2025-12-10T02:10:41.957886371Z 2025-12-10 02:10:41.952 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:41.958104300Z 2025-12-10 02:10:41.957 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:42.098100071Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:42.098161504Z   import pkg_resources
2025-12-10T02:10:42.211497154Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:42.211539748Z   import pkg_resources
2025-12-10T02:10:42.389172557Z 2025-12-10 02:10:42.388 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:42.389369233Z 2025-12-10 02:10:42.389 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:42.616147695Z [2025-12-10 02:10:42 +0000] [24] [INFO] Started server process [24]
2025-12-10T02:10:42.616199844Z [2025-12-10 02:10:42 +0000] [24] [INFO] Waiting for application startup.
2025-12-10T02:10:42.617014712Z [2025-12-10 02:10:42 +0000] [24] [INFO] Application startup complete.
2025-12-10T02:10:42.682315073Z 2025-12-10 02:10:42.681 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:42.682409024Z 2025-12-10 02:10:42.682 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:42.687702442Z 2025-12-10 02:10:42.687 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:42.687766449Z 2025-12-10 02:10:42.687 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:42.694157742Z 2025-12-10 02:10:42.693 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:42.694332244Z 2025-12-10 02:10:42.694 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:42.808196061Z [2025-12-10 02:10:42 +0000] [13] [INFO] Started server process [13]
2025-12-10T02:10:42.808251074Z [2025-12-10 02:10:42 +0000] [13] [INFO] Waiting for application startup.
2025-12-10T02:10:42.808407289Z [2025-12-10 02:10:42 +0000] [13] [INFO] Application startup complete.
2025-12-10T02:10:42.821115794Z [2025-12-10 02:10:42 +0000] [9] [INFO] Started server process [9]
2025-12-10T02:10:42.822078215Z [2025-12-10 02:10:42 +0000] [9] [INFO] Waiting for application startup.
2025-12-10T02:10:42.822124543Z [2025-12-10 02:10:42 +0000] [9] [INFO] Application startup complete.
2025-12-10T02:10:42.828500034Z [2025-12-10 02:10:42 +0000] [8] [INFO] Started server process [8]
2025-12-10T02:10:42.828587535Z [2025-12-10 02:10:42 +0000] [8] [INFO] Waiting for application startup.
2025-12-10T02:10:42.829056231Z [2025-12-10 02:10:42 +0000] [8] [INFO] Application startup complete.
2025-12-10T02:10:42.839371829Z [2025-12-10 02:10:42 +0000] [22] [INFO] Started server process [22]
2025-12-10T02:10:42.839444528Z [2025-12-10 02:10:42 +0000] [22] [INFO] Waiting for application startup.
2025-12-10T02:10:42.839647445Z [2025-12-10 02:10:42 +0000] [22] [INFO] Application startup complete.
2025-12-10T02:10:43.590000991Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:43.590063785Z   import pkg_resources
2025-12-10T02:10:43.707119461Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:43.707165091Z   import pkg_resources
2025-12-10T02:10:43.728520958Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:43.728585746Z   import pkg_resources
2025-12-10T02:10:43.732193644Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:43.732240824Z   import pkg_resources
2025-12-10T02:10:43.741976939Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:43.742012784Z   import pkg_resources
2025-12-10T02:10:43.797536228Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:43.797588907Z   import pkg_resources
2025-12-10T02:10:44.082874311Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:44.082928333Z   import pkg_resources
2025-12-10T02:10:44.325950877Z 2025-12-10 02:10:44.324 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:44.326676470Z 2025-12-10 02:10:44.325 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:44.340215597Z 2025-12-10 02:10:44.337 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:44.340253956Z 2025-12-10 02:10:44.338 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:44.394920208Z 2025-12-10 02:10:44.393 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:44.394958707Z 2025-12-10 02:10:44.393 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:44.426976283Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:44.427016804Z   import pkg_resources
2025-12-10T02:10:44.542598650Z [2025-12-10 02:10:44 +0000] [31] [INFO] Started server process [31]
2025-12-10T02:10:44.542711029Z [2025-12-10 02:10:44 +0000] [31] [INFO] Waiting for application startup.
2025-12-10T02:10:44.543032995Z [2025-12-10 02:10:44 +0000] [31] [INFO] Application startup complete.
2025-12-10T02:10:44.673552385Z [2025-12-10 02:10:44 +0000] [16] [INFO] Started server process [16]
2025-12-10T02:10:44.673584963Z [2025-12-10 02:10:44 +0000] [16] [INFO] Waiting for application startup.
2025-12-10T02:10:44.675541142Z [2025-12-10 02:10:44 +0000] [16] [INFO] Application startup complete.
2025-12-10T02:10:44.686211334Z 2025-12-10 02:10:44.685 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:44.686246496Z 2025-12-10 02:10:44.685 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:44.702624342Z [2025-12-10 02:10:44 +0000] [23] [INFO] Started server process [23]
2025-12-10T02:10:44.702662199Z [2025-12-10 02:10:44 +0000] [23] [INFO] Waiting for application startup.
2025-12-10T02:10:44.710103575Z [2025-12-10 02:10:44 +0000] [23] [INFO] Application startup complete.
2025-12-10T02:10:44.710949860Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:44.710965654Z   import pkg_resources
2025-12-10T02:10:44.718516014Z 2025-12-10 02:10:44.718 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:44.718645459Z 2025-12-10 02:10:44.718 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:44.753569546Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:44.753646012Z   import pkg_resources
2025-12-10T02:10:44.776004240Z 2025-12-10 02:10:44.775 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:44.776199265Z 2025-12-10 02:10:44.775 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:44.816113423Z 2025-12-10 02:10:44.815 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:44.816189136Z 2025-12-10 02:10:44.815 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:44.881340553Z [2025-12-10 02:10:44 +0000] [18] [INFO] Started server process [18]
2025-12-10T02:10:44.881390719Z [2025-12-10 02:10:44 +0000] [18] [INFO] Waiting for application startup.
2025-12-10T02:10:44.881693666Z [2025-12-10 02:10:44 +0000] [18] [INFO] Application startup complete.
2025-12-10T02:10:44.893213789Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:44.893291135Z   import pkg_resources
2025-12-10T02:10:44.925072647Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The2025-12-10T02:12:13.696292158Z {"text": "Received a GitHub webhook\n", "record": {"elapsed": {"repr": "0:01:28.348258", "seconds": 88.348258}, "exception": null, "extra": {}, "file": {"name": "github_app.py", "path": "/app/pr_agent/servers/github_app.py"}, "function": "handle_github_webhooks", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 45, "message": "Received a GitHub webhook", "module": "github_app", "name": "pr_agent.servers.github_app", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:13.695654+00:00", "timestamp": 1765332733.695654}}}
2025-12-10T02:10:44.925158656Z   import pkg_resources
2025-12-10T02:10:44.931295886Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:44.931336898Z   import pkg_resources
2025-12-10T02:10:44.992662289Z [2025-12-10 02:10:44 +0000] [19] [INFO] Started server process [19]
2025-12-10T02:10:44.992710741Z [2025-12-10 02:10:44 +0000] [19] [INFO] Waiting for application startup.
2025-12-10T02:10:44.992908379Z [2025-12-10 02:10:44 +0000] [19] [INFO] Application startup complete.
2025-12-10T02:10:45.036609987Z [2025-12-10 02:10:45 +0000] [30] [INFO] Started server process [30]
2025-12-10T02:10:45.036658429Z [2025-12-10 02:10:45 +0000] [30] [INFO] Waiting for application startup.
2025-12-10T02:10:45.036799432Z [2025-12-10 02:10:45 +0000] [30] [INFO] Application startup complete.
2025-12-10T02:10:45.097687082Z [2025-12-10 02:10:45 +0000] [10] [INFO] Started server process [10]
2025-12-10T02:10:45.097936889Z [2025-12-10 02:10:45 +0000] [10] [INFO] Waiting for application startup.
2025-12-10T02:10:45.101349121Z [2025-12-10 02:10:45 +0000] [10] [INFO] Application startup complete.
2025-12-10T02:10:45.180760271Z 2025-12-10 02:10:45.180 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:45.181450151Z 2025-12-10 02:10:45.181 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:45.294134539Z 2025-12-10 02:10:45.293 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:45.294206938Z 2025-12-10 02:10:45.294 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:45.317053603Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:45.317117338Z   import pkg_resources
2025-12-10T02:10:45.366757707Z [2025-12-10 02:10:45 +0000] [12] [INFO] Started server process [12]
2025-12-10T02:10:45.366805419Z [2025-12-10 02:10:45 +0000] [12] [INFO] Waiting for application startup.
2025-12-10T02:10:45.366985311Z [2025-12-10 02:10:45 +0000] [12] [INFO] Application startup complete.
2025-12-10T02:10:45.374548319Z 2025-12-10 02:10:45.373 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:45.374879137Z 2025-12-10 02:10:45.374 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:45.406747200Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:45.406835943Z   import pkg_resources
2025-12-10T02:10:45.416102239Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:45.416143972Z   import pkg_resources
2025-12-10T02:10:45.437988887Z [2025-12-10 02:10:45 +0000] [20] [INFO] Started server process [20]
2025-12-10T02:10:45.438065654Z [2025-12-10 02:10:45 +0000] [20] [INFO] Waiting for application startup.
2025-12-10T02:10:45.438188968Z [2025-12-10 02:10:45 +0000] [20] [INFO] Application startup complete.
2025-12-10T02:10:45.442468379Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:45.442509561Z   import pkg_resources
2025-12-10T02:10:45.467207195Z 2025-12-10 02:10:45.466 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:45.467286264Z 2025-12-10 02:10:45.467 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:45.485426245Z 2025-12-10 02:10:45.484 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:45.485470111Z 2025-12-10 02:10:45.485 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:45.544666963Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:45.544714123Z   import pkg_resources
2025-12-10T02:10:45.558260862Z [2025-12-10 02:10:45 +0000] [27] [INFO] Started server process [27]
2025-12-10T02:10:45.559003181Z [2025-12-10 02:10:45 +0000] [27] [INFO] Waiting for application startup.
2025-12-10T02:10:45.559661803Z [2025-12-10 02:10:45 +0000] [27] [INFO] Application startup complete.
2025-12-10T02:10:45.629882640Z 2025-12-10 02:10:45.629 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:45.632534247Z 2025-12-10 02:10:45.629 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:45.700084950Z [2025-12-10 02:10:45 +0000] [17] [INFO] Started server process [17]
2025-12-10T02:10:45.701040290Z [2025-12-10 02:10:45 +0000] [17] [INFO] Waiting for application startup.
2025-12-10T02:10:45.701059058Z [2025-12-10 02:10:45 +0000] [17] [INFO] Application startup complete.
2025-12-10T02:10:45.749102328Z [2025-12-10 02:10:45 +0000] [21] [INFO] Started server process [21]
2025-12-10T02:10:45.749291925Z [2025-12-10 02:10:45 +0000] [21] [INFO] Waiting for application startup.
2025-12-10T02:10:45.750003777Z [2025-12-10 02:10:45 +0000] [21] [INFO] Application startup complete.
2025-12-10T02:10:45.867880753Z [2025-12-10 02:10:45 +0000] [29] [INFO] Started server process [29]
2025-12-10T02:10:45.867914163Z [2025-12-10 02:10:45 +0000] [29] [INFO] Waiting for application startup.
2025-12-10T02:10:45.867916997Z [2025-12-10 02:10:45 +0000] [29] [INFO] Application startup complete.
2025-12-10T02:10:45.879757233Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:45.879831895Z   import pkg_resources
2025-12-10T02:10:45.932898367Z /usr/local/lib/python3.12/site-packages/azure/__init__.py:5: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:10:45.932955764Z   import pkg_resources
2025-12-10T02:10:45.935061448Z 2025-12-10 02:10:45.934 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:45.935573079Z 2025-12-10 02:10:45.934 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:45.936785676Z 2025-12-10 02:10:45.936 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:45.937065378Z 2025-12-10 02:10:45.936 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:45.981117374Z 2025-12-10 02:10:45.980 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:45.981184315Z 2025-12-10 02:10:45.980 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:45.995554053Z 2025-12-10 02:10:45.994 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:45.995781876Z 2025-12-10 02:10:45.995 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:46.018929104Z 2025-12-10 02:10:46.014 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:46.018986370Z 2025-12-10 02:10:46.015 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:46.069512353Z [2025-12-10 02:10:46 +0000] [11] [INFO] Started server process [11]
2025-12-10T02:10:46.069569129Z [2025-12-10 02:10:46 +0000] [11] [INFO] Waiting for application startup.
2025-12-10T02:10:46.069909732Z [2025-12-10 02:10:46 +0000] [11] [INFO] Application startup complete.
2025-12-10T02:10:46.089970177Z [2025-12-10 02:10:46 +0000] [14] [INFO] Started server process [14]
2025-12-10T02:10:46.090018951Z [2025-12-10 02:10:46 +0000] [14] [INFO] Waiting for application startup.
2025-12-10T02:10:46.090587839Z [2025-12-10 02:10:46 +0000] [14] [INFO] Application startup complete.
2025-12-10T02:10:46.103730006Z [2025-12-10 02:10:46 +0000] [26] [INFO] Started server process [26]
2025-12-10T02:10:46.103778539Z [2025-12-10 02:10:46 +0000] [26] [INFO] Waiting for application startup.
2025-12-10T02:10:46.103972722Z [2025-12-10 02:10:46 +0000] [26] [INFO] Application startup complete.
2025-12-10T02:10:46.119105550Z [2025-12-10 02:10:46 +0000] [25] [INFO] Started server process [25]
2025-12-10T02:10:46.119152932Z [2025-12-10 02:10:46 +0000] [25] [INFO] Waiting for application startup.
2025-12-10T02:10:46.119698575Z [2025-12-10 02:10:46 +0000] [25] [INFO] Application startup complete.
2025-12-10T02:10:46.147420296Z [2025-12-10 02:10:46 +0000] [32] [INFO] Started server process [32]
2025-12-10T02:10:46.147472165Z [2025-12-10 02:10:46 +0000] [32] [INFO] Waiting for application startup.
2025-12-10T02:10:46.147678736Z [2025-12-10 02:10:46 +0000] [32] [INFO] Application startup complete.
2025-12-10T02:10:46.286421180Z 2025-12-10 02:10:46.285 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:46.286458806Z 2025-12-10 02:10:46.286 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:46.322193105Z 2025-12-10 02:10:46.321 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings/.secrets.toml. Skipping it.
2025-12-10T02:10:46.322405446Z 2025-12-10 02:10:46.322 | WARNING  | pr_agent.custom_merge_loader:load:62 - Settings file not found: /app/pr_agent/settings_prod/.secrets.toml. Skipping it.
2025-12-10T02:10:46.419797766Z [2025-12-10 02:10:46 +0000] [15] [INFO] Started server process [15]
2025-12-10T02:10:46.419871537Z [2025-12-10 02:10:46 +0000] [15] [INFO] Waiting for application startup.
2025-12-10T02:10:46.420079942Z [2025-12-10 02:10:46 +0000] [15] [INFO] Application startup complete.
2025-12-10T02:10:46.452652715Z [2025-12-10 02:10:46 +0000] [28] [INFO] Started server process [28]
2025-12-10T02:10:46.452694818Z [2025-12-10 02:10:46 +0000] [28] [INFO] Waiting for application startup.
2025-12-10T02:10:46.452802490Z [2025-12-10 02:10:46 +0000] [28] [INFO] Application startup complete.
2025-12-10T02:12:13.720181957Z {"text": "Handling request with event: issue_comment, action: created\n", "record": {"elapsed": {"repr": "0:01:28.372340", "seconds": 88.37234}, "exception": null, "extra": {}, "file": {"name": "github_app.py", "path": "/app/pr_agent/servers/github_app.py"}, "function": "handle_request", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 321, "message": "Handling request with event: issue_comment, action: created", "module": "github_app", "name": "pr_agent.servers.github_app", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:13.719736+00:00", "timestamp": 1765332733.719736}}}
2025-12-10T02:12:13.721251860Z {"text": "Request body\n", "record": {"elapsed": {"repr": "0:01:28.373333", "seconds": 88.373333}, "exception": null, "extra": {"artifact": {"action": "created", "issue": {"url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/1", "repository_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend", "labels_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/1/labels{/name}", "comments_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/1/comments", "events_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/1/events", "html_url": "https://github.com/souravOD/nutri-b2c-frontend/pull/1", "id": 3527983986, "node_id": "PR_kwDOQEZhKM6uaI7J", "number": 1, "title": "Fix: Search UX and multi-filter logic (frontend)", "user": {"login": "NamanOdysseyts", "id": 238778617, "node_id": "U_kgDODjt4-Q", "avatar_url": "https://avatars.githubusercontent.com/u/238778617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NamanOdysseyts", "html_url": "https://github.com/NamanOdysseyts", "followers_url": "https://api.github.com/users/NamanOdysseyts/followers", "following_url": "https://api.github.com/users/NamanOdysseyts/following{/other_user}", "gists_url": "https://api.github.com/users/NamanOdysseyts/gists{/gist_id}", "starred_url": "https://api.github.com/users/NamanOdysseyts/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NamanOdysseyts/subscriptions", "organizations_url": "https://api.github.com/users/NamanOdysseyts/orgs", "repos_url": "https://api.github.com/users/NamanOdysseyts/repos", "events_url": "https://api.github.com/users/NamanOdysseyts/events{/privacy}", "received_events_url": "https://api.github.com/users/NamanOdysseyts/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 9561404867, "node_id": "LA_kwDOQEZhKM8AAAACOed1ww", "url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/labels/Review%20effort%202/5", "name": "Review effort 2/5", "color": "d1bcf9", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 60, "created_at": "2025-10-18T02:45:21Z", "updated_at": "2025-12-10T02:12:11Z", "closed_at": null, "author_association": "COLLABORATOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "html_url": "https://github.com/souravOD/nutri-b2c-frontend/pull/1", "diff_url": "https://github.com/souravOD/nutri-b2c-frontend/pull/1.diff", "patch_url": "https://github.com/souravOD/nutri-b2c-frontend/pull/1.patch", "merged_at": null}, "body": "- Improved search bar UX in app/search/page.tsx:\r\n  - X icon clears input and refocuses\r\n  - Escape key clears input\r\n  - Enter key triggers search\r\n\r\n- Updated filter count logic:\r\n  - Accurately counts all active filters\r\n  - Apply button badge reflects true total", "reactions": {"url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/1/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/1/timeline", "performed_via_github_app": null, "state_reason": null}, "comment": {"url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/comments/3635052591", "html_url": "https://github.com/souravOD/nutri-b2c-frontend/pull/1#issuecomment-3635052591", "issue_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/1", "id": 3635052591, "node_id": "IC_kwDOQEZhKM7YqoAv", "user": {"login": "souravOD", "id": 238303722, "node_id": "U_kgDODjQ56g", "avatar_url": "https://avatars.githubusercontent.com/u/238303722?v=4", "gravatar_id": "", "url": "https://api.github.com/users/souravOD", "html_url": "https://github.com/souravOD", "followers_url": "https://api.github.com/users/souravOD/followers", "following_url": "https://api.github.com/users/souravOD/following{/other_user}", "gists_url": "https://api.github.com/users/souravOD/gists{/gist_id}", "starred_url": "https://api.github.com/users/souravOD/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/souravOD/subscriptions", "organizations_url": "https://api.github.com/users/souravOD/orgs", "repos_url": "https://api.github.com/users/souravOD/repos", "events_url": "https://api.github.com/users/souravOD/events{/privacy}", "received_events_url": "https://api.github.com/users/souravOD/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "created_at": "2025-12-10T02:12:11Z", "updated_at": "2025-12-10T02:12:11Z", "body": "/review Can you please review this PR", "author_association": "OWNER", "reactions": {"url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/comments/3635052591/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "performed_via_github_app": null}, "repository": {"id": 1078354216, "node_id": "R_kgDOQEZhKA", "name": "nutri-b2c-frontend", "full_name": "souravOD/nutri-b2c-frontend", "private": false, "owner": {"login": "souravOD", "id": 238303722, "node_id": "U_kgDODjQ56g", "avatar_url": "https://avatars.githubusercontent.com/u/238303722?v=4", "gravatar_id": "", "url": "https://api.github.com/users/souravOD", "html_url": "https://github.com/souravOD", "followers_url": "https://api.github.com/users/souravOD/followers", "following_url": "https://api.github.com/users/souravOD/following{/other_user}", "gists_url": "https://api.github.com/users/souravOD/gists{/gist_id}", "starred_url": "https://api.github.com/users/souravOD/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/souravOD/subscriptions", "organizations_url": "https://api.github.com/users/souravOD/orgs", "repos_url": "https://api.github.com/users/souravOD/repos", "events_url": "https://api.github.com/users/souravOD/events{/privacy}", "received_events_url": "https://api.github.com/users/souravOD/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "html_url": "https://github.com/souravOD/nutri-b2c-frontend", "description": null, "fork": true, "url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend", "forks_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/forks", "keys_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/teams", "hooks_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/hooks", "issue_events_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/events{/number}", "events_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/events", "assignees_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/assignees{/user}", "branches_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/branches{/branch}", "tags_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/tags", "blobs_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/git/refs{/sha}", "trees_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/statuses/{sha}", "languages_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/languages", "stargazers_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/stargazers", "contributors_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/contributors", "subscribers_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/subscribers", "subscription_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/subscription", "commits_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/commits{/sha}", "git_commits_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/git/commits{/sha}", "comments_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/comments{/number}", "issue_comment_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/comments{/number}", "contents_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/contents/{+path}", "compare_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/merges", "archive_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/downloads", "issues_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues{/number}", "pulls_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls{/number}", "milestones_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/milestones{/number}", "notifications_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/labels{/name}", "releases_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/releases{/id}", "deployments_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/deployments", "created_at": "2025-10-17T15:44:00Z", "updated_at": "2025-11-14T04:02:00Z", "pushed_at": "2025-10-16T19:32:39Z", "git_url": "git://github.com/souravOD/nutri-b2c-frontend.git", "ssh_url": "git@github.com:souravOD/nutri-b2c-frontend.git", "clone_url": "https://github.com/souravOD/nutri-b2c-frontend.git", "svn_url": "https://github.com/souravOD/nutri-b2c-frontend", "homepage": "https://v0-next-js-app-requirements-omega.vercel.app", "size": 11387, "stargazers_count": 0, "watchers_count": 0, "language": null, "has_issues": false, "has_projects": true, "has_downloads": true, "has_wiki": false, "has_pages": false, "has_discussions": false, "forks_count": 1, "mirror_url": null, "archived": false, "disabled": false, "open_issues_count": 2, "license": null, "allow_forking": true, "is_template": false, "web_commit_signoff_required": false, "topics": [], "visibility": "public", "forks": 1, "open_issues": 2, "watchers": 0, "default_branch": "main"}, "sender": {"login": "souravOD", "id": 238303722, "node_id": "U_kgDODjQ56g", "avatar_url": "https://avatars.githubusercontent.com/u/238303722?v=4", "gravatar_id": "", "url": "https://api.github.com/users/souravOD", "html_url": "https://github.com/souravOD", "followers_url": "https://api.github.com/users/souravOD/followers", "following_url": "https://api.github.com/users/souravOD/following{/other_user}", "gists_url": "https://api.github.com/users/souravOD/gists{/gist_id}", "starred_url": "https://api.github.com/users/souravOD/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/souravOD/subscriptions", "organizations_url": "https://api.github.com/users/souravOD/orgs", "repos_url": "https://api.github.com/users/souravOD/repos", "events_url": "https://api.github.com/users/souravOD/events{/privacy}", "received_events_url": "https://api.github.com/users/souravOD/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "installation": {"id": 92375808, "node_id": "MDIzOkludGVncmF0aW9uSW5zdGFsbGF0aW9uOTIzNzU4MDg="}}, "event": "issue_comment"}, "file": {"name": "github_app.py", "path": "/app/pr_agent/servers/github_app.py"}, "function": "handle_request", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 342, "message": "Request body", "module": "github_app", "name": "pr_agent.servers.github_app", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:13.720729+00:00", "timestamp": 1765332733.720729}}}
2025-12-10T02:12:14.751113596Z {"text": "Processing comment on PR api_url='https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1', comment_body=/review Can you please review this PR\n", "record": {"elapsed": {"repr": "0:01:29.403248", "seconds": 89.403248}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1"}, "file": {"name": "github_app.py", "path": "/app/pr_agent/servers/github_app.py"}, "function": "handle_comments_on_pr", "level": {"icon": "â„¹ï¸", "name": "INFO", "no": 20}, "line": 118, "message": "Processing comment on PR api_url='https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1', comment_body=/review Can you please review this PR", "module": "github_app", "name": "pr_agent.servers.github_app", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:14.750644+00:00", "timestamp": 1765332734.750644}}}
2025-12-10T02:12:18.143139919Z {"text": "AI metadata is disabled for this command\n", "record": {"elapsed": {"repr": "0:01:32.795216", "seconds": 92.795216}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1"}, "file": {"name": "pr_reviewer.py", "path": "/app/pr_agent/tools/pr_reviewer.py"}, "function": "__init__", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 75, "message": "AI metadata is disabled for this command", "module": "pr_reviewer", "name": "pr_agent.tools.pr_reviewer", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:18.142612+00:00", "timestamp": 1765332738.142612}}}
2025-12-10T02:12:18.374096285Z {"text": "Reviewing PR: https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1 ...\n", "record": {"elapsed": {"repr": "0:01:33.026343", "seconds": 93.026343}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1"}, "file": {"name": "pr_reviewer.py", "path": "/app/pr_agent/tools/pr_reviewer.py"}, "function": "run", "level": {"icon": "â„¹ï¸", "name": "INFO", "no": 20}, "line": 134, "message": "Reviewing PR: https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1 ...", "module": "pr_reviewer", "name": "pr_agent.tools.pr_reviewer", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:18.373739+00:00", "timestamp": 1765332738.373739}}}
2025-12-10T02:12:18.374952835Z {"text": "Relevant configs\n", "record": {"elapsed": {"repr": "0:01:33.027332", "seconds": 93.027332}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "artifacts": {"pr_reviewer": {"require_score_review": false, "require_tests_review": true, "require_estimate_effort_to_review": true, "require_can_be_split_review": false, "require_security_review": true, "require_estimate_contribution_time_cost": false, "require_todo_scan": false, "require_ticket_analysis_review": true, "publish_output_no_suggestions": true, "persistent_comment": true, "extra_instructions": "", "num_max_findings": 3, "final_update_message": true, "enable_review_labels_security": true, "enable_review_labels_effort": true, "require_all_thresholds_for_incremental_review": false, "minimal_commits_for_incremental_review": 0, "minimal_minutes_for_incremental_review": 0, "enable_intro_text": true, "enable_help_text": false}, "config": {"enable_ai_metadata": false, "custom_model_max_tokens": 200000, "temperature": 1, "model": "openai/gpt-5.1", "fallback_models": "[\\\"openai/gpt-5\\\",\\\"openai/gpt-5-nano\\\"]", "git_provider": "github", "publish_output": true, "publish_output_progress": true, "verbosity_level": 0, "use_extra_bad_extensions": false, "log_level": "DEBUG", "use_wiki_settings_file": true, "use_repo_settings_file": true, "use_global_settings_file": true, "disable_auto_feedback": false, "ai_timeout": 120, "skip_keys": [], "custom_reasoning_model": false, "response_language": "en-US", "max_description_tokens": 500, "max_commits_tokens": 500, "max_model_tokens": 32000, "model_token_count_estimate_factor": 0.3, "patch_extension_skip_types": [".md", ".txt"], "allow_dynamic_context": true, "max_extra_lines_before_dynamic_context": 10, "patch_extra_lines_before": 5, "patch_extra_lines_after": 1, "secret_provider": "", "cli_mode": false, "ai_disclaimer_title": "", "ai_disclaimer": "", "output_relevant_configurations": false, "large_patch_policy": "clip", "duplicate_prompt_examples": false, "seed": -1, "add_repo_metadata": false, "add_repo_metadata_file_list": ["AGENTS.MD", "CLAUDE.MD", "QODO.MD"], "ignore_pr_title": ["^\\[Auto\\]", "^Auto"], "ignore_pr_target_branches": [], "ignore_pr_source_branches": [], "ignore_pr_labels": [], "ignore_pr_authors": [], "ignore_repositories": [], "ignore_language_framework": [], "is_auto_command": false, "reasoning_effort": "medium", "enable_auto_approval": false, "auto_approve_for_low_review_effort": -1, "auto_approve_for_no_suggestions": false, "ensure_ticket_compliance": false, "enable_claude_extended_thinking": false, "extended_thinking_budget_tokens": 2048, "extended_thinking_max_output_tokens": 4096, "enable_custom_labels": false}}}, "file": {"name": "pr_reviewer.py", "path": "/app/pr_agent/tools/pr_reviewer.py"}, "function": "run", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 137, "message": "Relevant configs", "module": "pr_reviewer", "name": "pr_agent.tools.pr_reviewer", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:18.374728+00:00", "timestamp": 1765332738.374728}}}
2025-12-10T02:12:18.375534462Z {"text": "Existing description\n", "record": {"elapsed": {"repr": "0:01:33.027817", "seconds": 93.027817}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "description": "- improved search bar ux in app/search/page.tsx:\r\n  - x icon clears input and refocuses\r\n  - escape key clears input\r\n  - enter key triggers search\r\n\r\n- updated filter count logic:\r\n  - accurately counts all active filters\r\n  - apply button badge reflects true total"}, "file": {"name": "git_provider.py", "path": "/app/pr_agent/git_providers/git_provider.py"}, "function": "get_user_description", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 225, "message": "Existing description", "module": "git_provider", "name": "pr_agent.git_providers.git_provider", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:18.375213+00:00", "timestamp": 1765332738.375213}}}
2025-12-10T02:12:18.375814094Z {"text": "Existing description was not generated by the pr-agent\n", "record": {"elapsed": {"repr": "0:01:33.027907", "seconds": 93.027907}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1"}, "file": {"name": "git_provider.py", "path": "/app/pr_agent/git_providers/git_provider.py"}, "function": "get_user_description", "level": {"icon": "â„¹ï¸", "name": "INFO", "no": 20}, "line": 229, "message": "Existing description was not generated by the pr-agent", "module": "git_provider", "name": "pr_agent.git_providers.git_provider", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:18.375303+00:00", "timestamp": 1765332738.375303}}}
2025-12-10T02:12:18.792449470Z {"text": "Generating prediction with openai/gpt-5.1\n", "record": {"elapsed": {"repr": "0:01:33.444686", "seconds": 93.444686}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1"}, "file": {"name": "pr_processing.py", "path": "/app/pr_agent/algo/pr_processing.py"}, "function": "retry_with_fallback_models", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 326, "message": "Generating prediction with openai/gpt-5.1", "module": "pr_processing", "name": "pr_agent.algo.pr_processing", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:18.792082+00:00", "timestamp": 1765332738.792082}}}
2025-12-10T02:12:19.604946289Z {"text": "PR main language: TypeScript\n", "record": {"elapsed": {"repr": "0:01:34.257210", "seconds": 94.25721}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1"}, "file": {"name": "pr_processing.py", "path": "/app/pr_agent/algo/pr_processing.py"}, "function": "get_pr_diff", "level": {"icon": "â„¹ï¸", "name": "INFO", "no": 20}, "line": 63, "message": "PR main language: TypeScript", "module": "pr_processing", "name": "pr_agent.algo.pr_processing", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:19.604606+00:00", "timestamp": 1765332739.604606}}}
2025-12-10T02:12:19.613070194Z {"text": "Tokens: 4738, total tokens under limit: 32000, returning full diff.\n", "record": {"elapsed": {"repr": "0:01:34.265383", "seconds": 94.265383}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1"}, "file": {"name": "pr_processing.py", "path": "/app/pr_agent/algo/pr_processing.py"}, "function": "get_pr_diff", "level": {"icon": "â„¹ï¸", "name": "INFO", "no": 20}, "line": 74, "message": "Tokens: 4738, total tokens under limit: 32000, returning full diff.", "module": "pr_processing", "name": "pr_agent.algo.pr_processing", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:19.612779+00:00", "timestamp": 1765332739.612779}}}
2025-12-10T02:12:19.613560934Z {"text": "PR diff\n", "record": {"elapsed": {"repr": "0:01:34.265613", "seconds": 94.265613}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "diff": "\n\n## File: 'app/search/page.tsx'\n\n@@ -1,7 +1,8 @@\n__new hunk__\n1  \"use client\"\n2  \n3 +import { useState, useEffect, useMemo, useRef } from \"react\"\n4 +// import { X } from \"lucide-react\"\n5  import { useSearchParams, useRouter } from \"next/navigation\"\n6  import { useQuery } from \"@tanstack/react-query\"\n7  import { Input } from \"@/components/ui/input\"\n8  import { Button } from \"@/components/ui/button\"\n__old hunk__\n \"use client\"\n \n-import { useState, useEffect, useMemo } from \"react\"\n import { useSearchParams, useRouter } from \"next/navigation\"\n import { useQuery } from \"@tanstack/react-query\"\n import { Input } from \"@/components/ui/input\"\n import { Button } from \"@/components/ui/button\"\n\n@@ -41,11 +42,12 @@\n__new hunk__\n42  export default function SearchPage() {\n43    const searchParams = useSearchParams()\n44    const router = useRouter()\n45    const { filters, setFilters, resetFilters } = useFilters()\n46    const { settings } = useSettings()\n47  \n48    const [searchQuery, setSearchQuery] = useState(searchParams.get(\"q\") || filters.q || \"\")\n49 +  const inputRef = useRef<HTMLInputElement>(null);\n50    const [sortBy, setSortBy] = useState<SortOption>(settings.behavior.defaultSort || \"time\")\n51    const [filtersOpen, setFiltersOpen] = useState(false)\n52  \n53    // Update search query from URL params\n\n@@ -75,29 +77,54 @@ export default function SearchPage() {\n__new hunk__\n77        filters.fiberMin > 0 ||\n78        filters.sugarMax < 100 ||\n79        filters.sodiumMax < 4000 ||\n80        filters.maxTime < 120 ||\n81        !!filters.mealType\n82      )\n83    }, [filters])\n84  \n85 +  // const activeFilterCount = useMemo(() => {\n86 +  //   let count = 0\n87 +  //   if (filters.dietaryRestrictions.length > 0) count++\n88 +  //   if (filters.allergens.length > 0) count++\n89 +  //   if (filters.cuisines.length > 0) count++\n90 +  //   if (filters.majorConditions.length > 0) count++\n91 +  //   if (filters.calories[0] > 0 || filters.calories[1] < 1200) count++\n92 +  //   if (filters.proteinMin > 0) count++\n93 +  //   if (filters.carbsMin > 0) count++\n94 +  //   if (filters.fatMin > 0) count++\n95 +  //   if (filters.fiberMin > 0) count++\n96 +  //   if (filters.sugarMax < 100) count++\n97 +  //   if (filters.sodiumMax < 4000) count++\n98 +  //   if (filters.maxTime < 120) count++\n99 +  //   if (filters.mealType) count++\n100 +  //   return count\n101 +  // }, [filters])\n102    const activeFilterCount = useMemo(() => {\n103 +    let count = 0;\n104 +\n105 +  // Sum all selected array filters\n106 +    count += filters.dietaryRestrictions.length;\n107 +    count += filters.allergens.length;\n108 +    count += filters.cuisines.length;\n109 +    count += filters.majorConditions.length;\n110 +\n111 +    // Range and min/max filters\n112 +    if (filters.calories[0] > 0) count++; // Min calories\n113 +    if (filters.calories[1] < 1200) count++; // Max calories\n114 +    if (filters.proteinMin > 0) count++;\n115 +    if (filters.carbsMin > 0) count++;\n116 +    if (filters.fatMin > 0) count++;\n117 +    if (filters.fiberMin > 0) count++;\n118 +    if (filters.sugarMax < 100) count++;\n119 +    if (filters.sodiumMax < 4000) count++;\n120 +    if (filters.maxTime < 120) count++;\n121 +    \n122 +    // Single-value selection\n123 +    if (filters.mealType) count++;\n124 +\n125 +    return count;\n126 +  }, [filters]);\n127  \n128    const {\n129      data: searchResults = [],\n130      isLoading,\n__old hunk__\n       filters.fiberMin > 0 ||\n       filters.sugarMax < 100 ||\n       filters.sodiumMax < 4000 ||\n       filters.maxTime < 120 ||\n       !!filters.mealType\n     )\n   }, [filters])\n \n   const activeFilterCount = useMemo(() => {\n-    let count = 0\n-    if (filters.dietaryRestrictions.length > 0) count++\n-    if (filters.allergens.length > 0) count++\n-    if (filters.cuisines.length > 0) count++\n-    if (filters.majorConditions.length > 0) count++\n-    if (filters.calories[0] > 0 || filters.calories[1] < 1200) count++\n-    if (filters.proteinMin > 0) count++\n-    if (filters.carbsMin > 0) count++\n-    if (filters.fatMin > 0) count++\n-    if (filters.fiberMin > 0) count++\n-    if (filters.sugarMax < 100) count++\n-    if (filters.sodiumMax < 4000) count++\n-    if (filters.maxTime < 120) count++\n-    if (filters.mealType) count++\n-    return count\n-  }, [filters])\n \n   const {\n     data: searchResults = [],\n     isLoading,\n\n@@ -113,12 +140,22 @@ export default function SearchPage() {\n__new hunk__\n140          const rankedResults = rank(rawResults, settings)\n141          return rankedResults\n142        }\n143  \n144        return rawResults.map((recipe) => ({ ...recipe, score: 0 }))\n145      },\n146      enabled: !!(searchQuery || hasActiveFilters),\n147    })\n148 +  const handleSearchInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n149 +    if (e.key === \"Escape\" && searchQuery) {\n150 +      setSearchQuery(\"\");\n151 +      inputRef.current?.focus();\n152 +    }\n153 +    if (e.key === \"Enter\") {\n154 +      handleSearch(searchQuery);\n155 +    }\n156 +  };\n157 +\n158  \n159    const handleSearch = (query: string) => {\n160      setSearchQuery(query)\n161      setFilters({ ...filters, q: query })\n\n@@ -182,13 +219,13 @@ export default function SearchPage() {\n__new hunk__\n219    return (\n220      <div className=\"container px-4 py-6 max-w-6xl\">\n221        <div className=\"space-y-6\">\n222          {/* Search Header */}\n223          <div className=\"space-y-4\">\n224            <h1 className=\"text-3xl font-bold\">Search Recipes</h1>\n225  \n226            {/* Search Input */}\n227 +          {/* <div className=\"relative\">\n228              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n229              <Input\n230                role=\"search\"\n231                placeholder=\"Search recipes, ingredients, cuisines...\"\n__old hunk__\n   return (\n     <div className=\"container px-4 py-6 max-w-6xl\">\n       <div className=\"space-y-6\">\n         {/* Search Header */}\n         <div className=\"space-y-4\">\n           <h1 className=\"text-3xl font-bold\">Search Recipes</h1>\n \n           {/* Search Input */}\n-          <div className=\"relative\">\n             <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n             <Input\n               role=\"search\"\n               placeholder=\"Search recipes, ingredients, cuisines...\"\n\n@@ -192,14 +229,51 @@ export default function SearchPage() {\n__new hunk__\n229              <Input\n230                role=\"search\"\n231                placeholder=\"Search recipes, ingredients, cuisines...\"\n232                value={searchQuery}\n233                onChange={(e) => setSearchQuery(e.target.value)}\n234                onKeyDown={(e) => e.key === \"Enter\" && handleSearch(searchQuery)}\n235                className=\"pl-10 pr-4 h-12 text-lg\"\n236              />\n237 +          </div> */}\n238 +          <div style={{ position: \"relative\", display: \"inline-block\", width: \"100%\" }}>\n239 +            <Search style={{ position: \"absolute\", left: \"0.75rem\", top: \"50%\", transform: \"translateY(-50%)\", height: \"1rem\", width: \"1rem\", color: \"gray\" }} />\n240 +            <Input\n241 +              role=\"search\"\n242 +              ref={inputRef}\n243 +              placeholder=\"Search recipes, ingredients, cuisines...\"\n244 +              value={searchQuery}\n245 +              onChange={(e) => setSearchQuery(e.target.value)}\n246 +              onKeyDown={handleSearchInputKeyDown}\n247 +              style={{ paddingRight: searchQuery ? \"2rem\" : undefined, width: \"100%\" }}\n248 +              className=\"pl-10 pr-4 h-12 text-lg\"\n249 +            />\n250 +            {searchQuery && (\n251 +              <button\n252 +                type=\"button\"\n253 +                style={{\n254 +                  position: \"absolute\",\n255 +                  right: \"0.75rem\",\n256 +                  top: \"50%\",\n257 +                  transform: \"translateY(-50%)\",\n258 +                  background: \"none\",\n259 +                  border: \"none\",\n260 +                  cursor: \"pointer\",\n261 +                  padding: 0,\n262 +                  color: \"gray\",\n263 +                }}\n264 +                aria-label=\"Clear search\"\n265 +                onClick={() => {\n266 +                  setSearchQuery(\"\");\n267 +                  inputRef.current?.focus();\n268 +              }}\n269 +              >\n270 +                <X size={20} />\n271 +            </button>\n272 +          )}\n273            </div>\n274  \n275 +\n276            {/* Search Actions */}\n277            <div className=\"flex items-center gap-2\">\n278              <Button onClick={() => handleSearch(searchQuery)} size=\"sm\">\n279                Search\n\n\n## File: 'components/filter-panel.tsx'\n\n@@ -54,35 +54,58 @@\n__new hunk__\n54  export function FilterPanel({ open, onOpenChange, initialValues, onApply, onReset }: FilterPanelProps) {\n55    const form = useForm<FiltersFormInput>({\n56      resolver: zodResolver(schema),\n57      // provide full defaults (OUTPUT fits into INPUT just fine)\n58      defaultValues: schema.parse(initialValues ?? {}),\n59      mode: \"onChange\",\n60    })\n61  \n62     useEffect(() => {\n63      form.reset(schema.parse(initialValues ?? {}));\n64    }, [open, initialValues, form]);\n65  \n66 +  // function getActiveFiltersCount(): number {\n67 +  //   const values = form.getValues()\n68 +  //   let count = 0\n69 +  //   if ((values.dietaryRestrictions || []).length > 0) count++\n70 +  //   if ((values.allergens || []).length > 0) count++\n71 +  //   if ((values.cuisines || []).length > 0) count++\n72 +  //   if ((values.majorConditions || []).length > 0) count++\n73 +  //   if (values.calories && (values.calories[0] > 0 || values.calories[1] < 1200)) count++\n74 +  //   if ((values.proteinMin || 0) > 0) count++\n75 +  //   if ((values.carbsMin || 0) > 0) count++\n76 +  //   if ((values.fatMin || 0) > 0) count++\n77 +  //   if ((values.fiberMin || 0) > 0) count++\n78 +  //   if ((values.sugarMax || 100) < 100) count++\n79 +  //   if ((values.sodiumMax || 4000) < 4000) count++\n80 +  //   if ((values.maxTime || 120) < 120) count++\n81 +  //   if ((values.mealType || \"\") !== \"\") count++\n82 +  //   return count\n83 +  // }\n84    function getActiveFiltersCount(): number {\n85 +    const values = form.getValues();\n86 +    let count = 0;\n87 +\n88 +    // Count all selected array filters individually\n89 +    count += values.dietaryRestrictions.length;\n90 +    count += values.allergens.length;\n91 +    count += values.cuisines.length;\n92 +    count += values.majorConditions.length;\n93 +\n94 +    // Numeric and single-value filters\n95 +    if (values.calories[0] > 0) count++;           // Min calories\n96 +    if (values.calories[1] < 1200) count++;        // Max calories\n97 +    if (values.proteinMin > 0) count++;\n98 +    if (values.carbsMin > 0) count++;\n99 +    if (values.fatMin > 0) count++;\n100 +    if (values.fiberMin > 0) count++;\n101 +    if (values.sugarMax < 100) count++;\n102 +    if (values.sodiumMax < 4000) count++;\n103 +    if (values.maxTime < 120) count++;\n104 +    if (values.mealType) count++;\n105 +\n106 +    return count;\n107    }\n108    function handleApply() {\n109      const values = schema.parse(form.getValues())\n110      onApply(values)\n111      onOpenChange(false)\n__old hunk__\n export function FilterPanel({ open, onOpenChange, initialValues, onApply, onReset }: FilterPanelProps) {\n   const form = useForm<FiltersFormInput>({\n     resolver: zodResolver(schema),\n     // provide full defaults (OUTPUT fits into INPUT just fine)\n     defaultValues: schema.parse(initialValues ?? {}),\n     mode: \"onChange\",\n   })\n \n    useEffect(() => {\n     form.reset(schema.parse(initialValues ?? {}));\n   }, [open, initialValues, form]);\n \n   function getActiveFiltersCount(): number {\n-    const values = form.getValues()\n-    let count = 0\n-    if ((values.dietaryRestrictions || []).length > 0) count++\n-    if ((values.allergens || []).length > 0) count++\n-    if ((values.cuisines || []).length > 0) count++\n-    if ((values.majorConditions || []).length > 0) count++\n-    if (values.calories && (values.calories[0] > 0 || values.calories[1] < 1200)) count++\n-    if ((values.proteinMin || 0) > 0) count++\n-    if ((values.carbsMin || 0) > 0) count++\n-    if ((values.fatMin || 0) > 0) count++\n-    if ((values.fiberMin || 0) > 0) count++\n-    if ((values.sugarMax || 100) < 100) count++\n-    if ((values.sodiumMax || 4000) < 4000) count++\n-    if ((values.maxTime || 120) < 120) count++\n-    if ((values.mealType || \"\") !== \"\") count++\n-    return count\n   }\n-\n   function handleApply() {\n     const values = schema.parse(form.getValues())\n     onApply(values)\n     onOpenChange(false)"}, "file": {"name": "pr_reviewer.py", "path": "/app/pr_agent/tools/pr_reviewer.py"}, "function": "_prepare_prediction", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 197, "message": "PR diff", "module": "pr_reviewer", "name": "pr_agent.tools.pr_reviewer", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:19.613009+00:00", "timestamp": 1765332739.613009}}}
2025-12-10T02:12:19.627997924Z {"text": "Prompts\n", "record": {"elapsed": {"repr": "0:01:34.279907", "seconds": 94.279907}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "artifact": {"system": "You are PR-Reviewer, a language model designed to review a Git Pull Request (PR).\nYour task is to provide constructive and concise feedback for the PR.\nThe review should focus on new code added in the PR code diff (lines starting with '+')\n\n\nThe format we will use to present the PR code diff:\n======\n## File: 'src/file1.py'\n\n\n@@ ... @@ def func1():\n__new hunk__\n11  unchanged code line0\n12  unchanged code line1\n13 +new code line2 added\n14  unchanged code line3\n__old hunk__\n unchanged code line0\n unchanged code line1\n-old code line2 removed\n unchanged code line3\n\n@@ ... @@ def func2():\n__new hunk__\n unchanged code line4\n+new code line5 added\n unchanged code line6\n\n## File: 'src/file2.py'\n...\n======\n\n- In the format above, the diff is organized into separate '__new hunk__' and '__old hunk__' sections for each code chunk. '__new hunk__' contains the updated code, while '__old hunk__' shows the removed code. If no code was removed in a specific chunk, the __old hunk__ section will be omitted.\n- We also added line numbers for the '__new hunk__' code, to help you refer to the code lines in your suggestions. These line numbers are not part of the actual code, and should only be used for reference.\n- Code lines are prefixed with symbols ('+', '-', ' '). The '+' symbol indicates new code added in the PR, the '-' symbol indicates code removed in the PR, and the ' ' symbol indicates unchanged code. The review should address new code added in the PR code diff (lines starting with '+').\n- When quoting variables, names or file paths from the code, use backticks (`) instead of single quote (').\n- Note that you only see changed code segments (diff hunks in a PR), not the entire codebase. Avoid suggestions that might duplicate existing functionality or questioning code elements (like variables declarations or import statements) that may be defined elsewhere in the codebase.\n- Also note that if the code ends at an opening brace or statement that begins a new scope (like 'if', 'for', 'try'), don't treat it as incomplete. Instead, acknowledge the visible scope boundary and analyze only the code shown.\n\n\nThe output must be a YAML object equivalent to type $PRReview, according to the following Pydantic definitions:\n=====\n\nclass KeyIssuesComponentLink(BaseModel):\n    relevant_file: str = Field(description=\"The full file path of the relevant file\")\n    issue_header: str = Field(description=\"One or two word title for the issue. For example: 'Possible Bug', etc.\")\n    issue_content: str = Field(description=\"A short and concise summary of what should be further inspected and validated during the PR review process for this issue. Do not mention line numbers in this field.\")\n    start_line: int = Field(description=\"The start line that corresponds to this issue in the relevant file\")\n    end_line: int = Field(description=\"The end line that corresponds to this issue in the relevant file\")\n\nclass Review(BaseModel):\n    estimated_effort_to_review_[1-5]: int = Field(description=\"Estimate, on a scale of 1-5 (inclusive), the time and effort required to review this PR by an experienced and knowledgeable developer. 1 means short and easy review , 5 means long and hard review. Take into account the size, complexity, quality, and the needed changes of the PR code diff.\")\n    relevant_tests: str = Field(description=\"yes/no question: does this PR have relevant tests added or updated ?\")\n    key_issues_to_review: List[KeyIssuesComponentLink] = Field(\"A short and diverse list (0-3 issues) of high-priority bugs, problems or performance concerns introduced in the PR code, which the PR reviewer should further focus on and validate during the review process.\")\n    security_concerns: str = Field(description=\"Does this PR code introduce vulnerabilities such as exposure of sensitive information (e.g., API keys, secrets, passwords), or security concerns like SQL injection, XSS, CSRF, and others ? Answer 'No' (without explaining why) if there are no possible issues. If there are security concerns or issues, start your answer with a short header, such as: 'Sensitive information exposure: ...', 'SQL injection: ...', etc. Explain your answer. Be specific and give examples if possible\")\n\nclass PRReview(BaseModel):\n    review: Review\n=====\n\n\nExample output:\n```yaml\nreview:\n  estimated_effort_to_review_[1-5]: |\n    3\n  relevant_tests: |\n    No\n  key_issues_to_review:\n    - relevant_file: |\n        directory/xxx.py\n      issue_header: |\n        Possible Bug\n      issue_content: |\n        ...\n      start_line: 12\n      end_line: 14\n    - ...\n  security_concerns: |\n    No\n```\n\nAnswer should be a valid YAML, and nothing else. Each YAML output MUST be after a newline, with proper indent, and block scalar indicator ('|')", "user": "\n\n\n--PR Info--\n\nToday's Date: 2025-12-10\n\nTitle: 'Fix: Search UX and multi-filter logic (frontend)'\n\nBranch: 'feature/initial-fixes'\n\nPR Description:\n======\n- Improved search bar UX in app/search/page.tsx:\r\n  - X icon clears input and refocuses\r\n  - Escape key clears input\r\n  - Enter key triggers search\r\n\r\n- Updated filter count logic:\r\n  - Accurately counts all active filters\r\n  - Apply button badge reflects true total\n======\n\n\nThe PR code diff:\n======\n## File: 'app/search/page.tsx'\n\n@@ -1,7 +1,8 @@\n__new hunk__\n1  \"use client\"\n2  \n3 +import { useState, useEffect, useMemo, useRef } from \"react\"\n4 +// import { X } from \"lucide-react\"\n5  import { useSearchParams, useRouter } from \"next/navigation\"\n6  import { useQuery } from \"@tanstack/react-query\"\n7  import { Input } from \"@/components/ui/input\"\n8  import { Button } from \"@/components/ui/button\"\n__old hunk__\n \"use client\"\n \n-import { useState, useEffect, useMemo } from \"react\"\n import { useSearchParams, useRouter } from \"next/navigation\"\n import { useQuery } from \"@tanstack/react-query\"\n import { Input } from \"@/components/ui/input\"\n import { Button } from \"@/components/ui/button\"\n\n@@ -41,11 +42,12 @@\n__new hunk__\n42  export default function SearchPage() {\n43    const searchParams = useSearchParams()\n44    const router = useRouter()\n45    const { filters, setFilters, resetFilters } = useFilters()\n46    const { settings } = useSettings()\n47  \n48    const [searchQuery, setSearchQuery] = useState(searchParams.get(\"q\") || filters.q || \"\")\n49 +  const inputRef = useRef<HTMLInputElement>(null);\n50    const [sortBy, setSortBy] = useState<SortOption>(settings.behavior.defaultSort || \"time\")\n51    const [filtersOpen, setFiltersOpen] = useState(false)\n52  \n53    // Update search query from URL params\n\n@@ -75,29 +77,54 @@ export default function SearchPage() {\n__new hunk__\n77        filters.fiberMin > 0 ||\n78        filters.sugarMax < 100 ||\n79        filters.sodiumMax < 4000 ||\n80        filters.maxTime < 120 ||\n81        !!filters.mealType\n82      )\n83    }, [filters])\n84  \n85 +  // const activeFilterCount = useMemo(() => {\n86 +  //   let count = 0\n87 +  //   if (filters.dietaryRestrictions.length > 0) count++\n88 +  //   if (filters.allergens.length > 0) count++\n89 +  //   if (filters.cuisines.length > 0) count++\n90 +  //   if (filters.majorConditions.length > 0) count++\n91 +  //   if (filters.calories[0] > 0 || filters.calories[1] < 1200) count++\n92 +  //   if (filters.proteinMin > 0) count++\n93 +  //   if (filters.carbsMin > 0) count++\n94 +  //   if (filters.fatMin > 0) count++\n95 +  //   if (filters.fiberMin > 0) count++\n96 +  //   if (filters.sugarMax < 100) count++\n97 +  //   if (filters.sodiumMax < 4000) count++\n98 +  //   if (filters.maxTime < 120) count++\n99 +  //   if (filters.mealType) count++\n100 +  //   return count\n101 +  // }, [filters])\n102    const activeFilterCount = useMemo(() => {\n103 +    let count = 0;\n104 +\n105 +  // Sum all selected array filters\n106 +    count += filters.dietaryRestrictions.length;\n107 +    count += filters.allergens.length;\n108 +    count += filters.cuisines.length;\n109 +    count += filters.majorConditions.length;\n110 +\n111 +    // Range and min/max filters\n112 +    if (filters.calories[0] > 0) count++; // Min calories\n113 +    if (filters.calories[1] < 1200) count++; // Max calories\n114 +    if (filters.proteinMin > 0) count++;\n115 +    if (filters.carbsMin > 0) count++;\n116 +    if (filters.fatMin > 0) count++;\n117 +    if (filters.fiberMin > 0) count++;\n118 +    if (filters.sugarMax < 100) count++;\n119 +    if (filters.sodiumMax < 4000) count++;\n120 +    if (filters.maxTime < 120) count++;\n121 +    \n122 +    // Single-value selection\n123 +    if (filters.mealType) count++;\n124 +\n125 +    return count;\n126 +  }, [filters]);\n127  \n128    const {\n129      data: searchResults = [],\n130      isLoading,\n__old hunk__\n       filters.fiberMin > 0 ||\n       filters.sugarMax < 100 ||\n       filters.sodiumMax < 4000 ||\n       filters.maxTime < 120 ||\n       !!filters.mealType\n     )\n   }, [filters])\n \n   const activeFilterCount = useMemo(() => {\n-    let count = 0\n-    if (filters.dietaryRestrictions.length > 0) count++\n-    if (filters.allergens.length > 0) count++\n-    if (filters.cuisines.length > 0) count++\n-    if (filters.majorConditions.length > 0) count++\n-    if (filters.calories[0] > 0 || filters.calories[1] < 1200) count++\n-    if (filters.proteinMin > 0) count++\n-    if (filters.carbsMin > 0) count++\n-    if (filters.fatMin > 0) count++\n-    if (filters.fiberMin > 0) count++\n-    if (filters.sugarMax < 100) count++\n-    if (filters.sodiumMax < 4000) count++\n-    if (filters.maxTime < 120) count++\n-    if (filters.mealType) count++\n-    return count\n-  }, [filters])\n \n   const {\n     data: searchResults = [],\n     isLoading,\n\n@@ -113,12 +140,22 @@ export default function SearchPage() {\n__new hunk__\n140          const rankedResults = rank(rawResults, settings)\n141          return rankedResults\n142        }\n143  \n144        return rawResults.map((recipe) => ({ ...recipe, score: 0 }))\n145      },\n146      enabled: !!(searchQuery || hasActiveFilters),\n147    })\n148 +  const handleSearchInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n149 +    if (e.key === \"Escape\" && searchQuery) {\n150 +      setSearchQuery(\"\");\n151 +      inputRef.current?.focus();\n152 +    }\n153 +    if (e.key === \"Enter\") {\n154 +      handleSearch(searchQuery);\n155 +    }\n156 +  };\n157 +\n158  \n159    const handleSearch = (query: string) => {\n160      setSearchQuery(query)\n161      setFilters({ ...filters, q: query })\n\n@@ -182,13 +219,13 @@ export default function SearchPage() {\n__new hunk__\n219    return (\n220      <div className=\"container px-4 py-6 max-w-6xl\">\n221        <div className=\"space-y-6\">\n222          {/* Search Header */}\n223          <div className=\"space-y-4\">\n224            <h1 className=\"text-3xl font-bold\">Search Recipes</h1>\n225  \n226            {/* Search Input */}\n227 +          {/* <div className=\"relative\">\n228              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n229              <Input\n230                role=\"search\"\n231                placeholder=\"Search recipes, ingredients, cuisines...\"\n__old hunk__\n   return (\n     <div className=\"container px-4 py-6 max-w-6xl\">\n       <div className=\"space-y-6\">\n         {/* Search Header */}\n         <div className=\"space-y-4\">\n           <h1 className=\"text-3xl font-bold\">Search Recipes</h1>\n \n           {/* Search Input */}\n-          <div className=\"relative\">\n             <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n             <Input\n               role=\"search\"\n               placeholder=\"Search recipes, ingredients, cuisines...\"\n\n@@ -192,14 +229,51 @@ export default function SearchPage() {\n__new hunk__\n229              <Input\n230                role=\"search\"\n231                placeholder=\"Search recipes, ingredients, cuisines...\"\n232                value={searchQuery}\n233                onChange={(e) => setSearchQuery(e.target.value)}\n234                onKeyDown={(e) => e.key === \"Enter\" && handleSearch(searchQuery)}\n235                className=\"pl-10 pr-4 h-12 text-lg\"\n236              />\n237 +          </div> */}\n238 +          <div style={{ position: \"relative\", display: \"inline-block\", width: \"100%\" }}>\n239 +            <Search style={{ position: \"absolute\", left: \"0.75rem\", top: \"50%\", transform: \"translateY(-50%)\", height: \"1rem\", width: \"1rem\", color: \"gray\" }} />\n240 +            <Input\n241 +              role=\"search\"\n242 +              ref={inputRef}\n243 +              placeholder=\"Search recipes, ingredients, cuisines...\"\n244 +              value={searchQuery}\n245 +              onChange={(e) => setSearchQuery(e.target.value)}\n246 +              onKeyDown={handleSearchInputKeyDown}\n247 +              style={{ paddingRight: searchQuery ? \"2rem\" : undefined, width: \"100%\" }}\n248 +              className=\"pl-10 pr-4 h-12 text-lg\"\n249 +            />\n250 +            {searchQuery && (\n251 +              <button\n252 +                type=\"button\"\n253 +                style={{\n254 +                  position: \"absolute\",\n255 +                  right: \"0.75rem\",\n256 +                  top: \"50%\",\n257 +                  transform: \"translateY(-50%)\",\n258 +                  background: \"none\",\n259 +                  border: \"none\",\n260 +                  cursor: \"pointer\",\n261 +                  padding: 0,\n262 +                  color: \"gray\",\n263 +                }}\n264 +                aria-label=\"Clear search\"\n265 +                onClick={() => {\n266 +                  setSearchQuery(\"\");\n267 +                  inputRef.current?.focus();\n268 +              }}\n269 +              >\n270 +                <X size={20} />\n271 +            </button>\n272 +          )}\n273            </div>\n274  \n275 +\n276            {/* Search Actions */}\n277            <div className=\"flex items-center gap-2\">\n278              <Button onClick={() => handleSearch(searchQuery)} size=\"sm\">\n279                Search\n\n\n## File: 'components/filter-panel.tsx'\n\n@@ -54,35 +54,58 @@\n__new hunk__\n54  export function FilterPanel({ open, onOpenChange, initialValues, onApply, onReset }: FilterPanelProps) {\n55    const form = useForm<FiltersFormInput>({\n56      resolver: zodResolver(schema),\n57      // provide full defaults (OUTPUT fits into INPUT just fine)\n58      defaultValues: schema.parse(initialValues ?? {}),\n59      mode: \"onChange\",\n60    })\n61  \n62     useEffect(() => {\n63      form.reset(schema.parse(initialValues ?? {}));\n64    }, [open, initialValues, form]);\n65  \n66 +  // function getActiveFiltersCount(): number {\n67 +  //   const values = form.getValues()\n68 +  //   let count = 0\n69 +  //   if ((values.dietaryRestrictions || []).length > 0) count++\n70 +  //   if ((values.allergens || []).length > 0) count++\n71 +  //   if ((values.cuisines || []).length > 0) count++\n72 +  //   if ((values.majorConditions || []).length > 0) count++\n73 +  //   if (values.calories && (values.calories[0] > 0 || values.calories[1] < 1200)) count++\n74 +  //   if ((values.proteinMin || 0) > 0) count++\n75 +  //   if ((values.carbsMin || 0) > 0) count++\n76 +  //   if ((values.fatMin || 0) > 0) count++\n77 +  //   if ((values.fiberMin || 0) > 0) count++\n78 +  //   if ((values.sugarMax || 100) < 100) count++\n79 +  //   if ((values.sodiumMax || 4000) < 4000) count++\n80 +  //   2025-12-10T02:12:19.627997924Z if ((values.maxTime || 120) < 120) count++\n81 +  //   if ((values.mealType || \"\") !== \"\") count++\n82 +  //   return count\n83 +  // }\n84    function getActiveFiltersCount(): number {\n85 +    const values = form.getValues();\n86 +    let count = 0;\n87 +\n88 +    // Count all selected array filters individually\n89 +    count += values.dietaryRestrictions.length;\n90 +    count += values.allergens.length;\n91 +    count += values.cuisines.length;\n92 +    count += values.majorConditions.length;\n93 +\n94 +    // Numeric and single-value filters\n95 +    if (values.calories[0] > 0) count++;           // Min calories\n96 +    if (values.calories[1] < 1200) count++;        // Max calories\n97 +    if (values.proteinMin > 0) count++;\n98 +    if (values.carbsMin > 0) count++;\n99 +    if (values.fatMin > 0) count++;\n100 +    if (values.fiberMin > 0) count++;\n101 +    if (values.sugarMax < 100) count++;\n102 +    if (values.sodiumMax < 4000) count++;\n103 +    if (values.maxTime < 120) count++;\n104 +    if (values.mealType) count++;\n105 +\n106 +    return count;\n107    }\n108    function handleApply() {\n109      const values = schema.parse(form.getValues())\n110      onApply(values)\n111      onOpenChange(false)\n__old hunk__\n export function FilterPanel({ open, onOpenChange, initialValues, onApply, onReset }: FilterPanelProps) {\n   const form = useForm<FiltersFormInput>({\n     resolver: zodResolver(schema),\n     // provide full defaults (OUTPUT fits into INPUT just fine)\n     defaultValues: schema.parse(initialValues ?? {}),\n     mode: \"onChange\",\n   })\n \n    useEffect(() => {\n     form.reset(schema.parse(initialValues ?? {}));\n   }, [open, initialValues, form]);\n \n   function getActiveFiltersCount(): number {\n-    const values = form.getValues()\n-    let count = 0\n-    if ((values.dietaryRestrictions || []).length > 0) count++\n-    if ((values.allergens || []).length > 0) count++\n-    if ((values.cuisines || []).length > 0) count++\n-    if ((values.majorConditions || []).length > 0) count++\n-    if (values.calories && (values.calories[0] > 0 || values.calories[1] < 1200)) count++\n-    if ((values.proteinMin || 0) > 0) count++\n-    if ((values.carbsMin || 0) > 0) count++\n-    if ((values.fatMin || 0) > 0) count++\n-    if ((values.fiberMin || 0) > 0) count++\n-    if ((values.sugarMax || 100) < 100) count++\n-    if ((values.sodiumMax || 4000) < 4000) count++\n-    if ((values.maxTime || 120) < 120) count++\n-    if ((values.mealType || \"\") !== \"\") count++\n-    return count\n   }\n-\n   function handleApply() {\n     const values = schema.parse(form.getValues())\n     onApply(values)\n     onOpenChange(false)\n======\n\n\nResponse (should be a valid YAML, and nothing else):\n```yaml"}}, "file": {"name": "litellm_ai_handler.py", "path": "/app/pr_agent/algo/ai_handlers/litellm_ai_handler.py"}, "function": "chat_completion", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 383, "message": "Prompts", "module": "litellm_ai_handler", "name": "pr_agent.algo.ai_handlers.litellm_ai_handler", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:19.627303+00:00", "timestamp": 1765332739.627303}}}
2025-12-10T02:12:19.849226318Z {"text": "Received a GitHub webhook\n", "record": {"elapsed": {"repr": "0:01:33.970737", "seconds": 93.970737}, "exception": null, "extra": {}, "file": {"name": "github_app.py", "path": "/app/pr_agent/servers/github_app.py"}, "function": "handle_github_webhooks", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 45, "message": "Received a GitHub webhook", "module": "github_app", "name": "pr_agent.servers.github_app", "process": {"id": 28, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:19.848898+00:00", "timestamp": 1765332739.848898}}}
2025-12-10T02:12:19.894852169Z {"text": "Handling request with event: issue_comment, action: created\n", "record": {"elapsed": {"repr": "0:01:34.016372", "seconds": 94.016372}, "exception": null, "extra": {}, "file": {"name": "github_app.py", "path": "/app/pr_agent/servers/github_app.py"}, "function": "handle_request", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 321, "message": "Handling request with event: issue_comment, action: created", "module": "github_app", "name": "pr_agent.servers.github_app", "process": {"id": 28, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:19.894533+00:00", "timestamp": 1765332739.894533}}}
2025-12-10T02:12:19.895730351Z {"text": "Request body\n", "record": {"elapsed": {"repr": "0:01:34.017182", "seconds": 94.017182}, "exception": null, "extra": {"artifact": {"action": "created", "issue": {"url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/1", "repository_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend", "labels_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/1/labels{/name}", "comments_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/1/comments", "events_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/1/events", "html_url": "https://github.com/souravOD/nutri-b2c-frontend/pull/1", "id": 3527983986, "node_id": "PR_kwDOQEZhKM6uaI7J", "number": 1, "title": "Fix: Search UX and multi-filter logic (frontend)", "user": {"login": "NamanOdysseyts", "id": 238778617, "node_id": "U_kgDODjt4-Q", "avatar_url": "https://avatars.githubusercontent.com/u/238778617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NamanOdysseyts", "html_url": "https://github.com/NamanOdysseyts", "followers_url": "https://api.github.com/users/NamanOdysseyts/followers", "following_url": "https://api.github.com/users/NamanOdysseyts/following{/other_user}", "gists_url": "https://api.github.com/users/NamanOdysseyts/gists{/gist_id}", "starred_url": "https://api.github.com/users/NamanOdysseyts/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NamanOdysseyts/subscriptions", "organizations_url": "https://api.github.com/users/NamanOdysseyts/orgs", "repos_url": "https://api.github.com/users/NamanOdysseyts/repos", "events_url": "https://api.github.com/users/NamanOdysseyts/events{/privacy}", "received_events_url": "https://api.github.com/users/NamanOdysseyts/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 9561404867, "node_id": "LA_kwDOQEZhKM8AAAACOed1ww", "url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/labels/Review%20effort%202/5", "name": "Review effort 2/5", "color": "d1bcf9", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 61, "created_at": "2025-10-18T02:45:21Z", "updated_at": "2025-12-10T02:12:18Z", "closed_at": null, "author_association": "COLLABORATOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "html_url": "https://github.com/souravOD/nutri-b2c-frontend/pull/1", "diff_url": "https://github.com/souravOD/nutri-b2c-frontend/pull/1.diff", "patch_url": "https://github.com/souravOD/nutri-b2c-frontend/pull/1.patch", "merged_at": null}, "body": "- Improved search bar UX in app/search/page.tsx:\r\n  - X icon clears input and refocuses\r\n  - Escape key clears input\r\n  - Enter key triggers search\r\n\r\n- Updated filter count logic:\r\n  - Accurately counts all active filters\r\n  - Apply button badge reflects true total", "reactions": {"url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/1/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/1/timeline", "performed_via_github_app": null, "state_reason": null}, "comment": {"url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/comments/3635052863", "html_url": "https://github.com/souravOD/nutri-b2c-frontend/pull/1#issuecomment-3635052863", "issue_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/1", "id": 3635052863, "node_id": "IC_kwDOQEZhKM7YqoE_", "user": {"login": "confersolutions-pr-agent-testing[bot]", "id": 241213316, "node_id": "BOT_kgDODmCfhA", "avatar_url": "https://avatars.githubusercontent.com/u/238303722?v=4", "gravatar_id": "", "url": "https://api.github.com/users/confersolutions-pr-agent-testing%5Bbot%5D", "html_url": "https://github.com/apps/confersolutions-pr-agent-testing", "followers_url": "https://api.github.com/users/confersolutions-pr-agent-testing%5Bbot%5D/followers", "following_url": "https://api.github.com/users/confersolutions-pr-agent-testing%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/confersolutions-pr-agent-testing%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/confersolutions-pr-agent-testing%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/confersolutions-pr-agent-testing%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/confersolutions-pr-agent-testing%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/confersolutions-pr-agent-testing%5Bbot%5D/repos", "events_url": "https://api.github.com/users/confersolutions-pr-agent-testing%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/confersolutions-pr-agent-testing%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "created_at": "2025-12-10T02:12:18Z", "updated_at": "2025-12-10T02:12:18Z", "body": "Preparing review...", "author_association": "NONE", "reactions": {"url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/comments/3635052863/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "performed_via_github_app": {"id": 2209305, "client_id": "Iv23li7bKiGgGVtVjmWH", "slug": "confersolutions-pr-agent-testing", "node_id": "A_kwDODjQ56s4AIbYZ", "owner": {"login": "souravOD", "id": 238303722, "node_id": "U_kgDODjQ56g", "avatar_url": "https://avatars.githubusercontent.com/u/238303722?v=4", "gravatar_id": "", "url": "https://api.github.com/users/souravOD", "html_url": "https://github.com/souravOD", "followers_url": "https://api.github.com/users/souravOD/followers", "following_url": "https://api.github.com/users/souravOD/following{/other_user}", "gists_url": "https://api.github.com/users/souravOD/gists{/gist_id}", "starred_url": "https://api.github.com/users/souravOD/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/souravOD/subscriptions", "organizations_url": "https://api.github.com/users/souravOD/orgs", "repos_url": "https://api.github.com/users/souravOD/repos", "events_url": "https://api.github.com/users/souravOD/events{/privacy}", "received_events_url": "https://api.github.com/users/souravOD/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "name": "confersolutions-pr-agent-testing", "description": "", "external_url": "https://app.affine.pro/workspace/5faca6c6-75a5-4a38-a457-467462b9e9bd/4tBJ2igTRqph8VLY69JYh", "html_url": "https://github.com/apps/confersolutions-pr-agent-testing", "created_at": "2025-10-30T23:17:56Z", "updated_at": "2025-12-04T21:49:27Z", "permissions": {"actions": "read", "checks": "read", "contents": "read", "issues": "write", "metadata": "read", "pull_requests": "write", "statuses": "read"}, "events": ["commit_comment", "issues", "issue_comment", "merge_queue_entry", "pull_request", "pull_request_review", "pull_request_review_comment", "pull_request_review_thread", "push"]}}, "repository": {"id": 1078354216, "node_id": "R_kgDOQEZhKA", "name": "nutri-b2c-frontend", "full_name": "souravOD/nutri-b2c-frontend", "private": false, "owner": {"login": "souravOD", "id": 238303722, "node_id": "U_kgDODjQ56g", "avatar_url": "https://avatars.githubusercontent.com/u/238303722?v=4", "gravatar_id": "", "url": "https://api.github.com/users/souravOD", "html_url": "https://github.com/souravOD", "followers_url": "https://api.github.com/users/souravOD/followers", "following_url": "https://api.github.com/users/souravOD/following{/other_user}", "gists_url": "https://api.github.com/users/souravOD/gists{/gist_id}", "starred_url": "https://api.github.com/users/souravOD/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/souravOD/subscriptions", "organizations_url": "https://api.github.com/users/souravOD/orgs", "repos_url": "https://api.github.com/users/souravOD/repos", "events_url": "https://api.github.com/users/souravOD/events{/privacy}", "received_events_url": "https://api.github.com/users/souravOD/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "html_url": "https://github.com/souravOD/nutri-b2c-frontend", "description": null, "fork": true, "url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend", "forks_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/forks", "keys_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/keys{/key_id}", "collaborators_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/collaborators{/collaborator}", "teams_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/teams", "hooks_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/hooks", "issue_events_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/events{/number}", "events_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/events", "assignees_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/assignees{/user}", "branches_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/branches{/branch}", "tags_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/tags", "blobs_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/git/blobs{/sha}", "git_tags_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/git/tags{/sha}", "git_refs_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/git/refs{/sha}", "trees_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/git/trees{/sha}", "statuses_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/statuses/{sha}", "languages_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/languages", "stargazers_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/stargazers", "contributors_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/contributors", "subscribers_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/subscribers", "subscription_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/subscription", "commits_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/commits{/sha}", "git_commits_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/git/commits{/sha}", "comments_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/comments{/number}", "issue_comment_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues/comments{/number}", "contents_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/contents/{+path}", "compare_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/compare/{base}...{head}", "merges_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/merges", "archive_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/{archive_format}{/ref}", "downloads_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/downloads", "issues_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/issues{/number}", "pulls_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls{/number}", "milestones_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/milestones{/number}", "notifications_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/notifications{?since,all,participating}", "labels_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/labels{/name}", "releases_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/releases{/id}", "deployments_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/deployments", "created_at": "2025-10-17T15:44:00Z", "updated_at": "2025-11-14T04:02:00Z", "pushed_at": "2025-10-16T19:32:39Z", "git_url": "git://github.com/souravOD/nutri-b2c-frontend.git", "ssh_url": "git@github.com:souravOD/nutri-b2c-frontend.git", "clone_url": "https://github.com/souravOD/nutri-b2c-frontend.git", "svn_url": "https://github.com/souravOD/nutri-b2c-frontend", "homepage": "https://v0-next-js-app-requirements-omega.vercel.app", "size": 11387, "stargazers_count": 0, "watchers_count": 0, "language": null, "has_issues": false, "has_projects": true, "has_downloads": true, "has_wiki": false, "has_pages": false, "has_discussions": false, "forks_count": 1, "mirror_url": null, "archived": false, "disabled": false, "open_issues_count": 2, "license": null, "allow_forking": true, "is_template": false, "web_commit_signoff_required": false, "topics": [], "visibility": "public", "forks": 1, "open_issues": 2, "watchers": 0, "default_branch": "main"}, "sender": {"login": "confersolutions-pr-agent-testing[bot]", "id": 241213316, "node_id": "BOT_kgDODmCfhA", "avatar_url": "https://avatars.githubusercontent.com/u/238303722?v=4", "gravatar_id": "", "url": "https://api.github.com/users/confersolutions-pr-agent-testing%5Bbot%5D", "html_url": "https://github.com/apps/confersolutions-pr-agent-testing", "followers_url": "https://api.github.com/users/confersolutions-pr-agent-testing%5Bbot%5D/followers", "following_url": "https://api.github.com/users/confersolutions-pr-agent-testing%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/confersolutions-pr-agent-testing%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/confersolutions-pr-agent-testing%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/confersolutions-pr-agent-testing%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/confersolutions-pr-agent-testing%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/confersolutions-pr-agent-testing%5Bbot%5D/repos", "events_url": "https://api.github.com/users/confersolutions-pr-agent-testing%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/confersolutions-pr-agent-testing%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "installation": {"id": 92375808, "node_id": "MDIzOkludGVncmF0aW9uSW5zdGFsbGF0aW9uOTIzNzU4MDg="}}, "event": "issue_comment"}, "file": {"name": "github_app.py", "path": "/app/pr_agent/servers/github_app.py"}, "function": "handle_request", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 342, "message": "Request body", "module": "github_app", "name": "pr_agent.servers.github_app", "process": {"id": 28, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:19.895343+00:00", "timestamp": 1765332739.895343}}}
2025-12-10T02:12:19.895838835Z {"text": "Ignoring comment not starting with /\n", "record": {"elapsed": {"repr": "0:01:34.017358", "seconds": 94.017358}, "exception": null, "extra": {}, "file": {"name": "github_app.py", "path": "/app/pr_agent/servers/github_app.py"}, "function": "handle_comments_on_pr", "level": {"icon": "â„¹ï¸", "name": "INFO", "no": 20}, "line": 96, "message": "Ignoring comment not starting with /", "module": "github_app", "name": "pr_agent.servers.github_app", "process": {"id": 28, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:19.895519+00:00", "timestamp": 1765332739.895519}}}
2025-12-10T02:12:20.248840597Z 
2025-12-10T02:12:20.248898084Z Give Feedback / Get Help: https://github.com/BerriAI/litellm/issues/new
2025-12-10T02:12:20.248919968Z LiteLLM.Info: If you need to debug this error, use `litellm._turn_on_debug()'.
2025-12-10T02:12:20.248922301Z 
2025-12-10T02:12:20.248926427Z {"text": "Error during LLM inference: litellm.AuthenticationError: AuthenticationError: OpenAIException - team not allowed to access model. This team can only access models=['openai/gpt-5.1', 'openai/gpt-5', 'openai/gpt-5-mini', 'openai/gpt-5-nano']. Tried to access gpt-5.1\n", "record": {"elapsed": {"repr": "0:01:34.900979", "seconds": 94.900979}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1"}, "file": {"name": "litellm_ai_handler.py", "path": "/app/pr_agent/algo/ai_handlers/litellm_ai_handler.py"}, "function": "chat_completion", "level": {"icon": "âš ï¸", "name": "WARNING", "no": 30}, "line": 396, "message": "Error during LLM inference: litellm.AuthenticationError: AuthenticationError: OpenAIException - team not allowed to access model. This team can only access models=['openai/gpt-5.1', 'openai/gpt-5', 'openai/gpt-5-mini', 'openai/gpt-5-nano']. Tried to access gpt-5.1", "module": "litellm_ai_handler", "name": "pr_agent.algo.ai_handlers.litellm_ai_handler", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.248375+00:00", "timestamp": 1765332740.248375}}}
2025-12-10T02:12:20.252267272Z {"text": "Prompts\n", "record": {"elapsed": {"repr": "0:01:34.904091", "seconds": 94.904091}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "artifact": {"system": "You are PR-Reviewer, a language model designed to review a Git Pull Request (PR).\nYour task is to provide constructive and concise feedback for the PR.\nThe review should focus on new code added in the PR code diff (lines starting with '+')\n\n\nThe format we will use to present the PR code diff:\n======\n## File: 'src/file1.py'\n\n\n@@ ... @@ def func1():\n__new hunk__\n11  unchanged code line0\n12  unchanged code line1\n13 +new code line2 added\n14  unchanged code line3\n__old hunk__\n unchanged code line0\n unchanged code line1\n-old code line2 removed\n unchanged code line3\n\n@@ ... @@ def func2():\n__new hunk__\n unchanged code line4\n+new code line5 added\n unchanged code line6\n\n## File: 'src/file2.py'\n...\n======\n\n- In the format above, the diff is organized into separate '__new hunk__' and '__old hunk__' sections for each code chunk. '__new hunk__' contains the updated code, while '__old hunk__' shows the removed code. If no code was removed in a specific chunk, the __old hunk__ section will be omitted.\n- We also added line numbers for the '__new hunk__' code, to help you refer to the code lines in your suggestions. These line numbers are not part of the actual code, and should only be used for reference.\n- Code lines are prefixed with symbols ('+', '-', ' '). The '+' symbol indicates new code added in the PR, the '-' symbol indicates code removed in the PR, and the ' ' symbol indicates unchanged code. The review should address new code added in the PR code diff (lines starting with '+').\n- When quoting variables, names or file paths from the code, use backticks (`) instead of single quote (').\n- Note that you only see changed code segments (diff hunks in a PR), not the entire codebase. Avoid suggestions that might duplicate existing functionality or questioning code elements (like variables declarations or import statements) that may be defined elsewhere in the codebase.\n- Also note that if the code ends at an opening brace or statement that begins a new scope (like 'if', 'for', 'try'), don't treat it as incomplete. Instead, acknowledge the visible scope boundary and analyze only the code shown.\n\n\nThe output must be a YAML object equivalent to type $PRReview, according to the following Pydantic definitions:\n=====\n\nclass KeyIssuesComponentLink(BaseModel):\n    relevant_file: str = Field(description=\"The full file path of the relevant file\")\n    issue_header: str = Field(description=\"One or two word title for the issue. For example: 'Possible Bug', etc.\")\n    issue_content: str = Field(description=\"A short and concise summary of what should be further inspected and validated during the PR review process for this issue. Do not mention line numbers in this field.\")\n    start_line: int = Field(description=\"The start line that corresponds to this issue in the relevant file\")\n    end_line: int = Field(description=\"The end line that corresponds to this issue in the relevant file\")\n\nclass Review(BaseModel):\n    estimated_effort_to_review_[1-5]: int = Field(description=\"Estimate, on a scale of 1-5 (inclusive), the time and effort required to review this PR by an experienced and knowledgeable developer. 1 means short and easy review , 5 means long and hard review. Take into account the size, complexity, quality, and the needed changes of the PR code diff.\")\n    relevant_tests: str = Field(description=\"yes/no question: does this PR have relevant tests added or updated ?\")\n    key_issues_to_review: List[KeyIssuesComponentLink] = Field(\"A short and diverse list (0-3 issues) of high-priority bugs, problems or performance concerns introduced in the PR code, which the PR reviewer should further focus on and validate during the review process.\")\n    security_concerns: str = Field(description=\"Does this PR code introduce vulnerabilities such as exposure of sensitive information (e.g., API keys, secrets, passwords), or security concerns like SQL injection, XSS, CSRF, and others ? Answer 'No' (without explaining why) if there are no possible issues. If there are security concerns or issues, start your answer with a short header, such as: 'Sensitive information exposure: ...', 'SQL injection: ...', etc. Explain your answer. Be specific and give examples if possible\")\n\nclass PRReview(BaseModel):\n    review: Review\n=====\n\n\nExample output:\n```yaml\nreview:\n  estimated_effort_to_review_[1-5]: |\n    3\n  relevant_tests: |\n    No\n  key_issues_to_review:\n    - relevant_file: |\n        directory/xxx.py\n      issue_header: |\n        Possible Bug\n      issue_content: |\n        ...\n      start_line: 12\n      end_line: 14\n    - ...\n  security_concerns: |\n    No\n```\n\nAnswer should be a valid YAML, and nothing else. Each YAML output MUST be after a newline, with proper indent, and block scalar indicator ('|')", "user": "\n\n\n--PR Info--\n\nToday's Date: 2025-12-10\n\nTitle: 'Fix: Search UX and multi-filter logic (frontend)'\n\nBranch: 'feature/initial-fixes'\n\nPR Description:\n======\n- Improved search bar UX in app/search/page.tsx:\r\n  - X icon clears input and refocuses\r\n  - Escape key clears input\r\n  - Enter key triggers search\r\n\r\n- Updated filter count logic:\r\n  - Accurately counts all active filters\r\n  - Apply button badge reflects true total\n======\n\n\nThe PR code diff:\n======\n## File: 'app/search/page.tsx'\n\n@@ -1,7 +1,8 @@\n__new hunk__\n1  \"use client\"\n2  \n3 +import { useState, useEffect, useMemo, useRef } from \"react\"\n4 +// import { X } from \"lucide-react\"\n5  import { useSearchParams, useRouter } from \"next/navigation\"\n6  import { useQuery } from \"@tanstack/react-query\"\n7  import { Input } from \"@/components/ui/input\"\n8  import { Button } from \"@/components/ui/button\"\n__old hunk__\n \"use client\"\n \n-import { useState, useEffect, useMemo } from \"react\"\n import { useSearchParams, useRouter } from \"next/navigation\"\n import { useQuery } from \"@tanstack/react-query\"\n import { Input } from \"@/components/ui/input\"\n import { Button } from \"@/components/ui/button\"\n\n@@ -41,11 +42,12 @@\n__new hunk__\n42  export default function SearchPage() {\n43    const searchParams = useSearchParams()\n44    const router = useRouter()\n45    const { filters, setFilters, resetFilters } = useFilters()\n46    const { settings } = useSettings()\n47  \n48    const [searchQuery, setSearchQuery] = useState(searchParams.get(\"q\") || filters.q || \"\")\n49 +  const inputRef = useRef<HTMLInputElement>(null);\n50    const [sortBy, setSortBy] = useState<SortOption>(settings.behavior.defaultSort || \"time\")\n51    const [filtersOpen, setFiltersOpen] = useState(false)\n52  \n53    // Update search query from URL params\n\n@@ -75,29 +77,54 @@ export default function SearchPage() {\n__new hunk__\n77        filters.fiberMin > 0 ||\n78        filters.sugarMax < 100 ||\n79        filters.sodiumMax < 4000 ||\n80        filters.maxTime < 120 ||\n81        !!filters.mealType\n82      )\n83    }, [filters])\n84  \n85 +  // const activeFilterCount = useMemo(() => {\n86 +  //   let count = 0\n87 +  //   if (filters.dietaryRestrictions.length > 0) count++\n88 +  //   if (filters.allergens.length > 0) count++\n89 +  //   if (filters.cuisines.length > 0) count++\n90 +  //   if (filters.majorConditions.length > 0) count++\n91 +  //   if (filters.calories[0] > 0 || filters.calories[1] < 1200) count++\n92 +  //   if (filters.proteinMin > 0) count++\n93 +  //   if (filters.carbsMin > 0) count++\n94 +  //   if (filters.fatMin > 0) count++\n95 +  //   if (filters.fiberMin > 0) count++\n96 +  //   if (filters.sugarMax < 100) count++\n97 +  //   if (filters.sodiumMax < 4000) count++\n98 +  //   if (filters.maxTime < 120) count++\n99 +  //   if (filters.mealType) count++\n100 +  //   return count\n101 +  // }, [filters])\n102    const activeFilterCount = useMemo(() => {\n103 +    let count = 0;\n104 +\n105 +  // Sum all selected array filters\n106 +    count += filters.dietaryRestrictions.length;\n107 +    count += filters.allergens.length;\n108 +    count += filters.cuisines.length;\n109 +    count += filters.majorConditions.length;\n110 +\n111 +    // Range and min/max filters\n112 +    if (filters.calories[0] > 0) count++; // Min calories\n113 +    if (filters.calories[1] < 1200) count++; // Max calories\n114 +    if (filters.proteinMin > 0) count++;\n115 +    if (filters.carbsMin > 0) count++;\n116 +    if (filters.fatMin > 0) count++;\n117 +    if (filters.fiberMin > 0) count++;\n118 +    if (filters.sugarMax < 100) count++;\n119 +    if (filters.sodiumMax < 4000) count++;\n120 +    if (filters.maxTime < 120) count++;\n121 +    \n122 +    // Single-value selection\n123 +    if (filters.mealType) count++;\n124 +\n125 +    return count;\n126 +  }, [filters]);\n127  \n128    const {\n129      data: searchResults = [],\n130      isLoading,\n__old hunk__\n       filters.fiberMin > 0 ||\n       filters.sugarMax < 100 ||\n       filters.sodiumMax < 4000 ||\n       filters.maxTime < 120 ||\n       !!filters.mealType\n     )\n   }, [filters])\n \n   const activeFilterCount = useMemo(() => {\n-    let count = 0\n-    if (filters.dietaryRestrictions.length > 0) count++\n-    if (filters.allergens.length > 0) count++\n-    if (filters.cuisines.length > 0) count++\n-    if (filters.majorConditions.length > 0) count++\n-    if (filters.calories[0] > 0 || filters.calories[1] < 1200) count++\n-    if (filters.proteinMin > 0) count++\n-    if (filters.carbsMin > 0) count++\n-    if (filters.fatMin > 0) count++\n-    if (filters.fiberMin > 0) count++\n-    if (filters.sugarMax < 100) count++\n-    if (filters.sodiumMax < 4000) count++\n-    if (filters.maxTime < 120) count++\n-    if (filters.mealType) count++\n-    return count\n-  }, [filters])\n \n   const {\n     data: searchResults = [],\n     isLoading,\n\n@@ -113,12 +140,22 @@ export default function SearchPage() {\n__new hunk__\n140          const rankedResults = rank(rawResults, settings)\n141          return rankedResults\n142        }\n143  \n144        return rawResults.map((recipe) => ({ ...recipe, score: 0 }))\n145      },\n146      enabled: !!(searchQuery || hasActiveFilters),\n147    })\n148 +  const handleSearchInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n149 +    if (e.key === \"Escape\" && searchQuery) {\n150 +      setSearchQuery(\"\");\n151 +      inputRef.current?.focus();\n152 +    }\n153 +    if (e.key === \"Enter\") {\n154 +      handleSearch(searchQuery);\n155 +    }\n156 +  };\n157 +\n158  \n159    const handleSearch = (query: string) => {\n160      setSearchQuery(query)\n161      setFilters({ ...filters, q: query })\n\n@@ -182,13 +219,13 @@ export default function SearchPage() {\n__new hunk__\n219    return (\n220      <div className=\"container px-4 py-6 max-w-6xl\">\n221        <div className=\"space-y-6\">\n222          {/* Search Header */}\n223          <div className=\"space-y-4\">\n224            <h1 className=\"text-3xl font-bold\">Search Recipes</h1>\n225  \n226            {/* Search Input */}\n227 +          {/* <div className=\"relative\">\n228              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n229              <Input\n230                role=\"search\"\n231                placeholder=\"Search recipes, ingredients, cuisines...\"\n__old hunk__\n   return (\n     <div className=\"container px-4 py-6 max-w-6xl\">\n       <div className=\"space-y-6\">\n         {/* Search Header */}\n         <div className=\"space-y-4\">\n           <h1 className=\"text-3xl font-bold\">Search Recipes</h1>\n \n           {/* Search Input */}\n-          <div className=\"relative\">\n             <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n             <Input\n               role=\"search\"\n               placeholder=\"Search recipes, ingredients, cuisines...\"\n\n@@ -192,14 +229,51 @@ export default function SearchPage() {\n__new hunk__\n229              <Input\n230                role=\"search\"\n231                placeholder=\"Search recipes, ingredients, cuisines...\"\n232                value={searchQuery}\n233                onChange={(e) => setSearchQuery(e.target.value)}\n234                onKeyDown={(e) => e.key === \"Enter\" && handleSearch(searchQuery)}\n235                className=\"pl-10 pr-4 h-12 text-lg\"\n236              />\n237 +          </div> */}\n238 +          <div style={{ position: \"relative\", display: \"inline-block\", width: \"100%\" }}>\n239 +            <Search style={{ position: \"absolute\", left: \"0.75rem\", top: \"50%\", transform: \"translateY(-50%)\", height: \"1rem\", width: \"1rem\", color: \"gray\" }} />\n240 +            <Input\n241 +              role=\"search\"\n242 +              ref={inputRef}\n243 +              placeholder=\"Search recipes, ingredients, cuisines...\"\n244 +              value={searchQuery}\n245 +              onChange={(e) => setSearchQuery(e.target.value)}\n246 +              onKeyDown={handleSearchInputKeyDown}\n247 +              style={{ paddingRight: searchQuery ? \"2rem\" : undefined, width: \"100%\" }}\n248 +              className=\"pl-10 pr-4 h-12 text-lg\"\n249 +            />\n250 +            {searchQuery && (\n251 +              <button\n252 +                type=\"button\"\n253 +                style={{\n254 +                  position: \"absolute\",\n255 +                  right: \"0.75rem\",\n256 +                  top: \"50%\",\n257 +                  transform: \"translateY(-50%)\",\n258 +                  background: \"none\",\n259 +                  border: \"none\",\n260 +                  cursor: \"pointer\",\n261 +                  padding: 0,\n262 +                  color: \"gray\",\n263 +                }}\n264 +                aria-label=\"Clear search\"\n265 +                onClick={() => {\n266 +                  setSearchQuery(\"\");\n267 +                  inputRef.current?.focus();\n268 +              }}\n269 +              >\n270 +                <X size={20} />\n271 +            </button>\n272 +          )}\n273            </div>\n274  \n275 +\n276            {/* Search Actions */}\n277            <div className=\"flex items-center gap-2\">\n278              <Button onClick={() => handleSearch(searchQuery)} size=\"sm\">\n279                Search\n\n\n## File: 'components/filter-panel.tsx'\n\n@@ -54,35 +54,58 @@\n__new hunk__\n54  export function FilterPanel({ open, onOpenChange, initialValues, onApply, onReset }: FilterPanelProps) {\n55    const form = useForm<FiltersFormInput>({\n56      resolver: zodResolver(schema),\n57      // provide full defaults (OUTPUT fits into INPUT just fine)\n58      defaultValues: schema.parse(initialValues ?? {}),\n59      mode: \"onChange\",\n60    })\n61  \n62     useEffect(() => {\n63      form.reset(schema.parse(initialValues ?? {}));\n64    }, [open, initialValues, form]);\n65  \n66 +  // function getActiveFiltersCount(): number {\n67 +  //   const values = form.getValues()\n68 +  //   let count = 0\n69 +  //   if ((values.dietaryRestrictions || []).length > 0) count++\n70 +  //   if ((values.allergens || []).length > 0) count++\n71 +  //   if ((values.cuisines || []).length > 0) count++\n72 +  //   if ((values.majorConditions || []).length > 0) count++\n73 +  //   if (values.calories && (values.calories[0] > 0 || values.calories[1] < 1200)) count++\n74 +  //   if ((values.proteinMin || 0) > 0) count++\n75 +  //   if ((values.carbsMin || 0) > 0) count++\n76 +  //   if ((values.fatMin || 0) > 0) count++\n77 +  //   if ((values.fiberMin || 0) > 0) count++\n78 +  //   if ((values.sugarMax || 100) < 100) count++\n79 +  //   if ((values.sodiumMax || 4000) < 4000) count++\n80 +  //   2025-12-10T02:12:20.252267272Z if ((values.maxTime || 120) < 120) count++\n81 +  //   if ((values.mealType || \"\") !== \"\") count++\n82 +  //   return count\n83 +  // }\n84    function getActiveFiltersCount(): number {\n85 +    const values = form.getValues();\n86 +    let count = 0;\n87 +\n88 +    // Count all selected array filters individually\n89 +    count += values.dietaryRestrictions.length;\n90 +    count += values.allergens.length;\n91 +    count += values.cuisines.length;\n92 +    count += values.majorConditions.length;\n93 +\n94 +    // Numeric and single-value filters\n95 +    if (values.calories[0] > 0) count++;           // Min calories\n96 +    if (values.calories[1] < 1200) count++;        // Max calories\n97 +    if (values.proteinMin > 0) count++;\n98 +    if (values.carbsMin > 0) count++;\n99 +    if (values.fatMin > 0) count++;\n100 +    if (values.fiberMin > 0) count++;\n101 +    if (values.sugarMax < 100) count++;\n102 +    if (values.sodiumMax < 4000) count++;\n103 +    if (values.maxTime < 120) count++;\n104 +    if (values.mealType) count++;\n105 +\n106 +    return count;\n107    }\n108    function handleApply() {\n109      const values = schema.parse(form.getValues())\n110      onApply(values)\n111      onOpenChange(false)\n__old hunk__\n export function FilterPanel({ open, onOpenChange, initialValues, onApply, onReset }: FilterPanelProps) {\n   const form = useForm<FiltersFormInput>({\n     resolver: zodResolver(schema),\n     // provide full defaults (OUTPUT fits into INPUT just fine)\n     defaultValues: schema.parse(initialValues ?? {}),\n     mode: \"onChange\",\n   })\n \n    useEffect(() => {\n     form.reset(schema.parse(initialValues ?? {}));\n   }, [open, initialValues, form]);\n \n   function getActiveFiltersCount(): number {\n-    const values = form.getValues()\n-    let count = 0\n-    if ((values.dietaryRestrictions || []).length > 0) count++\n-    if ((values.allergens || []).length > 0) count++\n-    if ((values.cuisines || []).length > 0) count++\n-    if ((values.majorConditions || []).length > 0) count++\n-    if (values.calories && (values.calories[0] > 0 || values.calories[1] < 1200)) count++\n-    if ((values.proteinMin || 0) > 0) count++\n-    if ((values.carbsMin || 0) > 0) count++\n-    if ((values.fatMin || 0) > 0) count++\n-    if ((values.fiberMin || 0) > 0) count++\n-    if ((values.sugarMax || 100) < 100) count++\n-    if ((values.sodiumMax || 4000) < 4000) count++\n-    if ((values.maxTime || 120) < 120) count++\n-    if ((values.mealType || \"\") !== \"\") count++\n-    return count\n   }\n-\n   function handleApply() {\n     const values = schema.parse(form.getValues())\n     onApply(values)\n     onOpenChange(false)\n======\n\n\nResponse (should be a valid YAML, and nothing else):\n```yaml"}}, "file": {"name": "litellm_ai_handler.py", "path": "/app/pr_agent/algo/ai_handlers/litellm_ai_handler.py"}, "function": "chat_completion", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 383, "message": "Prompts", "module": "litellm_ai_handler", "name": "pr_agent.algo.ai_handlers.litellm_ai_handler", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.251487+00:00", "timestamp": 1765332740.251487}}}
2025-12-10T02:12:20.312675184Z 
2025-12-10T02:12:20.312716497Z Give Feedback / Get Help: https://github.com/BerriAI/litellm/issues/new
2025-12-10T02:12:20.312720172Z LiteLLM.Info: If you need to debug this error, use `litellm._turn_on_debug()'.
2025-12-10T02:12:20.312725781Z 
2025-12-10T02:12:20.312727934Z {"text": "Error during LLM inference: litellm.AuthenticationError: AuthenticationError: OpenAIException - team not allowed to access model. This team can only access models=['openai/gpt-5.1', 'openai/gpt-5', 'openai/gpt-5-mini', 'openai/gpt-5-nano']. Tried to access gpt-5.1\n", "record": {"elapsed": {"repr": "0:01:34.964860", "seconds": 94.96486}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1"}, "file": {"name": "litellm_ai_handler.py", "path": "/app/pr_agent/algo/ai_handlers/litellm_ai_handler.py"}, "function": "chat_completion", "level": {"icon": "âš ï¸", "name": "WARNING", "no": 30}, "line": 396, "message": "Error during LLM inference: litellm.AuthenticationError: AuthenticationError: OpenAIException - team not allowed to access model. This team can only access models=['openai/gpt-5.1', 'openai/gpt-5', 'openai/gpt-5-mini', 'openai/gpt-5-nano']. Tried to access gpt-5.1", "module": "litellm_ai_handler", "name": "pr_agent.algo.ai_handlers.litellm_ai_handler", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.312256+00:00", "timestamp": 1765332740.312256}}}
2025-12-10T02:12:20.313142219Z {"text": "Failed to generate prediction with openai/gpt-5.1\n", "record": {"elapsed": {"repr": "0:01:34.965256", "seconds": 94.965256}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "artifact": {"error": "RetryError[<Future at 0x736c6ddb4950 state=finished raised AuthenticationError>]"}}, "file": {"name": "pr_processing.py", "path": "/app/pr_agent/algo/pr_processing.py"}, "function": "retry_with_fallback_models", "level": {"icon": "âš ï¸", "name": "WARNING", "no": 30}, "line": 333, "message": "Failed to generate prediction with openai/gpt-5.1", "module": "pr_processing", "name": "pr_agent.algo.pr_processing", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.312652+00:00", "timestamp": 1765332740.312652}}}
2025-12-10T02:12:20.313189329Z {"text": "Generating prediction with [\\\"openai/gpt-5\\\"\n", "record": {"elapsed": {"repr": "0:01:34.965362", "seconds": 94.965362}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1"}, "file": {"name": "pr_processing.py", "path": "/app/pr_agent/algo/pr_processing.py"}, "function": "retry_with_fallback_models", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 326, "message": "Generating prediction with [\\\"openai/gpt-5\\\"", "module": "pr_processing", "name": "pr_agent.algo.pr_processing", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.312758+00:00", "timestamp": 1765332740.312758}}}
2025-12-10T02:12:20.427287718Z {"text": "PR main language: TypeScript\n", "record": {"elapsed": {"repr": "0:01:35.077883", "seconds": 95.077883}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1"}, "file": {"name": "pr_processing.py", "path": "/app/pr_agent/algo/pr_processing.py"}, "function": "get_pr_diff", "level": {"icon": "â„¹ï¸", "name": "INFO", "no": 20}, "line": 63, "message": "PR main language: TypeScript", "module": "pr_processing", "name": "pr_agent.algo.pr_processing", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.425279+00:00", "timestamp": 1765332740.425279}}}
2025-12-10T02:12:20.439299963Z {"text": "Tokens: 4738, total tokens under limit: 32000, returning full diff.\n", "record": {"elapsed": {"repr": "0:01:35.090122", "seconds": 95.090122}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1"}, "file": {"name": "pr_processing.py", "path": "/app/pr_agent/algo/pr_processing.py"}, "function": "get_pr_diff", "level": {"icon": "â„¹ï¸", "name": "INFO", "no": 20}, "line": 74, "message": "Tokens: 4738, total tokens under limit: 32000, returning full diff.", "module": "pr_processing", "name": "pr_agent.algo.pr_processing", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.437518+00:00", "timestamp": 1765332740.437518}}}
2025-12-10T02:12:20.439350711Z {"text": "PR diff\n", "record": {"elapsed": {"repr": "0:01:35.090687", "seconds": 95.090687}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "diff": "\n\n## File: 'app/search/page.tsx'\n\n@@ -1,7 +1,8 @@\n__new hunk__\n1  \"use client\"\n2  \n3 +import { useState, useEffect, useMemo, useRef } from \"react\"\n4 +// import { X } from \"lucide-react\"\n5  import { useSearchParams, useRouter } from \"next/navigation\"\n6  import { useQuery } from \"@tanstack/react-query\"\n7  import { Input } from \"@/components/ui/input\"\n8  import { Button } from \"@/components/ui/button\"\n__old hunk__\n \"use client\"\n \n-import { useState, useEffect, useMemo } from \"react\"\n import { useSearchParams, useRouter } from \"next/navigation\"\n import { useQuery } from \"@tanstack/react-query\"\n import { Input } from \"@/components/ui/input\"\n import { Button } from \"@/components/ui/button\"\n\n@@ -41,11 +42,12 @@\n__new hunk__\n42  export default function SearchPage() {\n43    const searchParams = useSearchParams()\n44    const router = useRouter()\n45    const { filters, setFilters, resetFilters } = useFilters()\n46    const { settings } = useSettings()\n47  \n48    const [searchQuery, setSearchQuery] = useState(searchParams.get(\"q\") || filters.q || \"\")\n49 +  const inputRef = useRef<HTMLInputElement>(null);\n50    const [sortBy, setSortBy] = useState<SortOption>(settings.behavior.defaultSort || \"time\")\n51    const [filtersOpen, setFiltersOpen] = useState(false)\n52  \n53    // Update search query from URL params\n\n@@ -75,29 +77,54 @@ export default function SearchPage() {\n__new hunk__\n77        filters.fiberMin > 0 ||\n78        filters.sugarMax < 100 ||\n79        filters.sodiumMax < 4000 ||\n80        filters.maxTime < 120 ||\n81        !!filters.mealType\n82      )\n83    }, [filters])\n84  \n85 +  // const activeFilterCount = useMemo(() => {\n86 +  //   let count = 0\n87 +  //   if (filters.dietaryRestrictions.length > 0) count++\n88 +  //   if (filters.allergens.length > 0) count++\n89 +  //   if (filters.cuisines.length > 0) count++\n90 +  //   if (filters.majorConditions.length > 0) count++\n91 +  //   if (filters.calories[0] > 0 || filters.calories[1] < 1200) count++\n92 +  //   if (filters.proteinMin > 0) count++\n93 +  //   if (filters.carbsMin > 0) count++\n94 +  //   if (filters.fatMin > 0) count++\n95 +  //   if (filters.fiberMin > 0) count++\n96 +  //   if (filters.sugarMax < 100) count++\n97 +  //   if (filters.sodiumMax < 4000) count++\n98 +  //   if (filters.maxTime < 120) count++\n99 +  //   if (filters.mealType) count++\n100 +  //   return count\n101 +  // }, [filters])\n102    const activeFilterCount = useMemo(() => {\n103 +    let count = 0;\n104 +\n105 +  // Sum all selected array filters\n106 +    count += filters.dietaryRestrictions.length;\n107 +    count += filters.allergens.length;\n108 +    count += filters.cuisines.length;\n109 +    count += filters.majorConditions.length;\n110 +\n111 +    // Range and min/max filters\n112 +    if (filters.calories[0] > 0) count++; // Min calories\n113 +    if (filters.calories[1] < 1200) count++; // Max calories\n114 +    if (filters.proteinMin > 0) count++;\n115 +    if (filters.carbsMin > 0) count++;\n116 +    if (filters.fatMin > 0) count++;\n117 +    if (filters.fiberMin > 0) count++;\n118 +    if (filters.sugarMax < 100) count++;\n119 +    if (filters.sodiumMax < 4000) count++;\n120 +    if (filters.maxTime < 120) count++;\n121 +    \n122 +    // Single-value selection\n123 +    if (filters.mealType) count++;\n124 +\n125 +    return count;\n126 +  }, [filters]);\n127  \n128    const {\n129      data: searchResults = [],\n130      isLoading,\n__old hunk__\n       filters.fiberMin > 0 ||\n       filters.sugarMax < 100 ||\n       filters.sodiumMax < 4000 ||\n       filters.maxTime < 120 ||\n       !!filters.mealType\n     )\n   }, [filters])\n \n   const activeFilterCount = useMemo(() => {\n-    let count = 0\n-    if (filters.dietaryRestrictions.length > 0) count++\n-    if (filters.allergens.length > 0) count++\n-    if (filters.cuisines.length > 0) count++\n-    if (filters.majorConditions.length > 0) count++\n-    if (filters.calories[0] > 0 || filters.calories[1] < 1200) count++\n-    if (filters.proteinMin > 0) count++\n-    if (filters.carbsMin > 0) count++\n-    if (filters.fatMin > 0) count++\n-    if (filters.fiberMin > 0) count++\n-    if (filters.sugarMax < 100) count++\n-    if (filters.sodiumMax < 4000) count++\n-    if (filters.maxTime < 120) count++\n-    if (filters.mealType) count++\n-    return count\n-  }, [filters])\n \n   const {\n     data: searchResults = [],\n     isLoading,\n\n@@ -113,12 +140,22 @@ export default function SearchPage() {\n__new hunk__\n140          const rankedResults = rank(rawResults, settings)\n141          return rankedResults\n142        }\n143  \n144        return rawResults.map((recipe) => ({ ...recipe, score: 0 }))\n145      },\n146      enabled: !!(searchQuery || hasActiveFilters),\n147    })\n148 +  const handleSearchInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n149 +    if (e.key === \"Escape\" && searchQuery) {\n150 +      setSearchQuery(\"\");\n151 +      inputRef.current?.focus();\n152 +    }\n153 +    if (e.key === \"Enter\") {\n154 +      handleSearch(searchQuery);\n155 +    }\n156 +  };\n157 +\n158  \n159    const handleSearch = (query: string) => {\n160      setSearchQuery(query)\n161      setFilters({ ...filters, q: query })\n\n@@ -182,13 +219,13 @@ export default function SearchPage() {\n__new hunk__\n219    return (\n220      <div className=\"container px-4 py-6 max-w-6xl\">\n221        <div className=\"space-y-6\">\n222          {/* Search Header */}\n223          <div className=\"space-y-4\">\n224            <h1 className=\"text-3xl font-bold\">Search Recipes</h1>\n225  \n226            {/* Search Input */}\n227 +          {/* <div className=\"relative\">\n228              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n229              <Input\n230                role=\"search\"\n231                placeholder=\"Search recipes, ingredients, cuisines...\"\n__old hunk__\n   return (\n     <div className=\"container px-4 py-6 max-w-6xl\">\n       <div className=\"space-y-6\">\n         {/* Search Header */}\n         <div className=\"space-y-4\">\n           <h1 className=\"text-3xl font-bold\">Search Recipes</h1>\n \n           {/* Search Input */}\n-          <div className=\"relative\">\n             <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n             <Input\n               role=\"search\"\n               placeholder=\"Search recipes, ingredients, cuisines...\"\n\n@@ -192,14 +229,51 @@ export default function SearchPage() {\n__new hunk__\n229              <Input\n230                role=\"search\"\n231                placeholder=\"Search recipes, ingredients, cuisines...\"\n232                value={searchQuery}\n233                onChange={(e) => setSearchQuery(e.target.value)}\n234                onKeyDown={(e) => e.key === \"Enter\" && handleSearch(searchQuery)}\n235                className=\"pl-10 pr-4 h-12 text-lg\"\n236              />\n237 +          </div> */}\n238 +          <div style={{ position: \"relative\", display: \"inline-block\", width: \"100%\" }}>\n239 +            <Search style={{ position: \"absolute\", left: \"0.75rem\", top: \"50%\", transform: \"translateY(-50%)\", height: \"1rem\", width: \"1rem\", color: \"gray\" }} />\n240 +            <Input\n241 +              role=\"search\"\n242 +              ref={inputRef}\n243 +              placeholder=\"Search recipes, ingredients, cuisines...\"\n244 +              value={searchQuery}\n245 +              onChange={(e) => setSearchQuery(e.target.value)}\n246 +              onKeyDown={handleSearchInputKeyDown}\n247 +              style={{ paddingRight: searchQuery ? \"2rem\" : undefined, width: \"100%\" }}\n248 +              className=\"pl-10 pr-4 h-12 text-lg\"\n249 +            />\n250 +            {searchQuery && (\n251 +              <button\n252 +                type=\"button\"\n253 +                style={{\n254 +                  position: \"absolute\",\n255 +                  right: \"0.75rem\",\n256 +                  top: \"50%\",\n257 +                  transform: \"translateY(-50%)\",\n258 +                  background: \"none\",\n259 +                  border: \"none\",\n260 +                  cursor: \"pointer\",\n261 +                  padding: 0,\n262 +                  color: \"gray\",\n263 +                }}\n264 +                aria-label=\"Clear search\"\n265 +                onClick={() => {\n266 +                  setSearchQuery(\"\");\n267 +                  inputRef.current?.focus();\n268 +              }}\n269 +              >\n270 +                <X size={20} />\n271 +            </button>\n272 +          )}\n273            </div>\n274  \n275 +\n276            {/* Search Actions */}\n277            <div className=\"flex items-center gap-2\">\n278              <Button onClick={() => handleSearch(searchQuery)} size=\"sm\">\n279                Search\n\n\n## File: 'components/filter-panel.tsx'\n\n@@ -54,35 +54,58 @@\n__new hunk__\n54  export function FilterPanel({ open, onOpenChange, initialValues, onApply, onReset }: FilterPanelProps) {\n55    const form = useForm<FiltersFormInput>({\n56      resolver: zodResolver(schema),\n57      // provide full defaults (OUTPUT fits into INPUT just fine)\n58      defaultValues: schema.parse(initialValues ?? {}),\n59      mode: \"onChange\",\n60    })\n61  \n62     useEffect(() => {\n63      form.reset(schema.parse(initialValues ?? {}));\n64    }, [open, initialValues, form]);\n65  \n66 +  // function getActiveFiltersCount(): number {\n67 +  //   const values = form.getValues()\n68 +  //   let count = 0\n69 +  //   if ((values.dietaryRestrictions || []).length > 0) count++\n70 +  //   if ((values.allergens || []).length > 0) count++\n71 +  //   if ((values.cuisines || []).length > 0) count++\n72 +  //   if ((values.majorConditions || []).length > 0) count++\n73 +  //   if (values.calories && (values.calories[0] > 0 || values.calories[1] < 1200)) count++\n74 +  //   if ((values.proteinMin || 0) > 0) count++\n75 +  //   if ((values.carbsMin || 0) > 0) count++\n76 +  //   if ((values.fatMin || 0) > 0) count++\n77 +  //   if ((values.fiberMin || 0) > 0) count++\n78 +  //   if ((values.sugarMax || 100) < 100) count++\n79 +  //   if ((values.sodiumMax || 4000) < 4000) count++\n80 +  //   if ((values.maxTime || 120) < 120) count++\n81 +  //   if ((values.mealType || \"\") !== \"\") count++\n82 +  //   return count\n83 +  // }\n84    function getActiveFiltersCount(): number {\n85 +    const values = form.getValues();\n86 +    let count = 0;\n87 +\n88 +    // Count all selected array filters individually\n89 +    count += values.dietaryRestrictions.length;\n90 +    count += values.allergens.length;\n91 +    count += values.cuisines.length;\n92 +    count += values.majorConditions.length;\n93 +\n94 +    // Numeric and single-value filters\n95 +    if (values.calories[0] > 0) count++;           // Min calories\n96 +    if (values.calories[1] < 1200) count++;        // Max calories\n97 +    if (values.proteinMin > 0) count++;\n98 +    if (values.carbsMin > 0) count++;\n99 +    if (values.fatMin > 0) count++;\n100 +    if (values.fiberMin > 0) count++;\n101 +    if (values.sugarMax < 100) count++;\n102 +    if (values.sodiumMax < 4000) count++;\n103 +    if (values.maxTime < 120) count++;\n104 +    if (values.mealType) count++;\n105 +\n106 +    return count;\n107    }\n108    function handleApply() {\n109      const values = schema.parse(form.getValues())\n110      onApply(values)\n111      onOpenChange(false)\n__old hunk__\n export function FilterPanel({ open, onOpenChange, initialValues, onApply, onReset }: FilterPanelProps) {\n   const form = useForm<FiltersFormInput>({\n     resolver: zodResolver(schema),\n     // provide full defaults (OUTPUT fits into INPUT just fine)\n     defaultValues: schema.parse(initialValues ?? {}),\n     mode: \"onChange\",\n   })\n \n    useEffect(() => {\n     form.reset(schema.parse(initialValues ?? {}));\n   }, [open, initialValues, form]);\n \n   function getActiveFiltersCount(): number {\n-    const values = form.getValues()\n-    let count = 0\n-    if ((values.dietaryRestrictions || []).length > 0) count++\n-    if ((values.allergens || []).length > 0) count++\n-    if ((values.cuisines || []).length > 0) count++\n-    if ((values.majorConditions || []).length > 0) count++\n-    if (values.calories && (values.calories[0] > 0 || values.calories[1] < 1200)) count++\n-    if ((values.proteinMin || 0) > 0) count++\n-    if ((values.carbsMin || 0) > 0) count++\n-    if ((values.fatMin || 0) > 0) count++\n-    if ((values.fiberMin || 0) > 0) count++\n-    if ((values.sugarMax || 100) < 100) count++\n-    if ((values.sodiumMax || 4000) < 4000) count++\n-    if ((values.maxTime || 120) < 120) count++\n-    if ((values.mealType || \"\") !== \"\") count++\n-    return count\n   }\n-\n   function handleApply() {\n     const values = schema.parse(form.getValues())\n     onApply(values)\n     onOpenChange(false)"}, "file": {"name": "pr_reviewer.py", "path": "/app/pr_agent/tools/pr_reviewer.py"}, "function": "_prepare_prediction", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 197, "message": "PR diff", "module": "pr_reviewer", "name": "pr_agent.tools.pr_reviewer", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.438083+00:00", "timestamp": 1765332740.438083}}}
2025-12-10T02:12:20.463980084Z {"text": "Prompts\n", "record": {"elapsed": {"repr": "0:01:35.112603", "seconds": 95.112603}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "artifact": {"system": "You are PR-Reviewer, a language model designed to review a Git Pull Request (PR).\nYour task is to provide constructive and concise feedback for the PR.\nThe review should focus on new code added in the PR code diff (lines starting with '+')\n\n\nThe format we will use to present the PR code diff:\n======\n## File: 'src/file1.py'\n\n\n@@ ... @@ def func1():\n__new hunk__\n11  unchanged code line0\n12  unchanged code line1\n13 +new code line2 added\n14  unchanged code line3\n__old hunk__\n unchanged code line0\n unchanged code line1\n-old code line2 removed\n unchanged code line3\n\n@@ ... @@ def func2():\n__new hunk__\n unchanged code line4\n+new code line5 added\n unchanged code line6\n\n## File: 'src/file2.py'\n...\n======\n\n- In the format above, the diff is organized into separate '__new hunk__' and '__old hunk__' sections for each code chunk. '__new hunk__' contains the updated code, while '__old hunk__' shows the removed code. If no code was removed in a specific chunk, the __old hunk__ section will be omitted.\n- We also added line numbers for the '__new hunk__' code, to help you refer to the code lines in your suggestions. These line numbers are not part of the actual code, and should only be used for reference.\n- Code lines are prefixed with symbols ('+', '-', ' '). The '+' symbol indicates new code added in the PR, the '-' symbol indicates code removed in the PR, and the ' ' symbol indicates unchanged code. The review should address new code added in the PR code diff (lines starting with '+').\n- When quoting variables, names or file paths from the code, use backticks (`) instead of single quote (').\n- Note that you only see changed code segments (diff hunks in a PR), not the entire codebase. Avoid suggestions that might duplicate existing functionality or questioning code elements (like variables declarations or import statements) that may be defined elsewhere in the codebase.\n- Also note that if the code ends at an opening brace or statement that begins a new scope (like 'if', 'for', 'try'), don't treat it as incomplete. Instead, acknowledge the visible scope boundary and analyze only the code shown.\n\n\nThe output must be a YAML object equivalent to type $PRReview, according to the following Pydantic definitions:\n=====\n\nclass KeyIssuesComponentLink(BaseModel):\n    relevant_file: str = Field(description=\"The full file path of the relevant file\")\n    issue_header: str = Field(description=\"One or two word title for the issue. For example: 'Possible Bug', etc.\")\n    issue_content: str = Field(description=\"A short and concise summary of what should be further inspected and validated during the PR review process for this issue. Do not mention line numbers in this field.\")\n    start_line: int = Field(description=\"The start line that corresponds to this issue in the relevant file\")\n    end_line: int = Field(description=\"The end line that corresponds to this issue in the relevant file\")\n\nclass Review(BaseModel):\n    estimated_effort_to_review_[1-5]: int = Field(description=\"Estimate, on a scale of 1-5 (inclusive), the time and effort required to review this PR by an experienced and knowledgeable developer. 1 means short and easy review , 5 means long and hard review. Take into account the size, complexity, quality, and the needed changes of the PR code diff.\")\n    relevant_tests: str = Field(description=\"yes/no question: does this PR have relevant tests added or updated ?\")\n    key_issues_to_review: List[KeyIssuesComponentLink] = Field(\"A short and diverse list (0-3 issues) of high-priority bugs, problems or performance concerns introduced in the PR code, which the PR reviewer should further focus on and validate during the review process.\")\n    security_concerns: str = Field(description=\"Does this PR code introduce vulnerabilities such as exposure of sensitive information (e.g., API keys, secrets, passwords), or security concerns like SQL injection, XSS, CSRF, and others ? Answer 'No' (without explaining why) if there are no possible issues. If there are security concerns or issues, start your answer with a short header, such as: 'Sensitive information exposure: ...', 'SQL injection: ...', etc. Explain your answer. Be specific and give examples if possible\")\n\nclass PRReview(BaseModel):\n    review: Review\n=====\n\n\nExample output:\n```yaml\nreview:\n  estimated_effort_to_review_[1-5]: |\n    3\n  relevant_tests: |\n    No\n  key_issues_to_review:\n    - relevant_file: |\n        directory/xxx.py\n      issue_header: |\n        Possible Bug\n      issue_content: |\n        ...\n      start_line: 12\n      end_line: 14\n    - ...\n  security_concerns: |\n    No\n```\n\nAnswer should be a valid YAML, and nothing else. Each YAML output MUST be after a newline, with proper indent, and block scalar indicator ('|')", "user": "\n\n\n--PR Info--\n\nToday's Date: 2025-12-10\n\nTitle: 'Fix: Search UX and multi-filter logic (frontend)'\n\nBranch: 'feature/initial-fixes'\n\nPR Description:\n======\n- Improved search bar UX in app/search/page.tsx:\r\n  - X icon clears input and refocuses\r\n  - Escape key clears input\r\n  - Enter key triggers search\r\n\r\n- Updated filter count logic:\r\n  - Accurately counts all active filters\r\n  - Apply button badge reflects true total\n======\n\n\nThe PR code diff:\n======\n## File: 'app/search/page.tsx'\n\n@@ -1,7 +1,8 @@\n__new hunk__\n1  \"use client\"\n2  \n3 +import { useState, useEffect, useMemo, useRef } from \"react\"\n4 +// import { X } from \"lucide-react\"\n5  import { useSearchParams, useRouter } from \"next/navigation\"\n6  import { useQuery } from \"@tanstack/react-query\"\n7  import { Input } from \"@/components/ui/input\"\n8  import { Button } from \"@/components/ui/button\"\n__old hunk__\n \"use client\"\n \n-import { useState, useEffect, useMemo } from \"react\"\n import { useSearchParams, useRouter } from \"next/navigation\"\n import { useQuery } from \"@tanstack/react-query\"\n import { Input } from \"@/components/ui/input\"\n import { Button } from \"@/components/ui/button\"\n\n@@ -41,11 +42,12 @@\n__new hunk__\n42  export default function SearchPage() {\n43    const searchParams = useSearchParams()\n44    const router = useRouter()\n45    const { filters, setFilters, resetFilters } = useFilters()\n46    const { settings } = useSettings()\n47  \n48    const [searchQuery, setSearchQuery] = useState(searchParams.get(\"q\") || filters.q || \"\")\n49 +  const inputRef = useRef<HTMLInputElement>(null);\n50    const [sortBy, setSortBy] = useState<SortOption>(settings.behavior.defaultSort || \"time\")\n51    const [filtersOpen, setFiltersOpen] = useState(false)\n52  \n53    // Update search query from URL params\n\n@@ -75,29 +77,54 @@ export default function SearchPage() {\n__new hunk__\n77        filters.fiberMin > 0 ||\n78        filters.sugarMax < 100 ||\n79        filters.sodiumMax < 4000 ||\n80        filters.maxTime < 120 ||\n81        !!filters.mealType\n82      )\n83    }, [filters])\n84  \n85 +  // const activeFilterCount = useMemo(() => {\n86 +  //   let count = 0\n87 +  //   if (filters.dietaryRestrictions.length > 0) count++\n88 +  //   if (filters.allergens.length > 0) count++\n89 +  //   if (filters.cuisines.length > 0) count++\n90 +  //   if (filters.majorConditions.length > 0) count++\n91 +  //   if (filters.calories[0] > 0 || filters.calories[1] < 1200) count++\n92 +  //   if (filters.proteinMin > 0) count++\n93 +  //   if (filters.carbsMin > 0) count++\n94 +  //   if (filters.fatMin > 0) count++\n95 +  //   if (filters.fiberMin > 0) count++\n96 +  //   if (filters.sugarMax < 100) count++\n97 +  //   if (filters.sodiumMax < 4000) count++\n98 +  //   if (filters.maxTime < 120) count++\n99 +  //   if (filters.mealType) count++\n100 +  //   return count\n101 +  // }, [filters])\n102    const activeFilterCount = useMemo(() => {\n103 +    let count = 0;\n104 +\n105 +  // Sum all selected array filters\n106 +    count += filters.dietaryRestrictions.length;\n107 +    count += filters.allergens.length;\n108 +    count += filters.cuisines.length;\n109 +    count += filters.majorConditions.length;\n110 +\n111 +    // Range and min/max filters\n112 +    if (filters.calories[0] > 0) count++; // Min calories\n113 +    if (filters.calories[1] < 1200) count++; // Max calories\n114 +    if (filters.proteinMin > 0) count++;\n115 +    if (filters.carbsMin > 0) count++;\n116 +    if (filters.fatMin > 0) count++;\n117 +    if (filters.fiberMin > 0) count++;\n118 +    if (filters.sugarMax < 100) count++;\n119 +    if (filters.sodiumMax < 4000) count++;\n120 +    if (filters.maxTime < 120) count++;\n121 +    \n122 +    // Single-value selection\n123 +    if (filters.mealType) count++;\n124 +\n125 +    return count;\n126 +  }, [filters]);\n127  \n128    const {\n129      data: searchResults = [],\n130      isLoading,\n__old hunk__\n       filters.fiberMin > 0 ||\n       filters.sugarMax < 100 ||\n       filters.sodiumMax < 4000 ||\n       filters.maxTime < 120 ||\n       !!filters.mealType\n     )\n   }, [filters])\n \n   const activeFilterCount = useMemo(() => {\n-    let count = 0\n-    if (filters.dietaryRestrictions.length > 0) count++\n-    if (filters.allergens.length > 0) count++\n-    if (filters.cuisines.length > 0) count++\n-    if (filters.majorConditions.length > 0) count++\n-    if (filters.calories[0] > 0 || filters.calories[1] < 1200) count++\n-    if (filters.proteinMin > 0) count++\n-    if (filters.carbsMin > 0) count++\n-    if (filters.fatMin > 0) count++\n-    if (filters.fiberMin > 0) count++\n-    if (filters.sugarMax < 100) count++\n-    if (filters.sodiumMax < 4000) count++\n-    if (filters.maxTime < 120) count++\n-    if (filters.mealType) count++\n-    return count\n-  }, [filters])\n \n   const {\n     data: searchResults = [],\n     isLoading,\n\n@@ -113,12 +140,22 @@ export default function SearchPage() {\n__new hunk__\n140          const rankedResults = rank(rawResults, settings)\n141          return rankedResults\n142        }\n143  \n144        return rawResults.map((recipe) => ({ ...recipe, score: 0 }))\n145      },\n146      enabled: !!(searchQuery || hasActiveFilters),\n147    })\n148 +  const handleSearchInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n149 +    if (e.key === \"Escape\" && searchQuery) {\n150 +      setSearchQuery(\"\");\n151 +      inputRef.current?.focus();\n152 +    }\n153 +    if (e.key === \"Enter\") {\n154 +      handleSearch(searchQuery);\n155 +    }\n156 +  };\n157 +\n158  \n159    const handleSearch = (query: string) => {\n160      setSearchQuery(query)\n161      setFilters({ ...filters, q: query })\n\n@@ -182,13 +219,13 @@ export default function SearchPage() {\n__new hunk__\n219    return (\n220      <div className=\"container px-4 py-6 max-w-6xl\">\n221        <div className=\"space-y-6\">\n222          {/* Search Header */}\n223          <div className=\"space-y-4\">\n224            <h1 className=\"text-3xl font-bold\">Search Recipes</h1>\n225  \n226            {/* Search Input */}\n227 +          {/* <div className=\"relative\">\n228              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n229              <Input\n230                role=\"search\"\n231                placeholder=\"Search recipes, ingredients, cuisines...\"\n__old hunk__\n   return (\n     <div className=\"container px-4 py-6 max-w-6xl\">\n       <div className=\"space-y-6\">\n         {/* Search Header */}\n         <div className=\"space-y-4\">\n           <h1 className=\"text-3xl font-bold\">Search Recipes</h1>\n \n           {/* Search Input */}\n-          <div className=\"relative\">\n             <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n             <Input\n               role=\"search\"\n               placeholder=\"Search recipes, ingredients, cuisines...\"\n\n@@ -192,14 +229,51 @@ export default function SearchPage() {\n__new hunk__\n229              <Input\n230                role=\"search\"\n231                placeholder=\"Search recipes, ingredients, cuisines...\"\n232                value={searchQuery}\n233                onChange={(e) => setSearchQuery(e.target.value)}\n234                onKeyDown={(e) => e.key === \"Enter\" && handleSearch(searchQuery)}\n235                className=\"pl-10 pr-4 h-12 text-lg\"\n236              />\n237 +          </div> */}\n238 +          <div style={{ position: \"relative\", display: \"inline-block\", width: \"100%\" }}>\n239 +            <Search style={{ position: \"absolute\", left: \"0.75rem\", top: \"50%\", transform: \"translateY(-50%)\", height: \"1rem\", width: \"1rem\", color: \"gray\" }} />\n240 +            <Input\n241 +              role=\"search\"\n242 +              ref={inputRef}\n243 +              placeholder=\"Search recipes, ingredients, cuisines...\"\n244 +              value={searchQuery}\n245 +              onChange={(e) => setSearchQuery(e.target.value)}\n246 +              onKeyDown={handleSearchInputKeyDown}\n247 +              style={{ paddingRight: searchQuery ? \"2rem\" : undefined, width: \"100%\" }}\n248 +              className=\"pl-10 pr-4 h-12 text-lg\"\n249 +            />\n250 +            {searchQuery && (\n251 +              <button\n252 +                type=\"button\"\n253 +                style={{\n254 +                  position: \"absolute\",\n255 +                  right: \"0.75rem\",\n256 +                  top: \"50%\",\n257 +                  transform: \"translateY(-50%)\",\n258 +                  background: \"none\",\n259 +                  border: \"none\",\n260 +                  cursor: \"pointer\",\n261 +                  padding: 0,\n262 +                  color: \"gray\",\n263 +                }}\n264 +                aria-label=\"Clear search\"\n265 +                onClick={() => {\n266 +                  setSearchQuery(\"\");\n267 +                  inputRef.current?.focus();\n268 +              }}\n269 +              >\n270 +                <X size={20} />\n271 +            </button>\n272 +          )}\n273            </div>\n274  \n275 +\n276            {/* Search Actions */}\n277            <div className=\"flex items-center gap-2\">\n278              <Button onClick={() => handleSearch(searchQuery)} size=\"sm\">\n279                Search\n\n\n## File: 'components/filter-panel.tsx'\n\n@@ -54,35 +54,58 @@\n__new hunk__\n54  export function FilterPanel({ open, onOpenChange, initialValues, onApply, onReset }: FilterPanelProps) {\n55    const form = useForm<FiltersFormInput>({\n56      resolver: zodResolver(schema),\n57      // provide full defaults (OUTPUT fits into INPUT just fine)\n58      defaultValues: schema.parse(initialValues ?? {}),\n59      mode: \"onChange\",\n60    })\n61  \n62     useEffect(() => {\n63      form.reset(schema.parse(initialValues ?? {}));\n64    }, [open, initialValues, form]);\n65  \n66 +  // function getActiveFiltersCount(): number {\n67 +  //   const values = form.getValues()\n68 +  //   let count = 0\n69 +  //   if ((values.dietaryRestrictions || []).length > 0) count++\n70 +  //   if ((values.allergens || []).length > 0) count++\n71 +  //   if ((values.cuisines || []).length > 0) count++\n72 +  //   if ((values.majorConditions || []).length > 0) count++\n73 +  //   if (values.calories && (values.calories[0] > 0 || values.calories[1] < 1200)) count++\n74 +  //   if ((values.proteinMin || 0) > 0) count++\n75 +  //   if ((values.carbsMin || 0) > 0) count++\n76 +  //   if ((values.fatMin || 0) > 0) count++\n77 +  //   if ((values.fiberMin || 0) > 0) count++\n78 +  //   if ((values.sugarMax || 100) < 100) count++\n79 +  //   if ((values.sodiumMax || 4000) < 4000) count++\n80 +  //   2025-12-10T02:12:20.463980084Z if ((values.maxTime || 120) < 120) count++\n81 +  //   if ((values.mealType || \"\") !== \"\") count++\n82 +  //   return count\n83 +  // }\n84    function getActiveFiltersCount(): number {\n85 +    const values = form.getValues();\n86 +    let count = 0;\n87 +\n88 +    // Count all selected array filters individually\n89 +    count += values.dietaryRestrictions.length;\n90 +    count += values.allergens.length;\n91 +    count += values.cuisines.length;\n92 +    count += values.majorConditions.length;\n93 +\n94 +    // Numeric and single-value filters\n95 +    if (values.calories[0] > 0) count++;           // Min calories\n96 +    if (values.calories[1] < 1200) count++;        // Max calories\n97 +    if (values.proteinMin > 0) count++;\n98 +    if (values.carbsMin > 0) count++;\n99 +    if (values.fatMin > 0) count++;\n100 +    if (values.fiberMin > 0) count++;\n101 +    if (values.sugarMax < 100) count++;\n102 +    if (values.sodiumMax < 4000) count++;\n103 +    if (values.maxTime < 120) count++;\n104 +    if (values.mealType) count++;\n105 +\n106 +    return count;\n107    }\n108    function handleApply() {\n109      const values = schema.parse(form.getValues())\n110      onApply(values)\n111      onOpenChange(false)\n__old hunk__\n export function FilterPanel({ open, onOpenChange, initialValues, onApply, onReset }: FilterPanelProps) {\n   const form = useForm<FiltersFormInput>({\n     resolver: zodResolver(schema),\n     // provide full defaults (OUTPUT fits into INPUT just fine)\n     defaultValues: schema.parse(initialValues ?? {}),\n     mode: \"onChange\",\n   })\n \n    useEffect(() => {\n     form.reset(schema.parse(initialValues ?? {}));\n   }, [open, initialValues, form]);\n \n   function getActiveFiltersCount(): number {\n-    const values = form.getValues()\n-    let count = 0\n-    if ((values.dietaryRestrictions || []).length > 0) count++\n-    if ((values.allergens || []).length > 0) count++\n-    if ((values.cuisines || []).length > 0) count++\n-    if ((values.majorConditions || []).length > 0) count++\n-    if (values.calories && (values.calories[0] > 0 || values.calories[1] < 1200)) count++\n-    if ((values.proteinMin || 0) > 0) count++\n-    if ((values.carbsMin || 0) > 0) count++\n-    if ((values.fatMin || 0) > 0) count++\n-    if ((values.fiberMin || 0) > 0) count++\n-    if ((values.sugarMax || 100) < 100) count++\n-    if ((values.sodiumMax || 4000) < 4000) count++\n-    if ((values.maxTime || 120) < 120) count++\n-    if ((values.mealType || \"\") !== \"\") count++\n-    return count\n   }\n-\n   function handleApply() {\n     const values = schema.parse(form.getValues())\n     onApply(values)\n     onOpenChange(false)\n======\n\n\nResponse (should be a valid YAML, and nothing else):\n```yaml"}}, "file": {"name": "litellm_ai_handler.py", "path": "/app/pr_agent/algo/ai_handlers/litellm_ai_handler.py"}, "function": "chat_completion", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 383, "message": "Prompts", "module": "litellm_ai_handler", "name": "pr_agent.algo.ai_handlers.litellm_ai_handler", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.459999+00:00", "timestamp": 1765332740.459999}}}
2025-12-10T02:12:20.468184710Z 
2025-12-10T02:12:20.468234606Z Provider List: https://docs.litellm.ai/docs/providers
2025-12-10T02:12:20.468238252Z 
2025-12-10T02:12:20.468240586Z {"text": "Error during LLM inference: litellm.BadRequestError: LLM Provider NOT provided. Pass in the LLM provider you are trying to call. You passed model=[\\\"openai/gpt-5\\\"\n Pass model as E.g. For 'Huggingface' inference endpoints pass in `completion(model='huggingface/starcoder',..)` Learn more: https://docs.litellm.ai/docs/providers\n", "record": {"elapsed": {"repr": "0:01:35.120049", "seconds": 95.120049}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1"}, "file": {"name": "litellm_ai_handler.py", "path": "/app/pr_agent/algo/ai_handlers/litellm_ai_handler.py"}, "function": "chat_completion", "level": {"icon": "âš ï¸", "name": "WARNING", "no": 30}, "line": 396, "message": "Error during LLM inference: litellm.BadRequestError: LLM Provider NOT provided. Pass in the LLM provider you are trying to call. You passed model=[\\\"openai/gpt-5\\\"\n Pass model as E.g. For 'Huggingface' inference endpoints pass in `completion(model='huggingface/starcoder',..)` Learn more: https://docs.litellm.ai/docs/providers", "module": "litellm_ai_handler", "name": "pr_agent.algo.ai_handlers.litellm_ai_handler", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.467445+00:00", "timestamp": 1765332740.467445}}}
2025-12-10T02:12:20.474394341Z {"text": "Prompts\n", "record": {"elapsed": {"repr": "0:01:35.124457", "seconds": 95.124457}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "artifact": {"system": "You are PR-Reviewer, a language model designed to review a Git Pull Request (PR).\nYour task is to provide constructive and concise feedback for the PR.\nThe review should focus on new code added in the PR code diff (lines starting with '+')\n\n\nThe format we will use to present the PR code diff:\n======\n## File: 'src/file1.py'\n\n\n@@ ... @@ def func1():\n__new hunk__\n11  unchanged code line0\n12  unchanged code line1\n13 +new code line2 added\n14  unchanged code line3\n__old hunk__\n unchanged code line0\n unchanged code line1\n-old code line2 removed\n unchanged code line3\n\n@@ ... @@ def func2():\n__new hunk__\n unchanged code line4\n+new code line5 added\n unchanged code line6\n\n## File: 'src/file2.py'\n...\n======\n\n- In the format above, the diff is organized into separate '__new hunk__' and '__old hunk__' sections for each code chunk. '__new hunk__' contains the updated code, while '__old hunk__' shows the removed code. If no code was removed in a specific chunk, the __old hunk__ section will be omitted.\n- We also added line numbers for the '__new hunk__' code, to help you refer to the code lines in your suggestions. These line numbers are not part of the actual code, and should only be used for reference.\n- Code lines are prefixed with symbols ('+', '-', ' '). The '+' symbol indicates new code added in the PR, the '-' symbol indicates code removed in the PR, and the ' ' symbol indicates unchanged code. The review should address new code added in the PR code diff (lines starting with '+').\n- When quoting variables, names or file paths from the code, use backticks (`) instead of single quote (').\n- Note that you only see changed code segments (diff hunks in a PR), not the entire codebase. Avoid suggestions that might duplicate existing functionality or questioning code elements (like variables declarations or import statements) that may be defined elsewhere in the codebase.\n- Also note that if the code ends at an opening brace or statement that begins a new scope (like 'if', 'for', 'try'), don't treat it as incomplete. Instead, acknowledge the visible scope boundary and analyze only the code shown.\n\n\nThe output must be a YAML object equivalent to type $PRReview, according to the following Pydantic definitions:\n=====\n\nclass KeyIssuesComponentLink(BaseModel):\n    relevant_file: str = Field(description=\"The full file path of the relevant file\")\n    issue_header: str = Field(description=\"One or two word title for the issue. For example: 'Possible Bug', etc.\")\n    issue_content: str = Field(description=\"A short and concise summary of what should be further inspected and validated during the PR review process for this issue. Do not mention line numbers in this field.\")\n    start_line: int = Field(description=\"The start line that corresponds to this issue in the relevant file\")\n    end_line: int = Field(description=\"The end line that corresponds to this issue in the relevant file\")\n\nclass Review(BaseModel):\n    estimated_effort_to_review_[1-5]: int = Field(description=\"Estimate, on a scale of 1-5 (inclusive), the time and effort required to review this PR by an experienced and knowledgeable developer. 1 means short and easy review , 5 means long and hard review. Take into account the size, complexity, quality, and the needed changes of the PR code diff.\")\n    relevant_tests: str = Field(description=\"yes/no question: does this PR have relevant tests added or updated ?\")\n    key_issues_to_review: List[KeyIssuesComponentLink] = Field(\"A short and diverse list (0-3 issues) of high-priority bugs, problems or performance concerns introduced in the PR code, which the PR reviewer should further focus on and validate during the review process.\")\n    security_concerns: str = Field(description=\"Does this PR code introduce vulnerabilities such as exposure of sensitive information (e.g., API keys, secrets, passwords), or security concerns like SQL injection, XSS, CSRF, and others ? Answer 'No' (without explaining why) if there are no possible issues. If there are security concerns or issues, start your answer with a short header, such as: 'Sensitive information exposure: ...', 'SQL injection: ...', etc. Explain your answer. Be specific and give examples if possible\")\n\nclass PRReview(BaseModel):\n    review: Review\n=====\n\n\nExample output:\n```yaml\nreview:\n  estimated_effort_to_review_[1-5]: |\n    3\n  relevant_tests: |\n    No\n  key_issues_to_review:\n    - relevant_file: |\n        directory/xxx.py\n      issue_header: |\n        Possible Bug\n      issue_content: |\n        ...\n      start_line: 12\n      end_line: 14\n    - ...\n  security_concerns: |\n    No\n```\n\nAnswer should be a valid YAML, and nothing else. Each YAML output MUST be after a newline, with proper indent, and block scalar indicator ('|')", "user": "\n\n\n--PR Info--\n\nToday's Date: 2025-12-10\n\nTitle: 'Fix: Search UX and multi-filter logic (frontend)'\n\nBranch: 'feature/initial-fixes'\n\nPR Description:\n======\n- Improved search bar UX in app/search/page.tsx:\r\n  - X icon clears input and refocuses\r\n  - Escape key clears input\r\n  - Enter key triggers search\r\n\r\n- Updated filter count logic:\r\n  - Accurately counts all active filters\r\n  - Apply button badge reflects true total\n======\n\n\nThe PR code diff:\n======\n## File: 'app/search/page.tsx'\n\n@@ -1,7 +1,8 @@\n__new hunk__\n1  \"use client\"\n2  \n3 +import { useState, useEffect, useMemo, useRef } from \"react\"\n4 +// import { X } from \"lucide-react\"\n5  import { useSearchParams, useRouter } from \"next/navigation\"\n6  import { useQuery } from \"@tanstack/react-query\"\n7  import { Input } from \"@/components/ui/input\"\n8  import { Button } from \"@/components/ui/button\"\n__old hunk__\n \"use client\"\n \n-import { useState, useEffect, useMemo } from \"react\"\n import { useSearchParams, useRouter } from \"next/navigation\"\n import { useQuery } from \"@tanstack/react-query\"\n import { Input } from \"@/components/ui/input\"\n import { Button } from \"@/components/ui/button\"\n\n@@ -41,11 +42,12 @@\n__new hunk__\n42  export default function SearchPage() {\n43    const searchParams = useSearchParams()\n44    const router = useRouter()\n45    const { filters, setFilters, resetFilters } = useFilters()\n46    const { settings } = useSettings()\n47  \n48    const [searchQuery, setSearchQuery] = useState(searchParams.get(\"q\") || filters.q || \"\")\n49 +  const inputRef = useRef<HTMLInputElement>(null);\n50    const [sortBy, setSortBy] = useState<SortOption>(settings.behavior.defaultSort || \"time\")\n51    const [filtersOpen, setFiltersOpen] = useState(false)\n52  \n53    // Update search query from URL params\n\n@@ -75,29 +77,54 @@ export default function SearchPage() {\n__new hunk__\n77        filters.fiberMin > 0 ||\n78        filters.sugarMax < 100 ||\n79        filters.sodiumMax < 4000 ||\n80        filters.maxTime < 120 ||\n81        !!filters.mealType\n82      )\n83    }, [filters])\n84  \n85 +  // const activeFilterCount = useMemo(() => {\n86 +  //   let count = 0\n87 +  //   if (filters.dietaryRestrictions.length > 0) count++\n88 +  //   if (filters.allergens.length > 0) count++\n89 +  //   if (filters.cuisines.length > 0) count++\n90 +  //   if (filters.majorConditions.length > 0) count++\n91 +  //   if (filters.calories[0] > 0 || filters.calories[1] < 1200) count++\n92 +  //   if (filters.proteinMin > 0) count++\n93 +  //   if (filters.carbsMin > 0) count++\n94 +  //   if (filters.fatMin > 0) count++\n95 +  //   if (filters.fiberMin > 0) count++\n96 +  //   if (filters.sugarMax < 100) count++\n97 +  //   if (filters.sodiumMax < 4000) count++\n98 +  //   if (filters.maxTime < 120) count++\n99 +  //   if (filters.mealType) count++\n100 +  //   return count\n101 +  // }, [filters])\n102    const activeFilterCount = useMemo(() => {\n103 +    let count = 0;\n104 +\n105 +  // Sum all selected array filters\n106 +    count += filters.dietaryRestrictions.length;\n107 +    count += filters.allergens.length;\n108 +    count += filters.cuisines.length;\n109 +    count += filters.majorConditions.length;\n110 +\n111 +    // Range and min/max filters\n112 +    if (filters.calories[0] > 0) count++; // Min calories\n113 +    if (filters.calories[1] < 1200) count++; // Max calories\n114 +    if (filters.proteinMin > 0) count++;\n115 +    if (filters.carbsMin > 0) count++;\n116 +    if (filters.fatMin > 0) count++;\n117 +    if (filters.fiberMin > 0) count++;\n118 +    if (filters.sugarMax < 100) count++;\n119 +    if (filters.sodiumMax < 4000) count++;\n120 +    if (filters.maxTime < 120) count++;\n121 +    \n122 +    // Single-value selection\n123 +    if (filters.mealType) count++;\n124 +\n125 +    return count;\n126 +  }, [filters]);\n127  \n128    const {\n129      data: searchResults = [],\n130      isLoading,\n__old hunk__\n       filters.fiberMin > 0 ||\n       filters.sugarMax < 100 ||\n       filters.sodiumMax < 4000 ||\n       filters.maxTime < 120 ||\n       !!filters.mealType\n     )\n   }, [filters])\n \n   const activeFilterCount = useMemo(() => {\n-    let count = 0\n-    if (filters.dietaryRestrictions.length > 0) count++\n-    if (filters.allergens.length > 0) count++\n-    if (filters.cuisines.length > 0) count++\n-    if (filters.majorConditions.length > 0) count++\n-    if (filters.calories[0] > 0 || filters.calories[1] < 1200) count++\n-    if (filters.proteinMin > 0) count++\n-    if (filters.carbsMin > 0) count++\n-    if (filters.fatMin > 0) count++\n-    if (filters.fiberMin > 0) count++\n-    if (filters.sugarMax < 100) count++\n-    if (filters.sodiumMax < 4000) count++\n-    if (filters.maxTime < 120) count++\n-    if (filters.mealType) count++\n-    return count\n-  }, [filters])\n \n   const {\n     data: searchResults = [],\n     isLoading,\n\n@@ -113,12 +140,22 @@ export default function SearchPage() {\n__new hunk__\n140          const rankedResults = rank(rawResults, settings)\n141          return rankedResults\n142        }\n143  \n144        return rawResults.map((recipe) => ({ ...recipe, score: 0 }))\n145      },\n146      enabled: !!(searchQuery || hasActiveFilters),\n147    })\n148 +  const handleSearchInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n149 +    if (e.key === \"Escape\" && searchQuery) {\n150 +      setSearchQuery(\"\");\n151 +      inputRef.current?.focus();\n152 +    }\n153 +    if (e.key === \"Enter\") {\n154 +      handl pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
2025-12-10T02:12:20.480325630Z 
2025-12-10T02:12:20.480377299Z Provider List: https://docs.litellm.ai/docs/providers
2025-12-10T02:12:20.480387403Z 
2025-12-10T02:12:20.480390078Z {"text": "Error during LLM inference: litellm.BadRequestError: LLM Provider NOT provided. Pass in the LLM provider you are trying to call. You passed model=[\\\"openai/gpt-5\\\"\n Pass model as E.g. For 'Huggingface' inference endpoints pass in `completion(model='huggingface/starcoder',..)` Learn more: https://docs.litellm.ai/docs/providers\n", "record": {"elapsed": {"repr": "0:01:35.132534", "seconds": 95.132534}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1"}, "file": {"name": "litellm_ai_handler.py", "path": "/app/pr_agent/algo/ai_handlers/litellm_ai_handler.py"}, "function": "chat_completion", "level": {"icon": "âš ï¸", "name": "WARNING", "no": 30}, "line": 396, "message": "Error during LLM inference: litellm.BadRequestError: LLM Provider NOT provided. Pass in the LLM provider you are trying to call. You passed model=[\\\"openai/gpt-5\\\"\n Pass model as E.g. For 'Huggingface' inference endpoints pass in `completion(model='huggingface/starcoder',..)` Learn more: https://docs.litellm.ai/docs/providers", "module": "litellm_ai_handler", "name": "pr_agent.algo.ai_handlers.litellm_ai_handler", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.479930+00:00", "timestamp": 1765332740.47993}}}
2025-12-10T02:12:20.480898334Z {"text": "Failed to generate prediction with [\\\"openai/gpt-5\\\"\n", "record": {"elapsed": {"repr": "0:01:35.133289", "seconds": 95.133289}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "artifact": {"error": "RetryError[<Future at 0x736c757aa360 state=finished raised BadRequestError>]"}}, "file": {"name": "pr_processing.py", "path": "/app/pr_agent/algo/pr_processing.py"}, "function": "retry_with_fallback_models", "level": {"icon": "âš ï¸", "name": "WARNING", "no": 30}, "line": 333, "message": "Failed to generate prediction with [\\\"openai/gpt-5\\\"", "module": "pr_processing", "name": "pr_agent.algo.pr_processing", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.480685+00:00", "timestamp": 1765332740.480685}}}
2025-12-10T02:12:20.481170134Z {"text": "Generating prediction with \\\"openai/gpt-5-nano\\\"]\n", "record": {"elapsed": {"repr": "0:01:35.133484", "seconds": 95.133484}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1"}, "file": {"name": "pr_processing.py", "path": "/app/pr_agent/algo/pr_processing.py"}, "function": "retry_with_fallback_models", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 326, "message": "Generating prediction with \\\"openai/gpt-5-nano\\\"]", "module": "pr_processing", "name": "pr_agent.algo.pr_processing", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.480880+00:00", "timestamp": 1765332740.48088}}}
2025-12-10T02:12:20.672354582Z {"text": "PR main language: TypeScript\n", "record": {"elapsed": {"repr": "0:01:35.324476", "seconds": 95.324476}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1"}, "file": {"name": "pr_processing.py", "path": "/app/pr_agent/algo/pr_processing.py"}, "function": "get_pr_diff", "level": {"icon": "â„¹ï¸", "name": "INFO", "no": 20}, "line": 63, "message": "PR main language: TypeScript", "module": "pr_processing", "name": "pr_agent.algo.pr_processing", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.671872+00:00", "timestamp": 1765332740.671872}}}
2025-12-10T02:12:20.681599747Z {"text": "Tokens: 4738, total tokens under limit: 32000, returning full diff.\n", "record": {"elapsed": {"repr": "0:01:35.333673", "seconds": 95.333673}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1"}, "file": {"name": "pr_processing.py", "path": "/app/pr_agent/algo/pr_processing.py"}, "function": "get_pr_diff", "level": {"icon": "â„¹ï¸", "name": "INFO", "no": 20}, "line": 74, "message": "Tokens: 4738, total tokens under limit: 32000, returning full diff.", "module": "pr_processing", "name": "pr_agent.algo.pr_processing", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.681069+00:00", "timestamp": 1765332740.681069}}}
2025-12-10T02:12:20.681749043Z {"text": "PR diff\n", "record": {"elapsed": {"repr": "0:01:35.333933", "seconds": 95.333933}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "diff": "\n\n## File: 'app/search/page.tsx'\n\n@@ -1,7 +1,8 @@\n__new hunk__\n1  \"use client\"\n2  \n3 +import { useState, useEffect, useMemo, useRef } from \"react\"\n4 +// import { X } from \"lucide-react\"\n5  import { useSearchParams, useRouter } from \"next/navigation\"\n6  import { useQuery } from \"@tanstack/react-query\"\n7  import { Input } from \"@/components/ui/input\"\n8  import { Button } from \"@/components/ui/button\"\n__old hunk__\n \"use client\"\n \n-import { useState, useEffect, useMemo } from \"react\"\n import { useSearchParams, useRouter } from \"next/navigation\"\n import { useQuery } from \"@tanstack/react-query\"\n import { Input } from \"@/components/ui/input\"\n import { Button } from \"@/components/ui/button\"\n\n@@ -41,11 +42,12 @@\n__new hunk__\n42  export default function SearchPage() {\n43    const searchParams = useSearchParams()\n44    const router = useRouter()\n45    const { filters, setFilters, resetFilters } = useFilters()\n46    const { settings } = useSettings()\n47  \n48    const [searchQuery, setSearchQuery] = useState(searchParams.get(\"q\") || filters.q || \"\")\n49 +  const inputRef = useRef<HTMLInputElement>(null);\n50    const [sortBy, setSortBy] = useState<SortOption>(settings.behavior.defaultSort || \"time\")\n51    const [filtersOpen, setFiltersOpen] = useState(false)\n52  \n53    // Update search query from URL params\n\n@@ -75,29 +77,54 @@ export default function SearchPage() {\n__new hunk__\n77        filters.fiberMin > 0 ||\n78        filters.sugarMax < 100 ||\n79        filters.sodiumMax < 4000 ||\n80        filters.maxTime < 120 ||\n81        !!filters.mealType\n82      )\n83    }, [filters])\n84  \n85 +  // const activeFilterCount = useMemo(() => {\n86 +  //   let count = 0\n87 +  //   if (filters.dietaryRestrictions.length > 0) count++\n88 +  //   if (filters.allergens.length > 0) count++\n89 +  //   if (filters.cuisines.length > 0) count++\n90 +  //   if (filters.majorConditions.length > 0) count++\n91 +  //   if (filters.calories[0] > 0 || filters.calories[1] < 1200) count++\n92 +  //   if (filters.proteinMin > 0) count++\n93 +  //   if (filters.carbsMin > 0) count++\n94 +  //   if (filters.fatMin > 0) count++\n95 +  //   if (filters.fiberMin > 0) count++\n96 +  //   if (filters.sugarMax < 100) count++\n97 +  //   if (filters.sodiumMax < 4000) count++\n98 +  //   if (filters.maxTime < 120) count++\n99 +  //   if (filters.mealType) count++\n100 +  //   return count\n101 +  // }, [filters])\n102    const activeFilterCount = useMemo(() => {\n103 +    let count = 0;\n104 +\n105 +  // Sum all selected array filters\n106 +    count += filters.dietaryRestrictions.length;\n107 +    count += filters.allergens.length;\n108 +    count += filters.cuisines.length;\n109 +    count += filters.majorConditions.length;\n110 +\n111 +    // Range and min/max filters\n112 +    if (filters.calories[0] > 0) count++; // Min calories\n113 +    if (filters.calories[1] < 1200) count++; // Max calories\n114 +    if (filters.proteinMin > 0) count++;\n115 +    if (filters.carbsMin > 0) count++;\n116 +    if (filters.fatMin > 0) count++;\n117 +    if (filters.fiberMin > 0) count++;\n118 +    if (filters.sugarMax < 100) count++;\n119 +    if (filters.sodiumMax < 4000) count++;\n120 +    if (filters.maxTime < 120) count++;\n121 +    \n122 +    // Single-value selection\n123 +    if (filters.mealType) count++;\n124 +\n125 +    return count;\n126 +  }, [filters]);\n127  \n128    const {\n129      data: searchResults = [],\n130      isLoading,\n__old hunk__\n       filters.fiberMin > 0 ||\n       filters.sugarMax < 100 ||\n       filters.sodiumMax < 4000 ||\n       filters.maxTime < 120 ||\n       !!filters.mealType\n     )\n   }, [filters])\n \n   const activeFilterCount = useMemo(() => {\n-    let count = 0\n-    if (filters.dietaryRestrictions.length > 0) count++\n-    if (filters.allergens.length > 0) count++\n-    if (filters.cuisines.length > 0) count++\n-    if (filters.majorConditions.length > 0) count++\n-    if (filters.calories[0] > 0 || filters.calories[1] < 1200) count++\n-    if (filters.proteinMin > 0) count++\n-    if (filters.carbsMin > 0) count++\n-    if (filters.fatMin > 0) count++\n-    if (filters.fiberMin > 0) count++\n-    if (filters.sugarMax < 100) count++\n-    if (filters.sodiumMax < 4000) count++\n-    if (filters.maxTime < 120) count++\n-    if (filters.mealType) count++\n-    return count\n-  }, [filters])\n \n   const {\n     data: searchResults = [],\n     isLoading,\n\n@@ -113,12 +140,22 @@ export default function SearchPage() {\n__new hunk__\n140          const rankedResults = rank(rawResults, settings)\n141          return rankedResults\n142        }\n143  \n144        return rawResults.map((recipe) => ({ ...recipe, score: 0 }))\n145      },\n146      enabled: !!(searchQuery || hasActiveFilters),\n147    })\n148 +  const handleSearchInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n149 +    if (e.key === \"Escape\" && searchQuery) {\n150 +      setSearchQuery(\"\");\n151 +      inputRef.current?.focus();\n152 +    }\n153 +    if (e.key === \"Enter\") {\n154 +      handleSearch(searchQuery);\n155 +    }\n156 +  };\n157 +\n158  \n159    const handleSearch = (query: string) => {\n160      setSearchQuery(query)\n161      setFilters({ ...filters, q: query })\n\n@@ -182,13 +219,13 @@ export default function SearchPage() {\n__new hunk__\n219    return (\n220      <div className=\"container px-4 py-6 max-w-6xl\">\n221        <div className=\"space-y-6\">\n222          {/* Search Header */}\n223          <div className=\"space-y-4\">\n224            <h1 className=\"text-3xl font-bold\">Search Recipes</h1>\n225  \n226            {/* Search Input */}\n227 +          {/* <div className=\"relative\">\n228              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n229              <Input\n230                role=\"search\"\n231                placeholder=\"Search recipes, ingredients, cuisines...\"\n__old hunk__\n   return (\n     <div className=\"container px-4 py-6 max-w-6xl\">\n       <div className=\"space-y-6\">\n         {/* Search Header */}\n         <div className=\"space-y-4\">\n           <h1 className=\"text-3xl font-bold\">Search Recipes</h1>\n \n           {/* Search Input */}\n-          <div className=\"relative\">\n             <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n             <Input\n               role=\"search\"\n               placeholder=\"Search recipes, ingredients, cuisines...\"\n\n@@ -192,14 +229,51 @@ export default function SearchPage() {\n__new hunk__\n229              <Input\n230                role=\"search\"\n231                placeholder=\"Search recipes, ingredients, cuisines...\"\n232                value={searchQuery}\n233                onChange={(e) => setSearchQuery(e.target.value)}\n234                onKeyDown={(e) => e.key === \"Enter\" && handleSearch(searchQuery)}\n235                className=\"pl-10 pr-4 h-12 text-lg\"\n236              />\n237 +          </div> */}\n238 +          <div style={{ position: \"relative\", display: \"inline-block\", width: \"100%\" }}>\n239 +            <Search style={{ position: \"absolute\", left: \"0.75rem\", top: \"50%\", transform: \"translateY(-50%)\", height: \"1rem\", width: \"1rem\", color: \"gray\" }} />\n240 +            <Input\n241 +              role=\"search\"\n242 +              ref={inputRef}\n243 +              placeholder=\"Search recipes, ingredients, cuisines...\"\n244 +              value={searchQuery}\n245 +              onChange={(e) => setSearchQuery(e.target.value)}\n246 +              onKeyDown={handleSearchInputKeyDown}\n247 +              style={{ paddingRight: searchQuery ? \"2rem\" : undefined, width: \"100%\" }}\n248 +              className=\"pl-10 pr-4 h-12 text-lg\"\n249 +            />\n250 +            {searchQuery && (\n251 +              <button\n252 +                type=\"button\"\n253 +                style={{\n254 +                  position: \"absolute\",\n255 +                  right: \"0.75rem\",\n256 +                  top: \"50%\",\n257 +                  transform: \"translateY(-50%)\",\n258 +                  background: \"none\",\n259 +                  border: \"none\",\n260 +                  cursor: \"pointer\",\n261 +                  padding: 0,\n262 +                  color: \"gray\",\n263 +                }}\n264 +                aria-label=\"Clear search\"\n265 +                onClick={() => {\n266 +                  setSearchQuery(\"\");\n267 +                  inputRef.current?.focus();\n268 +              }}\n269 +              >\n270 +                <X size={20} />\n271 +            </button>\n272 +          )}\n273            </div>\n274  \n275 +\n276            {/* Search Actions */}\n277            <div className=\"flex items-center gap-2\">\n278              <Button onClick={() => handleSearch(searchQuery)} size=\"sm\">\n279                Search\n\n\n## File: 'components/filter-panel.tsx'\n\n@@ -54,35 +54,58 @@\n__new hunk__\n54  export function FilterPanel({ open, onOpenChange, initialValues, onApply, onReset }: FilterPanelProps) {\n55    const form = useForm<FiltersFormInput>({\n56      resolver: zodResolver(schema),\n57      // provide full defaults (OUTPUT fits into INPUT just fine)\n58      defaultValues: schema.parse(initialValues ?? {}),\n59      mode: \"onChange\",\n60    })\n61  \n62     useEffect(() => {\n63      form.reset(schema.parse(initialValues ?? {}));\n64    }, [open, initialValues, form]);\n65  \n66 +  // function getActiveFiltersCount(): number {\n67 +  //   const values = form.getValues()\n68 +  //   let count = 0\n69 +  //   if ((values.dietaryRestrictions || []).length > 0) count++\n70 +  //   if ((values.allergens || []).length > 0) count++\n71 +  //   if ((values.cuisines || []).length > 0) count++\n72 +  //   if ((values.majorConditions || []).length > 0) count++\n73 +  //   if (values.calories && (values.calories[0] > 0 || values.calories[1] < 1200)) count++\n74 +  //   if ((values.proteinMin || 0) > 0) count++\n75 +  //   if ((values.carbsMin || 0) > 0) count++\n76 +  //   if ((values.fatMin || 0) > 0) count++\n77 +  //   if ((values.fiberMin || 0) > 0) count++\n78 +  //   if ((values.sugarMax || 100) < 100) count++\n79 +  //   if ((values.sodiumMax || 4000) < 4000) count++\n80 +  //   if ((values.maxTime || 120) < 120) count++\n81 +  //   if ((values.mealType || \"\") !== \"\") count++\n82 +  //   return count\n83 +  // }\n84    function getActiveFiltersCount(): number {\n85 +    const values = form.getValues();\n86 +    let count = 0;\n87 +\n88 +    // Count all selected array filters individually\n89 +    count += values.dietaryRestrictions.length;\n90 +    count += values.allergens.length;\n91 +    count += values.cuisines.length;\n92 +    count += values.majorConditions.length;\n93 +\n94 +    // Numeric and single-value filters\n95 +    if (values.calories[0] > 0) count++;           // Min calories\n96 +    if (values.calories[1] < 1200) count++;        // Max calories\n97 +    if (values.proteinMin > 0) count++;\n98 +    if (values.carbsMin > 0) count++;\n99 +    if (values.fatMin > 0) count++;\n100 +    if (values.fiberMin > 0) count++;\n101 +    if (values.sugarMax < 100) count++;\n102 +    if (values.sodiumMax < 4000) count++;\n103 +    if (values.maxTime < 120) count++;\n104 +    if (values.mealType) count++;\n105 +\n106 +    return count;\n107    }\n108    function handleApply() {\n109      const values = schema.parse(form.getValues())\n110      onApply(values)\n111      onOpenChange(false)\n__old hunk__\n export function FilterPanel({ open, onOpenChange, initialValues, onApply, onReset }: FilterPanelProps) {\n   const form = useForm<FiltersFormInput>({\n     resolver: zodResolver(schema),\n     // provide full defaults (OUTPUT fits into INPUT just fine)\n     defaultValues: schema.parse(initialValues ?? {}),\n     mode: \"onChange\",\n   })\n \n    useEffect(() => {\n     form.reset(schema.parse(initialValues ?? {}));\n   }, [open, initialValues, form]);\n \n   function getActiveFiltersCount(): number {\n-    const values = form.getValues()\n-    let count = 0\n-    if ((values.dietaryRestrictions || []).length > 0) count++\n-    if ((values.allergens || []).length > 0) count++\n-    if ((values.cuisines || []).length > 0) count++\n-    if ((values.majorConditions || []).length > 0) count++\n-    if (values.calories && (values.calories[0] > 0 || values.calories[1] < 1200)) count++\n-    if ((values.proteinMin || 0) > 0) count++\n-    if ((values.carbsMin || 0) > 0) count++\n-    if ((values.fatMin || 0) > 0) count++\n-    if ((values.fiberMin || 0) > 0) count++\n-    if ((values.sugarMax || 100) < 100) count++\n-    if ((values.sodiumMax || 4000) < 4000) count++\n-    if ((values.maxTime || 120) < 120) count++\n-    if ((values.mealType || \"\") !== \"\") count++\n-    return count\n   }\n-\n   function handleApply() {\n     const values = schema.parse(form.getValues())\n     onApply(values)\n     onOpenChange(false)"}, "file": {"name": "pr_reviewer.py", "path": "/app/pr_agent/tools/pr_reviewer.py"}, "function": "_prepare_prediction", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 197, "message": "PR diff", "module": "pr_reviewer", "name": "pr_agent.tools.pr_reviewer", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.681329+00:00", "timestamp": 1765332740.681329}}}
2025-12-10T02:12:20.695111633Z {"text": "Prompts\n", "record": {"elapsed": {"repr": "0:01:35.346840", "seconds": 95.34684}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "artifact": {"system": "You are PR-Reviewer, a language model designed to review a Git Pull Request (PR).\nYour task is to provide constructive and concise feedback for the PR.\nThe review should focus on new code added in the PR code diff (lines starting with '+')\n\n\nThe format we will use to present the PR code diff:\n======\n## File: 'src/file1.py'\n\n\n@@ ... @@ def func1():\n__new hunk__\n11  unchanged code line0\n12  unchanged code line1\n13 +new code line2 added\n14  unchanged code line3\n__old hunk__\n unchanged code line0\n unchanged code line1\n-old code line2 removed\n unchanged code line3\n\n@@ ... @@ def func2():\n__new hunk__\n unchanged code line4\n+new code line5 added\n unchanged code line6\n\n## File: 'src/file2.py'\n...\n======\n\n- In the format above, the diff is organized into separate '__new hunk__' and '__old hunk__' sections for each code chunk. '__new hunk__' contains the updated code, while '__old hunk__' shows the removed code. If no code was removed in a specific chunk, the __old hunk__ section will be omitted.\n- We also added line numbers for the '__new hunk__' code, to help you refer to the code lines in your suggestions. These line numbers are not part of the actual code, and should only be used for reference.\n- Code lines are prefixed with symbols ('+', '-', ' '). The '+' symbol indicates new code added in the PR, the '-' symbol indicates code removed in the PR, and the ' ' symbol indicates unchanged code. The review should address new code added in the PR code diff (lines starting with '+').\n- When quoting variables, names or file paths from the code, use backticks (`) instead of single quote (').\n- Note that you only see changed code segments (diff hunks in a PR), not the entire codebase. Avoid suggestions that might duplicate existing functionality or questioning code elements (like variables declarations or import statements) that may be defined elsewhere in the codebase.\n- Also note that if the code ends at an opening brace or statement that begins a new scope (like 'if', 'for', 'try'), don't treat it as incomplete. Instead, acknowledge the visible scope boundary and analyze only the code shown.\n\n\nThe output must be a YAML object equivalent to type $PRReview, according to the following Pydantic definitions:\n=====\n\nclass KeyIssuesComponentLink(BaseModel):\n    relevant_file: str = Field(description=\"The full file path of the relevant file\")\n    issue_header: str = Field(description=\"One or two word title for the issue. For example: 'Possible Bug', etc.\")\n    issue_content: str = Field(description=\"A short and concise summary of what should be further inspected and validated during the PR review process for this issue. Do not mention line numbers in this field.\")\n    start_line: int = Field(description=\"The start line that corresponds to this issue in the relevant file\")\n    end_line: int = Field(description=\"The end line that corresponds to this issue in the relevant file\")\n\nclass Review(BaseModel):\n    estimated_effort_to_review_[1-5]: int = Field(description=\"Estimate, on a scale of 1-5 (inclusive), the time and effort required to review this PR by an experienced and knowledgeable developer. 1 means short and easy review , 5 means long and hard review. Take into account the size, complexity, quality, and the needed changes of the PR code diff.\")\n    relevant_tests: str = Field(description=\"yes/no question: does this PR have relevant tests added or updated ?\")\n    key_issues_to_review: List[KeyIssuesComponentLink] = Field(\"A short and diverse list (0-3 issues) of high-priority bugs, problems or performance concerns introduced in the PR code, which the PR reviewer should further focus on and validate during the review process.\")\n    security_concerns: str = Field(description=\"Does this PR code introduce vulnerabilities such as exposure of sensitive information (e.g., API keys, secrets, passwords), or security concerns like SQL injection, XSS, CSRF, and others ? Answer 'No' (without explaining why) if there are no possible issues. If there are security concerns or issues, start your answer with a short header, such as: 'Sensitive information exposure: ...', 'SQL injection: ...', etc. Explain your answer. Be specific and give examples if possible\")\n\nclass PRReview(BaseModel):\n    review: Review\n=====\n\n\nExample output:\n```yaml\nreview:\n  estimated_effort_to_review_[1-5]: |\n    3\n  relevant_tests: |\n    No\n  key_issues_to_review:\n    - relevant_file: |\n        directory/xxx.py\n      issue_header: |\n        Possible Bug\n      issue_content: |\n        ...\n      start_line: 12\n      end_line: 14\n    - ...\n  security_concerns: |\n    No\n```\n\nAnswer should be a valid YAML, and nothing else. Each YAML output MUST be after a newline, with proper indent, and block scalar indicator ('|')", "user": "\n\n\n--PR Info--\n\nToday's Date: 2025-12-10\n\nTitle: 'Fix: Search UX and multi-filter logic (frontend)'\n\nBranch: 'feature/initial-fixes'\n\nPR Description:\n======\n- Improved search bar UX in app/search/page.tsx:\r\n  - X icon clears input and refocuses\r\n  - Escape key clears input\r\n  - Enter key triggers search\r\n\r\n- Updated filter count logic:\r\n  - Accurately counts all active filters\r\n  - Apply button badge reflects true total\n======\n\n\nThe PR code diff:\n======\n## File: 'app/search/page.tsx'\n\n@@ -1,7 +1,8 @@\n__new hunk__\n1  \"use client\"\n2  \n3 +import { useState, useEffect, useMemo, useRef } from \"react\"\n4 +// import { X } from \"lucide-react\"\n5  import { useSearchParams, useRouter } from \"next/navigation\"\n6  import { useQuery } from \"@tanstack/react-query\"\n7  import { Input } from \"@/components/ui/input\"\n8  import { Button } from \"@/components/ui/button\"\n__old hunk__\n \"use client\"\n \n-import { useState, useEffect, useMemo } from \"react\"\n import { useSearchParams, useRouter } from \"next/navigation\"\n import { useQuery } from \"@tanstack/react-query\"\n import { Input } from \"@/components/ui/input\"\n import { Button } from \"@/components/ui/button\"\n\n@@ -41,11 +42,12 @@\n__new hunk__\n42  export default function SearchPage() {\n43    const searchParams = useSearchParams()\n44    const router = useRouter()\n45    const { filters, setFilters, resetFilters } = useFilters()\n46    const { settings } = useSettings()\n47  \n48    const [searchQuery, setSearchQuery] = useState(searchParams.get(\"q\") || filters.q || \"\")\n49 +  const inputRef = useRef<HTMLInputElement>(null);\n50    const [sortBy, setSortBy] = useState<SortOption>(settings.behavior.defaultSort || \"time\")\n51    const [filtersOpen, setFiltersOpen] = useState(false)\n52  \n53    // Update search query from URL params\n\n@@ -75,29 +77,54 @@ export default function SearchPage() {\n__new hunk__\n77        filters.fiberMin > 0 ||\n78        filters.sugarMax < 100 ||\n79        filters.sodiumMax < 4000 ||\n80        filters.maxTime < 120 ||\n81        !!filters.mealType\n82      )\n83    }, [filters])\n84  \n85 +  // const activeFilterCount = useMemo(() => {\n86 +  //   let count = 0\n87 +  //   if (filters.dietaryRestrictions.length > 0) count++\n88 +  //   if (filters.allergens.length > 0) count++\n89 +  //   if (filters.cuisines.length > 0) count++\n90 +  //   if (filters.majorConditions.length > 0) count++\n91 +  //   if (filters.calories[0] > 0 || filters.calories[1] < 1200) count++\n92 +  //   if (filters.proteinMin > 0) count++\n93 +  //   if (filters.carbsMin > 0) count++\n94 +  //   if (filters.fatMin > 0) count++\n95 +  //   if (filters.fiberMin > 0) count++\n96 +  //   if (filters.sugarMax < 100) count++\n97 +  //   if (filters.sodiumMax < 4000) count++\n98 +  //   if (filters.maxTime < 120) count++\n99 +  //   if (filters.mealType) count++\n100 +  //   return count\n101 +  // }, [filters])\n102    const activeFilterCount = useMemo(() => {\n103 +    let count = 0;\n104 +\n105 +  // Sum all selected array filters\n106 +    count += filters.dietaryRestrictions.length;\n107 +    count += filters.allergens.length;\n108 +    count += filters.cuisines.length;\n109 +    count += filters.majorConditions.length;\n110 +\n111 +    // Range and min/max filters\n112 +    if (filters.calories[0] > 0) count++; // Min calories\n113 +    if (filters.calories[1] < 1200) count++; // Max calories\n114 +    if (filters.proteinMin > 0) count++;\n115 +    if (filters.carbsMin > 0) count++;\n116 +    if (filters.fatMin > 0) count++;\n117 +    if (filters.fiberMin > 0) count++;\n118 +    if (filters.sugarMax < 100) count++;\n119 +    if (filters.sodiumMax < 4000) count++;\n120 +    if (filters.maxTime < 120) count++;\n121 +    \n122 +    // Single-value selection\n123 +    if (filters.mealType) count++;\n124 +\n125 +    return count;\n126 +  }, [filters]);\n127  \n128    const {\n129      data: searchResults = [],\n130      isLoading,\n__old hunk__\n       filters.fiberMin > 0 ||\n       filters.sugarMax < 100 ||\n       filters.sodiumMax < 4000 ||\n       filters.maxTime < 120 ||\n       !!filters.mealType\n     )\n   }, [filters])\n \n   const activeFilterCount = useMemo(() => {\n-    let count = 0\n-    if (filters.dietaryRestrictions.length > 0) count++\n-    if (filters.allergens.length > 0) count++\n-    if (filters.cuisines.length > 0) count++\n-    if (filters.majorConditions.length > 0) count++\n-    if (filters.calories[0] > 0 || filters.calories[1] < 1200) count++\n-    if (filters.proteinMin > 0) count++\n-    if (filters.carbsMin > 0) count++\n-    if (filters.fatMin > 0) count++\n-    if (filters.fiberMin > 0) count++\n-    if (filters.sugarMax < 100) count++\n-    if (filters.sodiumMax < 4000) count++\n-    if (filters.maxTime < 120) count++\n-    if (filters.mealType) count++\n-    return count\n-  }, [filters])\n \n   const {\n     data: searchResults = [],\n     isLoading,\n\n@@ -113,12 +140,22 @@ export default function SearchPage() {\n__new hunk__\n140          const rankedResults = rank(rawResults, settings)\n141          return rankedResults\n142        }\n143  \n144        return rawResults.map((recipe) => ({ ...recipe, score: 0 }))\n145      },\n146      enabled: !!(searchQuery || hasActiveFilters),\n147    })\n148 +  const handleSearchInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n149 +    if (e.key === \"Escape\" && searchQuery) {\n150 +      setSearchQuery(\"\");\n151 +      inputRef.current?.focus();\n152 +    }\n153 +    if (e.key === \"Enter\") {\n154 +      handleSearch(searchQuery);\n155 +    }\n156 +  };\n157 +\n158  \n159    const handleSearch = (query: string) => {\n160      setSearchQuery(query)\n161      setFilters({ ...filters, q: query })\n\n@@ -182,13 +219,13 @@ export default function SearchPage() {\n__new hunk__\n219    return (\n220      <div className=\"container px-4 py-6 max-w-6xl\">\n221        <div className=\"space-y-6\">\n222          {/* Search Header */}\n223          <div className=\"space-y-4\">\n224            <h1 className=\"text-3xl font-bold\">Search Recipes</h1>\n225  \n226            {/* Search Input */}\n227 +          {/* <div className=\"relative\">\n228              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n229              <Input\n230                role=\"search\"\n231                placeholder=\"Search recipes, ingredients, cuisines...\"\n__old hunk__\n   return (\n     <div className=\"container px-4 py-6 max-w-6xl\">\n       <div className=\"space-y-6\">\n         {/* Search Header */}\n         <div className=\"space-y-4\">\n           <h1 className=\"text-3xl font-bold\">Search Recipes</h1>\n \n           {/* Search Input */}\n-          <div className=\"relative\">\n             <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n             <Input\n               role=\"search\"\n               placeholder=\"Search recipes, ingredients, cuisines...\"\n\n@@ -192,14 +229,51 @@ export default function SearchPage() {\n__new hunk__\n229              <Input\n230                role=\"search\"\n231                placeholder=\"Search recipes, ingredients, cuisines...\"\n232                value={searchQuery}\n233                onChange={(e) => setSearchQuery(e.target.value)}\n234                onKeyDown={(e) => e.key === \"Enter\" && handleSearch(searchQuery)}\n235                className=\"pl-10 pr-4 h-12 text-lg\"\n236              />\n237 +          </div> */}\n238 +          <div style={{ position: \"relative\", display: \"inline-block\", width: \"100%\" }}>\n239 +            <Search style={{ position: \"absolute\", left: \"0.75rem\", top: \"50%\", transform: \"translateY(-50%)\", height: \"1rem\", width: \"1rem\", color: \"gray\" }} />\n240 +            <Input\n241 +              role=\"search\"\n242 +              ref={inputRef}\n243 +              placeholder=\"Search recipes, ingredients, cuisines...\"\n244 +              value={searchQuery}\n245 +              onChange={(e) => setSearchQuery(e.target.value)}\n246 +              onKeyDown={handleSearchInputKeyDown}\n247 +              style={{ paddingRight: searchQuery ? \"2rem\" : undefined, width: \"100%\" }}\n248 +              className=\"pl-10 pr-4 h-12 text-lg\"\n249 +            />\n250 +            {searchQuery && (\n251 +              <button\n252 +                type=\"button\"\n253 +                style={{\n254 +                  position: \"absolute\",\n255 +                  right: \"0.75rem\",\n256 +                  top: \"50%\",\n257 +                  transform: \"translateY(-50%)\",\n258 +                  background: \"none\",\n259 +                  border: \"none\",\n260 +                  cursor: \"pointer\",\n261 +                  padding: 0,\n262 +                  color: \"gray\",\n263 +                }}\n264 +                aria-label=\"Clear search\"\n265 +                onClick={() => {\n266 +                  setSearchQuery(\"\");\n267 +                  inputRef.current?.focus();\n268 +              }}\n269 +              >\n270 +                <X size={20} />\n271 +            </button>\n272 +          )}\n273            </div>\n274  \n275 +\n276            {/* Search Actions */}\n277            <div className=\"flex items-center gap-2\">\n278              <Button onClick={() => handleSearch(searchQuery)} size=\"sm\">\n279                Search\n\n\n## File: 'components/filter-panel.tsx'\n\n@@ -54,35 +54,58 @@\n__new hunk__\n54  export function FilterPanel({ open, onOpenChange, initialValues, onApply, onReset }: FilterPanelProps) {\n55    const form = useForm<FiltersFormInput>({\n56      resolver: zodResolver(schema),\n57      // provide full defaults (OUTPUT fits into INPUT just fine)\n58      defaultValues: schema.parse(initialValues ?? {}),\n59      mode: \"onChange\",\n60    })\n61  \n62     useEffect(() => {\n63      form.reset(schema.parse(initialValues ?? {}));\n64    }, [open, initialValues, form]);\n65  \n66 +  // function getActiveFiltersCount(): number {\n67 +  //   const values = form.getValues()\n68 +  //   let count = 0\n69 +  //   if ((values.dietaryRestrictions || []).length > 0) count++\n70 +  //   if ((values.allergens || []).length > 0) count++\n71 +  //   if ((values.cuisines || []).length > 0) count++\n72 +  //   if ((values.majorConditions || []).length > 0) count++\n73 +  //   if (values.calories && (values.calories[0] > 0 || values.calories[1] < 1200)) count++\n74 +  //   if ((values.proteinMin || 0) > 0) count++\n75 +  //   if ((values.carbsMin || 0) > 0) count++\n76 +  //   if ((values.fatMin || 0) > 0) count++\n77 +  //   if ((values.fiberMin || 0) > 0) count++\n78 +  //   if ((values.sugarMax || 100) < 100) count++\n79 +  //   if ((values.sodiumMax || 4000) < 4000) count++\n80 +  //   i2025-12-10T02:12:20.695111633Z f ((values.maxTime || 120) < 120) count++\n81 +  //   if ((values.mealType || \"\") !== \"\") count++\n82 +  //   return count\n83 +  // }\n84    function getActiveFiltersCount(): number {\n85 +    const values = form.getValues();\n86 +    let count = 0;\n87 +\n88 +    // Count all selected array filters individually\n89 +    count += values.dietaryRestrictions.length;\n90 +    count += values.allergens.length;\n91 +    count += values.cuisines.length;\n92 +    count += values.majorConditions.length;\n93 +\n94 +    // Numeric and single-value filters\n95 +    if (values.calories[0] > 0) count++;           // Min calories\n96 +    if (values.calories[1] < 1200) count++;        // Max calories\n97 +    if (values.proteinMin > 0) count++;\n98 +    if (values.carbsMin > 0) count++;\n99 +    if (values.fatMin > 0) count++;\n100 +    if (values.fiberMin > 0) count++;\n101 +    if (values.sugarMax < 100) count++;\n102 +    if (values.sodiumMax < 4000) count++;\n103 +    if (values.maxTime < 120) count++;\n104 +    if (values.mealType) count++;\n105 +\n106 +    return count;\n107    }\n108    function handleApply() {\n109      const values = schema.parse(form.getValues())\n110      onApply(values)\n111      onOpenChange(false)\n__old hunk__\n export function FilterPanel({ open, onOpenChange, initialValues, onApply, onReset }: FilterPanelProps) {\n   const form = useForm<FiltersFormInput>({\n     resolver: zodResolver(schema),\n     // provide full defaults (OUTPUT fits into INPUT just fine)\n     defaultValues: schema.parse(initialValues ?? {}),\n     mode: \"onChange\",\n   })\n \n    useEffect(() => {\n     form.reset(schema.parse(initialValues ?? {}));\n   }, [open, initialValues, form]);\n \n   function getActiveFiltersCount(): number {\n-    const values = form.getValues()\n-    let count = 0\n-    if ((values.dietaryRestrictions || []).length > 0) count++\n-    if ((values.allergens || []).length > 0) count++\n-    if ((values.cuisines || []).length > 0) count++\n-    if ((values.majorConditions || []).length > 0) count++\n-    if (values.calories && (values.calories[0] > 0 || values.calories[1] < 1200)) count++\n-    if ((values.proteinMin || 0) > 0) count++\n-    if ((values.carbsMin || 0) > 0) count++\n-    if ((values.fatMin || 0) > 0) count++\n-    if ((values.fiberMin || 0) > 0) count++\n-    if ((values.sugarMax || 100) < 100) count++\n-    if ((values.sodiumMax || 4000) < 4000) count++\n-    if ((values.maxTime || 120) < 120) count++\n-    if ((values.mealType || \"\") !== \"\") count++\n-    return count\n   }\n-\n   function handleApply() {\n     const values = schema.parse(form.getValues())\n     onApply(values)\n     onOpenChange(false)\n======\n\n\nResponse (should be a valid YAML, and nothing else):\n```yaml"}}, "file": {"name": "litellm_ai_handler.py", "path": "/app/pr_agent/algo/ai_handlers/litellm_ai_handler.py"}, "function": "chat_completion", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 383, "message": "Prompts", "module": "litellm_ai_handler", "name": "pr_agent.algo.ai_handlers.litellm_ai_handler", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.694236+00:00", "timestamp": 1765332740.694236}}}
2025-12-10T02:12:20.698305407Z 
2025-12-10T02:12:20.698361482Z Provider List: https://docs.litellm.ai/docs/providers
2025-12-10T02:12:20.698365198Z 
2025-12-10T02:12:20.698367952Z {"text": "Error during LLM inference: litellm.BadRequestError: LLM Provider NOT provided. Pass in the LLM provider you are trying to call. You passed model=\\\"openai/gpt-5-nano\\\"]\n Pass model as E.g. For 'Huggingface' inference endpoints pass in `completion(model='huggingface/starcoder',..)` Learn more: https://docs.litellm.ai/docs/providers\n", "record": {"elapsed": {"repr": "0:01:35.350641", "seconds": 95.350641}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1"}, "file": {"name": "litellm_ai_handler.py", "path": "/app/pr_agent/algo/ai_handlers/litellm_ai_handler.py"}, "function": "chat_completion", "level": {"icon": "âš ï¸", "name": "WARNING", "no": 30}, "line": 396, "message": "Error during LLM inference: litellm.BadRequestError: LLM Provider NOT provided. Pass in the LLM provider you are trying to call. You passed model=\\\"openai/gpt-5-nano\\\"]\n Pass model as E.g. For 'Huggingface' inference endpoints pass in `completion(model='huggingface/starcoder',..)` Learn more: https://docs.litellm.ai/docs/providers", "module": "litellm_ai_handler", "name": "pr_agent.algo.ai_handlers.litellm_ai_handler", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.698037+00:00", "timestamp": 1765332740.698037}}}
2025-12-10T02:12:20.700537041Z {"text": "Prompts\n", "record": {"elapsed": {"repr": "0:01:35.352718", "seconds": 95.352718}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "artifact": {"system": "You are PR-Reviewer, a language model designed to review a Git Pull Request (PR).\nYour task is to provide constructive and concise feedback for the PR.\nThe review should focus on new code added in the PR code diff (lines starting with '+')\n\n\nThe format we will use to present the PR code diff:\n======\n## File: 'src/file1.py'\n\n\n@@ ... @@ def func1():\n__new hunk__\n11  unchanged code line0\n12  unchanged code line1\n13 +new code line2 added\n14  unchanged code line3\n__old hunk__\n unchanged code line0\n unchanged code line1\n-old code line2 removed\n unchanged code line3\n\n@@ ... @@ def func2():\n__new hunk__\n unchanged code line4\n+new code line5 added\n unchanged code line6\n\n## File: 'src/file2.py'\n...\n======\n\n- In the format above, the diff is organized into separate '__new hunk__' and '__old hunk__' sections for each code chunk. '__new hunk__' contains the updated code, while '__old hunk__' shows the removed code. If no code was removed in a specific chunk, the __old hunk__ section will be omitted.\n- We also added line numbers for the '__new hunk__' code, to help you refer to the code lines in your suggestions. These line numbers are not part of the actual code, and should only be used for reference.\n- Code lines are prefixed with symbols ('+', '-', ' '). The '+' symbol indicates new code added in the PR, the '-' symbol indicates code removed in the PR, and the ' ' symbol indicates unchanged code. The review should address new code added in the PR code diff (lines starting with '+').\n- When quoting variables, names or file paths from the code, use backticks (`) instead of single quote (').\n- Note that you only see changed code segments (diff hunks in a PR), not the entire codebase. Avoid suggestions that might duplicate existing functionality or questioning code elements (like variables declarations or import statements) that may be defined elsewhere in the codebase.\n- Also note that if the code ends at an opening brace or statement that begins a new scope (like 'if', 'for', 'try'), don't treat it as incomplete. Instead, acknowledge the visible scope boundary and analyze only the code shown.\n\n\nThe output must be a YAML object equivalent to type $PRReview, according to the following Pydantic definitions:\n=====\n\nclass KeyIssuesComponentLink(BaseModel):\n    relevant_file: str = Field(description=\"The full file path of the relevant file\")\n    issue_header: str = Field(description=\"One or two word title for the issue. For example: 'Possible Bug', etc.\")\n    issue_content: str = Field(description=\"A short and concise summary of what should be further inspected and validated during the PR review process for this issue. Do not mention line numbers in this field.\")\n    start_line: int = Field(description=\"The start line that corresponds to this issue in the relevant file\")\n    end_line: int = Field(description=\"The end line that corresponds to this issue in the relevant file\")\n\nclass Review(BaseModel):\n    estimated_effort_to_review_[1-5]: int = Field(description=\"Estimate, on a scale of 1-5 (inclusive), the time and effort required to review this PR by an experienced and knowledgeable developer. 1 means short and easy review , 5 means long and hard review. Take into account the size, complexity, quality, and the needed changes of the PR code diff.\")\n    relevant_tests: str = Field(description=\"yes/no question: does this PR have relevant tests added or updated ?\")\n    key_issues_to_review: List[KeyIssuesComponentLink] = Field(\"A short and diverse list (0-3 issues) of high-priority bugs, problems or performance concerns introduced in the PR code, which the PR reviewer should further focus on and validate during the review process.\")\n    security_concerns: str = Field(description=\"Does this PR code introduce vulnerabilities such as exposure of sensitive information (e.g., API keys, secrets, passwords), or security concerns like SQL injection, XSS, CSRF, and others ? Answer 'No' (without explaining why) if there are no possible issues. If there are security concerns or issues, start your answer with a short header, such as: 'Sensitive information exposure: ...', 'SQL injection: ...', etc. Explain your answer. Be specific and give examples if possible\")\n\nclass PRReview(BaseModel):\n    review: Review\n=====\n\n\nExample output:\n```yaml\nreview:\n  estimated_effort_to_review_[1-5]: |\n    3\n  relevant_tests: |\n    No\n  key_issues_to_review:\n    - relevant_file: |\n        directory/xxx.py\n      issue_header: |\n        Possible Bug\n      issue_content: |\n        ...\n      start_line: 12\n      end_line: 14\n    - ...\n  security_concerns: |\n    No\n```\n\nAnswer should be a valid YAML, and nothing else. Each YAML output MUST be after a newline, with proper indent, and block scalar indicator ('|')", "user": "\n\n\n--PR Info--\n\nToday's Date: 2025-12-10\n\nTitle: 'Fix: Search UX and multi-filter logic (frontend)'\n\nBranch: 'feature/initial-fixes'\n\nPR Description:\n======\n- Improved search bar UX in app/search/page.tsx:\r\n  - X icon clears input and refocuses\r\n  - Escape key clears input\r\n  - Enter key triggers search\r\n\r\n- Updated filter count logic:\r\n  - Accurately counts all active filters\r\n  - Apply button badge reflects true total\n======\n\n\nThe PR code diff:\n======\n## File: 'app/search/page.tsx'\n\n@@ -1,7 +1,8 @@\n__new hunk__\n1  \"use client\"\n2  \n3 +import { useState, useEffect, useMemo, useRef } from \"react\"\n4 +// import { X } from \"lucide-react\"\n5  import { useSearchParams, useRouter } from \"next/navigation\"\n6  import { useQuery } from \"@tanstack/react-query\"\n7  import { Input } from \"@/components/ui/input\"\n8  import { Button } from \"@/components/ui/button\"\n__old hunk__\n \"use client\"\n \n-import { useState, useEffect, useMemo } from \"react\"\n import { useSearchParams, useRouter } from \"next/navigation\"\n import { useQuery } from \"@tanstack/react-query\"\n import { Input } from \"@/components/ui/input\"\n import { Button } from \"@/components/ui/button\"\n\n@@ -41,11 +42,12 @@\n__new hunk__\n42  export default function SearchPage() {\n43    const searchParams = useSearchParams()\n44    const router = useRouter()\n45    const { filters, setFilters, resetFilters } = useFilters()\n46    const { settings } = useSettings()\n47  \n48    const [searchQuery, setSearchQuery] = useState(searchParams.get(\"q\") || filters.q || \"\")\n49 +  const inputRef = useRef<HTMLInputElement>(null);\n50    const [sortBy, setSortBy] = useState<SortOption>(settings.behavior.defaultSort || \"time\")\n51    const [filtersOpen, setFiltersOpen] = useState(false)\n52  \n53    // Update search query from URL params\n\n@@ -75,29 +77,54 @@ export default function SearchPage() {\n__new hunk__\n77        filters.fiberMin > 0 ||\n78        filters.sugarMax < 100 ||\n79        filters.sodiumMax < 4000 ||\n80        filters.maxTime < 120 ||\n81        !!filters.mealType\n82      )\n83    }, [filters])\n84  \n85 +  // const activeFilterCount = useMemo(() => {\n86 +  //   let count = 0\n87 +  //   if (filters.dietaryRestrictions.length > 0) count++\n88 +  //   if (filters.allergens.length > 0) count++\n89 +  //   if (filters.cuisines.length > 0) count++\n90 +  //   if (filters.majorConditions.length > 0) count++\n91 +  //   if (filters.calories[0] > 0 || filters.calories[1] < 1200) count++\n92 +  //   if (filters.proteinMin > 0) count++\n93 +  //   if (filters.carbsMin > 0) count++\n94 +  //   if (filters.fatMin > 0) count++\n95 +  //   if (filters.fiberMin > 0) count++\n96 +  //   if (filters.sugarMax < 100) count++\n97 +  //   if (filters.sodiumMax < 4000) count++\n98 +  //   if (filters.maxTime < 120) count++\n99 +  //   if (filters.mealType) count++\n100 +  //   return count\n101 +  // }, [filters])\n102    const activeFilterCount = useMemo(() => {\n103 +    let count = 0;\n104 +\n105 +  // Sum all selected array filters\n106 +    count += filters.dietaryRestrictions.length;\n107 +    count += filters.allergens.length;\n108 +    count += filters.cuisines.length;\n109 +    count += filters.majorConditions.length;\n110 +\n111 +    // Range and min/max filters\n112 +    if (filters.calories[0] > 0) count++; // Min calories\n113 +    if (filters.calories[1] < 1200) count++; // Max calories\n114 +    if (filters.proteinMin > 0) count++;\n115 +    if (filters.carbsMin > 0) count++;\n116 +    if (filters.fatMin > 0) count++;\n117 +    if (filters.fiberMin > 0) count++;\n118 +    if (filters.sugarMax < 100) count++;\n119 +    if (filters.sodiumMax < 4000) count++;\n120 +    if (filters.maxTime < 120) count++;\n121 +    \n122 +    // Single-value selection\n123 +    if (filters.mealType) count++;\n124 +\n125 +    return count;\n126 +  }, [filters]);\n127  \n128    const {\n129      data: searchResults = [],\n130      isLoading,\n__old hunk__\n       filters.fiberMin > 0 ||\n       filters.sugarMax < 100 ||\n       filters.sodiumMax < 4000 ||\n       filters.maxTime < 120 ||\n       !!filters.mealType\n     )\n   }, [filters])\n \n   const activeFilterCount = useMemo(() => {\n-    let count = 0\n-    if (filters.dietaryRestrictions.length > 0) count++\n-    if (filters.allergens.length > 0) count++\n-    if (filters.cuisines.length > 0) count++\n-    if (filters.majorConditions.length > 0) count++\n-    if (filters.calories[0] > 0 || filters.calories[1] < 1200) count++\n-    if (filters.proteinMin > 0) count++\n-    if (filters.carbsMin > 0) count++\n-    if (filters.fatMin > 0) count++\n-    if (filters.fiberMin > 0) count++\n-    if (filters.sugarMax < 100) count++\n-    if (filters.sodiumMax < 4000) count++\n-    if (filters.maxTime < 120) count++\n-    if (filters.mealType) count++\n-    return count\n-  }, [filters])\n \n   const {\n     data: searchResults = [],\n     isLoading,\n\n@@ -113,12 +140,22 @@ export default function SearchPage() {\n__new hunk__\n140          const rankedResults = rank(rawResults, settings)\n141          return rankedResults\n142        }\n143  \n144        return rawResults.map((recipe) => ({ ...recipe, score: 0 }))\n145      },\n146      enabled: !!(searchQuery || hasActiveFilters),\n147    })\n148 +  const handleSearchInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n149 +    if (e.key === \"Escape\" && searchQuery) {\n150 +      setSearchQuery(\"\");\n151 +      inputRef.current?.focus();\n152 +    }\n153 +    if (e.key === \"Enter\") {\n154 +      handleSearch(searchQuery);\n155 +    }\n156 +  };\n157 +\n158  \n159    const handleSearch = (query: string) => {\n160      setSearchQuery(query)\n161      setFilters({ ...filters, q: query })\n\n@@ -182,13 +219,13 @@ export default function SearchPage() {\n__new hunk__\n219    return (\n220      <div className=\"container px-4 py-6 max-w-6xl\">\n221        <div className=\"space-y-6\">\n222          {/* Search Header */}\n223          <div className=\"space-y-4\">\n224            <h1 className=\"text-3xl font-bold\">Search Recipes</h1>\n225  \n226            {/* Search Input */}\n227 +          {/* <div className=\"relative\">\n228              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n229              <Input\n230                role=\"search\"\n231                placeholder=\"Search recipes, ingredients, cuisines...\"\n__old hunk__\n   return (\n     <div className=\"container px-4 py-6 max-w-6xl\">\n       <div className=\"space-y-6\">\n         {/* Search Header */}\n         <div className=\"space-y-4\">\n           <h1 className=\"text-3xl font-bold\">Search Recipes</h1>\n \n           {/* Search Input */}\n-          <div className=\"relative\">\n             <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n             <Input\n               role=\"search\"\n               placeholder=\"Search recipes, ingredients, cuisines...\"\n\n@@ -192,14 +229,51 @@ export default function SearchPage() {\n__new hunk__\n229              <Input\n230                role=\"search\"\n231                placeholder=\"Search recipes, ingredients, cuisines...\"\n232                value={searchQuery}\n233                onChange={(e) => setSearchQuery(e.target.value)}\n234                onKeyDown={(e) => e.key === \"Enter\" && handleSearch(searchQuery)}\n235                className=\"pl-10 pr-4 h-12 text-lg\"\n236              />\n237 +          </div> */}\n238 +          <div style={{ position: \"relative\", display: \"inline-block\", width: \"100%\" }}>\n239 +            <Search style={{ position: \"absolute\", left: \"0.75rem\", top: \"50%\", transform: \"translateY(-50%)\", height: \"1rem\", width: \"1rem\", color: \"gray\" }} />\n240 +            <Input\n241 +              role=\"search\"\n242 +              ref={inputRef}\n243 +              placeholder=\"Search recipes, ingredients, cuisines...\"\n244 +              value={searchQuery}\n245 +              onChange={(e) => setSearchQuery(e.target.value)}\n246 +              onKeyDown={handleSearchInputKeyDown}\n247 +              style={{ paddingRight: searchQuery ? \"2rem\" : undefined, width: \"100%\" }}\n248 +              className=\"pl-10 pr-4 h-12 text-lg\"\n249 +            />\n250 +            {searchQuery && (\n251 +              <button\n252 +                type=\"button\"\n253 +                style={{\n254 +                  position: \"absolute\",\n255 +                  right: \"0.75rem\",\n256 +                  top: \"50%\",\n257 +                  transform: \"translateY(-50%)\",\n258 +                  background: \"none\",\n259 +                  border: \"none\",\n260 +                  cursor: \"pointer\",\n261 +                  padding: 0,\n262 +                  color: \"gray\",\n263 +                }}\n264 +                aria-label=\"Clear search\"\n265 +                onClick={() => {\n266 +                  setSearchQuery(\"\");\n267 +                  inputRef.current?.focus();\n268 +              }}\n269 +              >\n270 +                <X size={20} />\n271 +            </button>\n272 +          )}\n273            </div>\n274  \n275 +\n276            {/* Search Actions */}\n277            <div className=\"flex items-center gap-2\">\n278              <Button onClick={() => handleSearch(searchQuery)} size=\"sm\">\n279                Search\n\n\n## File: 'components/filter-panel.tsx'\n\n@@ -54,35 +54,58 @@\n__new hunk__\n54  export function FilterPanel({ open, onOpenChange, initialValues, onApply, onReset }: FilterPanelProps) {\n55    const form = useForm<FiltersFormInput>({\n56      resolver: zodResolver(schema),\n57      // provide full defaults (OUTPUT fits into INPUT just fine)\n58      defaultValues: schema.parse(initialValues ?? {}),\n59      mode: \"onChange\",\n60    })\n61  \n62     useEffect(() => {\n63      form.reset(schema.parse(initialValues ?? {}));\n64    }, [open, initialValues, form]);\n65  \n66 +  // function getActiveFiltersCount(): number {\n67 +  //   const values = form.getValues()\n68 +  //   let count = 0\n69 +  //   if ((values.dietaryRestrictions || []).length > 0) count++\n70 +  //   if ((values.allergens || []).length > 0) count++\n71 +  //   if ((values.cuisines || []).length > 0) count++\n72 +  //   if ((values.majorConditions || []).length > 0) count++\n73 +  //   if (values.calories && (values.calories[0] > 0 || values.calories[1] < 1200)) count++\n74 +  //   if ((values.proteinMin || 0) > 0) count++\n75 +  //   if ((values.carbsMin || 0) > 0) count++\n76 +  //   if ((values.fatMin || 0) > 0) count++\n77 +  //   if ((values.fiberMin || 0) > 0) count++\n78 +  //   if ((values.sugarMax || 100) < 100) count++\n79 +  //   if ((values.sodiumMax || 4000) < 4000) count++\n80 +  //   2025-12-10T02:12:20.700537041Z if ((values.maxTime || 120) < 120) count++\n81 +  //   if ((values.mealType || \"\") !== \"\") count++\n82 +  //   return count\n83 +  // }\n84    function getActiveFiltersCount(): number {\n85 +    const values = form.getValues();\n86 +    let count = 0;\n87 +\n88 +    // Count all selected array filters individually\n89 +    count += values.dietaryRestrictions.length;\n90 +    count += values.allergens.length;\n91 +    count += values.cuisines.length;\n92 +    count += values.majorConditions.length;\n93 +\n94 +    // Numeric and single-value filters\n95 +    if (values.calories[0] > 0) count++;           // Min calories\n96 +    if (values.calories[1] < 1200) count++;        // Max calories\n97 +    if (values.proteinMin > 0) count++;\n98 +    if (values.carbsMin > 0) count++;\n99 +    if (values.fatMin > 0) count++;\n100 +    if (values.fiberMin > 0) count++;\n101 +    if (values.sugarMax < 100) count++;\n102 +    if (values.sodiumMax < 4000) count++;\n103 +    if (values.maxTime < 120) count++;\n104 +    if (values.mealType) count++;\n105 +\n106 +    return count;\n107    }\n108    function handleApply() {\n109      const values = schema.parse(form.getValues())\n110      onApply(values)\n111      onOpenChange(false)\n__old hunk__\n export function FilterPanel({ open, onOpenChange, initialValues, onApply, onReset }: FilterPanelProps) {\n   const form = useForm<FiltersFormInput>({\n     resolver: zodResolver(schema),\n     // provide full defaults (OUTPUT fits into INPUT just fine)\n     defaultValues: schema.parse(initialValues ?? {}),\n     mode: \"onChange\",\n   })\n \n    useEffect(() => {\n     form.reset(schema.parse(initialValues ?? {}));\n   }, [open, initialValues, form]);\n \n   function getActiveFiltersCount(): number {\n-    const values = form.getValues()\n-    let count = 0\n-    if ((values.dietaryRestrictions || []).length > 0) count++\n-    if ((values.allergens || []).length > 0) count++\n-    if ((values.cuisines || []).length > 0) count++\n-    if ((values.majorConditions || []).length > 0) count++\n-    if (values.calories && (values.calories[0] > 0 || values.calories[1] < 1200)) count++\n-    if ((values.proteinMin || 0) > 0) count++\n-    if ((values.carbsMin || 0) > 0) count++\n-    if ((values.fatMin || 0) > 0) count++\n-    if ((values.fiberMin || 0) > 0) count++\n-    if ((values.sugarMax || 100) < 100) count++\n-    if ((values.sodiumMax || 4000) < 4000) count++\n-    if ((values.maxTime || 120) < 120) count++\n-    if ((values.mealType || \"\") !== \"\") count++\n-    return count\n   }\n-\n   function handleApply() {\n     const values = schema.parse(form.getValues())\n     onApply(values)\n     onOpenChange(false)\n======\n\n\nResponse (should be a valid YAML, and nothing else):\n```yaml"}}, "file": {"name": "litellm_ai_handler.py", "path": "/app/pr_agent/algo/ai_handlers/litellm_ai_handler.py"}, "function": "chat_completion", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 383, "message": "Prompts", "module": "litellm_ai_handler", "name": "pr_agent.algo.ai_handlers.litellm_ai_handler", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.700114+00:00", "timestamp": 1765332740.700114}}}
2025-12-10T02:12:20.704010106Z 
2025-12-10T02:12:20.704059029Z Provider List: https://docs.litellm.ai/docs/providers
2025-12-10T02:12:20.704063276Z 
2025-12-10T02:12:20.704066060Z {"text": "Error during LLM inference: litellm.BadRequestError: LLM Provider NOT provided. Pass in the LLM provider you are trying to call. You passed model=\\\"openai/gpt-5-nano\\\"]\n Pass model as E.g. For 'Huggingface' inference endpoints pass in `completion(model='huggingface/starcoder',..)` Learn more: https://docs.litellm.ai/docs/providers\n", "record": {"elapsed": {"repr": "0:01:35.356297", "seconds": 95.356297}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1"}, "file": {"name": "litellm_ai_handler.py", "path": "/app/pr_agent/algo/ai_handlers/litellm_ai_handler.py"}, "function": "chat_completion", "level": {"icon": "âš ï¸", "name": "WARNING", "no": 30}, "line": 396, "message": "Error during LLM inference: litellm.BadRequestError: LLM Provider NOT provided. Pass in the LLM provider you are trying to call. You passed model=\\\"openai/gpt-5-nano\\\"]\n Pass model as E.g. For 'Huggingface' inference endpoints pass in `completion(model='huggingface/starcoder',..)` Learn more: https://docs.litellm.ai/docs/providers", "module": "litellm_ai_handler", "name": "pr_agent.algo.ai_handlers.litellm_ai_handler", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.703693+00:00", "timestamp": 1765332740.703693}}}
2025-12-10T02:12:20.704095855Z {"text": "Failed to generate prediction with \\\"openai/gpt-5-nano\\\"]\n", "record": {"elapsed": {"repr": "0:01:35.356542", "seconds": 95.356542}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "artifact": {"error": "RetryError[<Future at 0x736c6d24fd70 state=finished raised BadRequestError>]"}}, "file": {"name": "pr_processing.py", "path": "/app/pr_agent/algo/pr_processing.py"}, "function": "retry_with_fallback_models", "level": {"icon": "âš ï¸", "name": "WARNING", "no": 30}, "line": 333, "message": "Failed to generate prediction with \\\"openai/gpt-5-nano\\\"]", "module": "pr_processing", "name": "pr_agent.algo.pr_processing", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.703938+00:00", "timestamp": 1765332740.703938}}}
2025-12-10T02:12:20.704283118Z {"text": "Failed to review PR: Failed to generate prediction with any model of ['openai/gpt-5.1', '[\\\\\"openai/gpt-5\\\\\"', '\\\\\"openai/gpt-5-nano\\\\\"]']\n", "record": {"elapsed": {"repr": "0:01:35.356621", "seconds": 95.356621}, "exception": null, "extra": {"action": "created", "event": "issue_comment", "sender": "souravOD", "server_type": "github_app", "request_id": "b8403329da644fc3ab5e7d6b20d0c842", "build_number": "unknown", "app_name": "Unknown", "repo": "souravOD/nutri-b2c-frontend", "git_org": "", "installation_id": 92375808, "api_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1", "command": "review", "pr_url": "https://api.github.com/repos/souravOD/nutri-b2c-frontend/pulls/1"}, "file": {"name": "pr_reviewer.py", "path": "/app/pr_agent/tools/pr_reviewer.py"}, "function": "run", "level": {"icon": "âŒ", "name": "ERROR", "no": 40}, "line": 184, "message": "Failed to review PR: Failed to generate prediction with any model of ['openai/gpt-5.1', '[\\\\\"openai/gpt-5\\\\\"', '\\\\\"openai/gpt-5-nano\\\\\"]']", "module": "pr_reviewer", "name": "pr_agent.tools.pr_reviewer", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.704017+00:00", "timestamp": 1765332740.704017}}}
eSearch(searchQuery);\n155 +    }\n156 +  };\n157 +\n158  \n159    const handleSearch = (query: string) => {\n160      setSearchQuery(query)\n161      setFilters({ ...filters, q: query })\n\n@@ -182,13 +219,13 @@ export default function SearchPage() {\n__new hunk__\n219    return (\n220      <div className=\"container px-4 py-6 max-w-6xl\">\n221        <div className=\"space-y-6\">\n222          {/* Search Header */}\n223          <div className=\"space-y-4\">\n224            <h1 className=\"text-3xl font-bold\">Search Recipes</h1>\n225  \n226            {/* Search Input */}\n227 +          {/* <div className=\"relative\">\n228              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n229              <Input\n230                role=\"search\"\n231                placeholder=\"Search recipes, ingredients, cuisines...\"\n__old hunk__\n   return (\n     <div className=\"container px-4 py-6 max-w-6xl\">\n       <div className=\"space-y-6\">\n         {/* Search Header */}\n         <div className=\"space-y-4\">\n           <h1 className=\"text-3xl font-bold\">Search Recipes</h1>\n \n           {/* Search Input */}\n-          <div className=\"relative\">\n             <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n             <Input\n               role=\"search\"\n               placeholder=\"Search recipes, ingredients, cuisines...\"\n\n@@ -192,14 +229,51 @@ export default function SearchPage() {\n__new hunk__\n229              <Input\n230                role=\"search\"\n231                placeholder=\"Search recipes, ingredients, cuisines...\"\n232                value={searchQuery}\n233                onChange={(e) => setSearchQuery(e.target.value)}\n234                onKeyDown={(e) => e.key === \"Enter\" && handleSearch(searchQuery)}\n235                className=\"pl-10 pr-4 h-12 text-lg\"\n236              />\n237 +          </div> */}\n238 +          <div style={{ position: \"relative\", display: \"inline-block\", width: \"100%\" }}>\n239 +            <Search style={{ position: \"absolute\", left: \"0.75rem\", top: \"50%\", transform: \"translateY(-50%)\", height: \"1rem\", width: \"1rem\", color: \"gray\" }} />\n240 +            <Input\n241 +              role=\"search\"\n242 +              ref={inputRef}\n243 +              placeholder=\"Search recipes, ingredients, cuisines...\"\n244 +              value={searchQuery}\n245 +              onChange={(e) => setSearchQuery(e.target.value)}\n246 +              onKeyDown={handleSearchInputKeyDown}\n247 +              style={{ paddingRight: searchQuery ? \"2rem\" : undefined, width: \"100%\" }}\n248 +              className=\"pl-10 pr-4 h-12 text-lg\"\n249 +            />\n250 +            {searchQuery && (\n251 +              <button\n252 +                type=\"button\"\n253 +                style={{\n254 +                  position: \"absolute\",\n255 +                  right: \"0.75rem\",\n256 +                  top: \"50%\",\n257 +                  transform: \"translateY(-50%)\",\n258 +                  background: \"none\",\n259 +                  border: \"none\",\n260 +                  cursor: \"pointer\",\n261 +                  padding: 0,\n262 +                  color: \"gray\",\n263 +                }}\n264 +                aria-label=\"Clear search\"\n265 +                onClick={() => {\n266 +                  setSearchQuery(\"\");\n267 +                  inputRef.current?.focus();\n268 +              }}\n269 +              >\n270 +                <X size={20} />\n271 +            </button>\n272 +          )}\n273            </div>\n274  \n275 +\n276            {/* Search Actions */}\n277            <div className=\"flex items-center gap-2\">\n278              <Button onClick={() => handleSearch(searchQuery)} size=\"sm\">\n279                Search\n\n\n## File: 'components/filter-panel.tsx'\n\n@@ -54,35 +54,58 @@\n__new hunk__\n54  export function FilterPanel({ open, onOpenChange, initialValues, onApply, onReset }: FilterPanelProps) {\n55    const form = useForm<FiltersFormInput>({\n56      resolver: zodResolver(schema),\n57      // provide full defaults (OUTPUT fits into INPUT just fine)\n58      defaultValues: schema.parse(initialValues ?? {}),\n59      mode: \"onChange\",\n60    })\n61  \n62     useEffect(() => {\n63      form.reset(schema.parse(initialValues ?? {}));\n64    }, [open, initialValues, form]);\n65  \n66 +  // function getActiveFiltersCount(): number {\n67 +  //   const values = form.getValues()\n68 +  //   let count = 0\n69 +  //   if ((values.dietaryRestrictions || []).length > 0) count++\n70 +  //   if ((values.allergens || []).length > 0) count++\n71 +  //   if ((values.cuisines || []).length > 0) count++\n72 +  //   if ((values.majorConditions || []).length > 0) count++\n73 +  //   if (values.calories && (values.calories[0] > 0 || values.calories[1] < 1200)) count++\n74 +  //   if ((values.proteinMin || 0) > 0) count++\n75 +  //   if ((values.carbsMin || 0) > 0) count++\n76 +  //   if ((values.fatMin || 0) > 0) count++\n77 +  //   if ((values.fiberMin || 0) > 0) count++\n78 +  //   if ((values.sugarMax || 100) < 100) count++\n79 +  //   if ((values.sodiumMax || 4000) < 4000) count++\n80 +  //   2025-12-10T02:12:20.474394341Z if ((values.maxTime || 120) < 120) count++\n81 +  //   if ((values.mealType || \"\") !== \"\") count++\n82 +  //   return count\n83 +  // }\n84    function getActiveFiltersCount(): number {\n85 +    const values = form.getValues();\n86 +    let count = 0;\n87 +\n88 +    // Count all selected array filters individually\n89 +    count += values.dietaryRestrictions.length;\n90 +    count += values.allergens.length;\n91 +    count += values.cuisines.length;\n92 +    count += values.majorConditions.length;\n93 +\n94 +    // Numeric and single-value filters\n95 +    if (values.calories[0] > 0) count++;           // Min calories\n96 +    if (values.calories[1] < 1200) count++;        // Max calories\n97 +    if (values.proteinMin > 0) count++;\n98 +    if (values.carbsMin > 0) count++;\n99 +    if (values.fatMin > 0) count++;\n100 +    if (values.fiberMin > 0) count++;\n101 +    if (values.sugarMax < 100) count++;\n102 +    if (values.sodiumMax < 4000) count++;\n103 +    if (values.maxTime < 120) count++;\n104 +    if (values.mealType) count++;\n105 +\n106 +    return count;\n107    }\n108    function handleApply() {\n109      const values = schema.parse(form.getValues())\n110      onApply(values)\n111      onOpenChange(false)\n__old hunk__\n export function FilterPanel({ open, onOpenChange, initialValues, onApply, onReset }: FilterPanelProps) {\n   const form = useForm<FiltersFormInput>({\n     resolver: zodResolver(schema),\n     // provide full defaults (OUTPUT fits into INPUT just fine)\n     defaultValues: schema.parse(initialValues ?? {}),\n     mode: \"onChange\",\n   })\n \n    useEffect(() => {\n     form.reset(schema.parse(initialValues ?? {}));\n   }, [open, initialValues, form]);\n \n   function getActiveFiltersCount(): number {\n-    const values = form.getValues()\n-    let count = 0\n-    if ((values.dietaryRestrictions || []).length > 0) count++\n-    if ((values.allergens || []).length > 0) count++\n-    if ((values.cuisines || []).length > 0) count++\n-    if ((values.majorConditions || []).length > 0) count++\n-    if (values.calories && (values.calories[0] > 0 || values.calories[1] < 1200)) count++\n-    if ((values.proteinMin || 0) > 0) count++\n-    if ((values.carbsMin || 0) > 0) count++\n-    if ((values.fatMin || 0) > 0) count++\n-    if ((values.fiberMin || 0) > 0) count++\n-    if ((values.sugarMax || 100) < 100) count++\n-    if ((values.sodiumMax || 4000) < 4000) count++\n-    if ((values.maxTime || 120) < 120) count++\n-    if ((values.mealType || \"\") !== \"\") count++\n-    return count\n   }\n-\n   function handleApply() {\n     const values = schema.parse(form.getValues())\n     onApply(values)\n     onOpenChange(false)\n======\n\n\nResponse (should be a valid YAML, and nothing else):\n```yaml"}}, "file": {"name": "litellm_ai_handler.py", "path": "/app/pr_agent/algo/ai_handlers/litellm_ai_handler.py"}, "function": "chat_completion", "level": {"icon": "ðŸž", "name": "DEBUG", "no": 10}, "line": 383, "message": "Prompts", "module": "litellm_ai_handler", "name": "pr_agent.algo.ai_handlers.litellm_ai_handler", "process": {"id": 25, "name": "MainProcess"}, "thread": {"id": 126909727308672, "name": "MainThread"}, "time": {"repr": "2025-12-10 02:12:20.471853+00:00", "timestamp": 1765332740.471853}}}